<!DOCTYPE html>
<!-- saved from url=(0098)https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="4127660" data-user-uuid="b28f9685-65fa-4f95-827a-bc87c37860af" data-username="chenshangwen" data-account-type="Trial" data-activated-trial-date="01/21/2019" data-archive="9781482229417" data-publishers="A K Peters/CRC Press" data-htmlfile-name="K22616_C003.xhtml" data-epub-title="Fundamentals of Computer Graphics, 4th Edition" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781482229417"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/munchkin.js.download"></script><script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/1732687426968531" async=""></script><script async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fbevents.js.download"></script><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/bat.js.download"></script><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/f.txt"></script><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/f.txt"></script><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/linkid.js.download"></script><script async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/gtm.js.download"></script><script async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/analytics.js.download"></script><script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(3),u=e(4),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}catch(e){throw f.emit("fn-err",[arguments,this,e],t),e}finally{f.emit("fn-end",[c.now()],t)}}}};a("actionText,setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e,n){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now(),!1,n])}},{}],2:[function(e,n,t){function r(e,n){if(!o)return!1;if(e!==o)return!1;if(!n)return!0;if(!i)return!1;for(var t=i.split("."),r=n.split("."),a=0;a<r.length;a++)if(r[a]!==t[a])return!1;return!0}var o=null,i=null,a=/Version\/(\S+)\s+Safari/;if(navigator.userAgent){var u=navigator.userAgent,f=u.match(a);f&&u.indexOf("Chrome")===-1&&u.indexOf("Chromium")===-1&&(o="Safari",i=f[1])}n.exports={agent:o,version:i,match:r}},{}],3:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],4:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],5:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=v(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){h[e]=v(e).concat(n)}function m(e,n){var t=h[e];if(t)for(var r=0;r<t.length;r++)t[r]===n&&t.splice(r,1)}function v(e){return h[e]||[]}function g(e){return p[e]=p[e]||o(t)}function w(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var h={},y={},b={on:l,addEventListener:l,removeEventListener:m,emit:t,get:g,listeners:v,context:n,buffer:w,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(3),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!E++){var e=x.info=NREUM.info,n=l.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+x.offset],null,"api");var t=l.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===l.readyState&&i()}function i(){f("mark",["domContent",a()+x.offset],null,"api")}function a(){return O.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-x.offset}var u=(new Date).getTime(),f=e("handle"),c=e(3),s=e("ee"),p=e(2),d=window,l=d.document,m="addEventListener",v="attachEvent",g=d.XMLHttpRequest,w=g&&g.prototype;NREUM.o={ST:setTimeout,SI:d.setImmediate,CT:clearTimeout,XHR:g,REQ:d.Request,EV:d.Event,PR:d.Promise,MO:d.MutationObserver};var h=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1118.min.js"},b=g&&w&&w[m]&&!/CriOS/.test(navigator.userAgent),x=n.exports={offset:u,now:a,origin:h,features:{},xhrWrappable:b,userAgent:p};e(1),l[m]?(l[m]("DOMContentLoaded",i,!1),d[m]("load",r,!1)):(l[v]("onreadystatechange",o),d[v]("onload",r)),f("mark",["firstbyte",u],null,"api");var E=0,O=e(5)},{}]},{},["loader"]);</script><link rel="apple-touch-icon" href="https://learning.oreilly.com/static/images/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/css" rel="stylesheet" type="text/css"><title>Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition</title><link rel="stylesheet" href="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/1282215c62d0.css" type="text/css"><link rel="stylesheet" type="text/css" href="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/font-awesome.min.css"><style type="text/css" title="ibis-book">@font-face{font-family:"Helvetica LT Std Black";font-style:normal;font-weight:bold;src:url(../font/HelveticaLTStd-Blk.otf)}@font-face{font-family:"Helvetica LT Std Bold";font-style:normal;font-weight:bold;src:url(../font/HelveticaLTStd-Bold.otf)}@font-face{font-family:"Helvetica LT Std Bold Oblique";font-style:italic;font-weight:bold;src:url(../font/HelveticaLTStd-BoldObl.otf)}@font-face{font-family:"Helvetica LT Std Oblique";font-style:italic;font-weight:normal;src:url(../font/HelveticaLTStd-Obl.otf)}@font-face{font-family:"Helvetica LT Std";font-style:normal;font-weight:normal;src:url(../font/HelveticaLTStd-Roman.otf)}@font-face{font-family:"Myriad Pro";font-style:normal;font-weight:normal;src:url(../font/MyriadPro-Regular.otf)}@font-face{font-family:"STIX General";font-style:normal;font-weight:normal;src:url(../font/STIXGeneral.otf)}@font-face{font-family:"STIX General Bold";font-style:normal;font-weight:bold;src:url(../font/STIXGeneralBol.otf)}@font-face{font-family:"STIX General Bold Italic";font-style:italic;font-weight:bold;src:url(../font/STIXGeneralBolIta.otf)}@font-face{font-family:"STIX General Italic";font-style:italic;font-weight:normal;src:url(../font/STIXGeneralItalic.otf)}@font-face{font-family:"Times LT Std Bold";font-style:normal;font-weight:bold;src:url(../font/TimesLTStd-Bold.otf)}@font-face{font-family:"Times LT Std Bold Italic";font-style:italic;font-weight:bold;src:url(../font/TimesLTStd-BoldItalic.otf)}@font-face{font-family:"Times LT Std Italic";font-style:italic;font-weight:normal;src:url(../font/TimesLTStd-Italic.otf)}@font-face{font-family:"Times LT Std";font-style:normal;font-weight:normal;src:url(../font/TimesLTStd-Roman.otf)}#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content p,#sbo-rt-content .figcaption{-epub-hyphens:auto;background-color:inherit;border:none;border-width:0;break-after:auto;break-before:auto;break-inside:auto;color:black;display:block;float:none;font-family:"Times LT Std","STIX General","Adobe Caslon Pro",serif;font-size:1em;font-style:normal;font-weight:normal;font-size-adjust:none;font-stretch:normal;hanging-punctuation:none;letter-spacing:0;line-height:1.25em;margin-bottom:0;margin-left:2px;margin-right:2px;margin-top:0;orphans:2;overflow:visible;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;text-align:justify;text-align-last:left;text-decoration:none;text-shadow:none;text-indent:0;text-justify:distribute;text-transform:none;vertical-align:baseline;white-space:normal;widows:2;word-spacing:normal}#sbo-rt-content blockquote,#sbo-rt-content q{-epub-hyphens:auto;background-color:inherit;border:none;border-width:0;break-after:auto;break-before:auto;break-inside:avoid;color:black;display:block;float:none;font-family:"Adobe Caslon Pro",san-serif;font-size:1em;font-style:normal;font-weight:normal;font-size-adjust:none;font-stretch:normal;hanging-punctuation:none;letter-spacing:0;line-height:1.2em;margin-bottom:0;margin-left:5%;margin-right:5%;margin-top:.75em;orphans:4;overflow:scroll;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:avoid;text-align:justify;text-align-last:left;text-decoration:none;text-shadow:none;text-indent:0;text-justify:distribute;text-transform:none;vertical-align:baseline;white-space:normal;widows:4;word-spacing:normal}#sbo-rt-content pre{-epub-hyphens:none;background-color:Azure;border:none;border-width:0;break-after:auto;break-before:auto;break-inside:avoid;color:black;display:block;float:none;font-family:"Courier Std","STIX General",monospaced;font-size:.95em;font-style:normal;font-weight:normal;font-size-adjust:.58;font-stretch:normal;hanging-punctuation:none;letter-spacing:0;line-height:1.2em;margin-bottom:.75em;margin-left:2px;margin-right:2px;margin-top:.75em;orphans:6;overflow:scroll;padding-bottom:.25em;padding-left:.25em;padding-right:.25em;padding-top:.45em;page-break-after:avoid;page-break-before:auto;page-break-inside:avoid;text-align:left;text-align-last:left;text-decoration:none;text-shadow:none;text-indent:0;text-justify:inter-word;text-transform:none;vertical-align:baseline;white-space:normal;widows:6;word-spacing:normal}#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p.h1Number,#sbo-rt-content .h1Author,#sbo-rt-content .h2Author,#sbo-rt-content .h3Author,#sbo-rt-content .h4Author,#sbo-rt-content .h5Author,#sbo-rt-content .h6Author,#sbo-rt-content .h1sub{-epub-hyphens:none;background-color:inherit;border:none;border-width:0;break-after:avoid;break-before:auto;break-inside:avoid;color:DarkGreen;display:block;float:none;font-family:"Times LT Std","STIX General","Adobe Caslon Pro",serif;font-size:1em;font-style:normal;font-weight:bold;font-size-adjust:none;font-stretch:normal;hanging-punctuation:none;letter-spacing:0;line-height:1.2em;margin-bottom:.1em;margin-left:2px;margin-right:2px;margin-top:1em;orphans:6;overflow:visible;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:avoid;page-break-before:auto;page-break-inside:avoid;text-align:left;text-align-last:left;text-decoration:none;text-shadow:none;text-indent:0;text-justify:inter-word;text-transform:none;vertical-align:baseline;white-space:normal;widows:6;word-break:keep-all;word-spacing:normal}#sbo-rt-content h1{font-size:2em;margin-top:.5em}#sbo-rt-content p.h1sub{font-size:1.75em;font-style:italic}#sbo-rt-content h2{font-size:1.8em}#sbo-rt-content h3{font-size:1.5em}#sbo-rt-content h4{font-size:1.2em}#sbo-rt-content h5{font-size:1em}#sbo-rt-content h6{font-size:1em;font-style:italic}#sbo-rt-content .h1Author{color:black;font-size:1.75em;font-weight:normal;font-style:italic}#sbo-rt-content .h2Author{color:black;font-size:1.4em;font-weight:normal;font-style:italic}#sbo-rt-content .h3Author{color:black;font-size:1.2em;font-weight:normal;font-style:italic}#sbo-rt-content .h4Author{color:black;font-size:1em;font-weight:normal;font-style:italic}#sbo-rt-content .h5Author{color:black;font-size:1em;font-weight:normal;font-style:italic}#sbo-rt-content .h6Author{color:black;font-size:.8em;font-weight:normal;font-style:normal}#sbo-rt-content .h1Affiliation,#sbo-rt-content .h2Affiliation,#sbo-rt-content .h3Affiliation,#sbo-rt-content .h4Affiliation,#sbo-rt-content .h5Affiliation,#sbo-rt-content .h6Affiliation{-epub-hyphens:none;background-color:inherit;border:none;border-width:0;break-after:avoid;break-before:auto;break-inside:avoid;color:black;display:block;float:none;font-family:"Times LT Std","STIX General","Adobe Caslon Pro",serif;font-size:1em;font-style:normal;font-weight:normal;font-size-adjust:none;font-stretch:normal;hanging-punctuation:none;letter-spacing:0;line-height:1.2em;margin-bottom:.5em;margin-left:2px;margin-right:2px;margin-top:0;orphans:6;overflow:visible;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:avoid;page-break-before:auto;page-break-inside:avoid;text-align:left;text-align-last:left;text-decoration:none;text-shadow:none;text-indent:0;text-justify:inter-word;text-transform:none;vertical-align:baseline;white-space:normal;widows:6;word-spacing:normal}#sbo-rt-content .h1Affiliation{color:black;font-size:1.55em}#sbo-rt-content .h2Affiliation{color:black;font-size:1.2em}#sbo-rt-content .h3Affiliation{color:black;font-size:1em}#sbo-rt-content .h4Affiliation{color:black;font-size:.9em}#sbo-rt-content .h5Affiliation{color:black;font-size:.8em}#sbo-rt-content .h6Affiliation{color:black;font-size:.8em}#sbo-rt-content .textAuthor{font-weight:bold;text-align:right}#sbo-rt-content .textAffiliation{font-style:italic;text-align:right;margin-bottom:.5em}#sbo-rt-content Allitross{font-family:monospace;font-size:4em;color:red;background-color:yellow;line-height:8em}#sbo-rt-content q{font-style:italic}#sbo-rt-content p{margin-top:1.2em;text-indent:.75em}#sbo-rt-content table{border-collapse:collapse;margin-bottom:.25em;margin-top:.25em}#sbo-rt-content thead{background-color:#0C6}#sbo-rt-content tr{background-color:inherit;border-bottom:thin dotted lightgrey;border-top:thin dotted lightgrey}#sbo-rt-content td{padding:2px 4px 2px 4px}#sbo-rt-content thead>tr{border:none}#sbo-rt-content thead>tr:last-child{border-bottom:thin solid DarkGreen}#sbo-rt-content img{height:auto;width:75%}#sbo-rt-content div.ArtGroup{border-bottom:thin solid DarkGreen;border-top:thin solid DarkGreen;break-inside:avoid;margin-bottom:.25em;margin-top:.25em;overflow:scroll;page-break-inside:avoid;width:100%}#sbo-rt-content div.Table{overflow:scroll;width:100%}#sbo-rt-content div.Box{border:black solid 2px;margin-bottom:2%;margin-left:3%;margin-right:3%;margin-top:2%;padding-bottom:1%;padding-left:3%;padding-right:3%;padding-top:1%;page-break-inside:avoid}#sbo-rt-content div.Shaded{background-color:silver}#sbo-rt-content .footer{page-break-inside:auto;text-align:center;text-align-last:center;text-decoration:none;text-shadow:none;text-indent:0;text-justify:distribute;text-transform:none;vertical-align:baseline;white-space:normal;widows:6;word-spacing:normal}#sbo-rt-content .Example{font-family:"Helvetica LT Std",sans-serif;margin-left:3%;margin-right:3%;margin-top:1em}#sbo-rt-content h1.Example,#sbo-rt-content h1.Extract,#sbo-rt-content h1.Vignette,#sbo-rt-content h1.Math,#sbo-rt-content h1.Problems,#sbo-rt-content h1.GC1,#sbo-rt-content h1.GC2,#sbo-rt-content h1.GC3,#sbo-rt-content h1.GC4{font-size:1.8em}#sbo-rt-content h2.Example,#sbo-rt-content h2.Extract,#sbo-rt-content h2.Vignette,#sbo-rt-content h2.Math,#sbo-rt-content h2.Problems,#sbo-rt-content h2.GC1,#sbo-rt-content h2.GC2,#sbo-rt-content h2.GC3,#sbo-rt-content h2.GC4{font-size:1.5em}#sbo-rt-content h3.Example,#sbo-rt-content h3.Extract,#sbo-rt-content h3.Vignette,#sbo-rt-content h3.Math,#sbo-rt-content h3.Problems,#sbo-rt-content h3.GC1,#sbo-rt-content h3.GC2,#sbo-rt-content h3.GC3,#sbo-rt-content h3.GC4{font-size:1.2em}#sbo-rt-content h4.Example,#sbo-rt-content h4.Extract,#sbo-rt-content h4.Vignette,#sbo-rt-content h4.Math,#sbo-rt-content h4.Problems,#sbo-rt-content h4.GC1,#sbo-rt-content h4.GC2,#sbo-rt-content h4.GC3,#sbo-rt-content h4.GC4{font-size:1em}#sbo-rt-content .Table{background-color:transparent;font-family:"Helvetica LT Std",sans-serif;font-size:85%}#sbo-rt-content .Extract{font-family:"Helvetica LT Std",sans-serif;font-size:88%;line-height:1em;margin-left:2%;margin-right:2%;margin-top:1em}#sbo-rt-content .Vignette{margin-right:2%;margin-left:2%}#sbo-rt-content .GC1{background-color:powderblue}#sbo-rt-content .GC2{background-color:oldlace}#sbo-rt-content .GC3{background-color:lightgrey}#sbo-rt-content .GC4{background-color:lightblue}#sbo-rt-content .Sidebar{font-size:75%}#sbo-rt-content .BookTitle{-epub-hyphens:none;font-size:2.5em;font-weight:bold;margin-left:10%;margin-right:10%;margin-top:10%;text-align:center}#sbo-rt-content .BookSubTitle{-epub-hyphens:none;font-size:2em;font-style:italic;font-weight:bold;margin-left:10%;margin-right:10%;text-align:center}#sbo-rt-content .BookAuthor{-epub-hyphens:none;font-size:1.5em;font-weight:bold;margin-left:10%;margin-right:10%;margin-top:10%;text-align:center}#sbo-rt-content .BookAuthorAffiliation{-epub-hyphens:none;font-size:1em;font-style:italic;margin-left:10%;margin-right:10%;text-align:center}#sbo-rt-content .BookLogo{margin-top:1em;text-align:center;page-break-after:always}#sbo-rt-content .CIP1{font-family:"Helvetica LT Std",sans-serif;font-size:75%}#sbo-rt-content .CIP2{font-family:"Helvetica LT Std",sans-serif;font-size:75%;margin-top:.75em}#sbo-rt-content .Speaker{margin-top:.75em}#sbo-rt-content .Equation{line-height:3em;text-align:center}#sbo-rt-content .fignumber{display:inline;background-color:darkgreen;color:white;margin:.5em;padding-bottom:.25em;padding-left:.5em;padding-right:.5em;padding-top:.35em;break-after:avoid;font-size:1em;font-weight:bold;page-break-after:avoid;page-break-before:avoid}#sbo-rt-content .figcaption{break-after:avoid;break-before:avoid;font-size:.85em;margin-left:4px;margin-right:4px;page-break-after:avoid;page-break-before:avoid}#sbo-rt-content .figsource{break-before:avoid;font-size:.85em;font-style:italic;margin-left:4px;margin-right:4px;page-break-before:avoid}#sbo-rt-content .ObjectLine{margin-bottom:6px;margin-top:6px;text-align:center}#sbo-rt-content .footnote{font-size:80%;margin-left:1%;margin-right:2%;text-indent:0}#sbo-rt-content .GlossTerm{font-weight:bold;margin-left:1em;margin-top:.5em}#sbo-rt-content .GlossDef{margin-left:1em}#sbo-rt-content .Float{float:right}#sbo-rt-content .Left{float:left}#sbo-rt-content .NoteHead{font-weight:bold}#sbo-rt-content .RF{margin-left:.5em;margin-top:.3em;text-indent:0}#sbo-rt-content .RF1{margin-left:.75em;margin-top:.3em;text-indent:0}#sbo-rt-content .RF2{margin-left:1.25em;margin-top:.3em;text-indent:0}#sbo-rt-content h1+p,#sbo-rt-content h2+p,#sbo-rt-content h3+p,#sbo-rt-content h4+p,#sbo-rt-content h5+p,#sbo-rt-content h6+p,#sbo-rt-content p.Number+p,#sbo-rt-content td>p:first-child{margin-top:0;text-indent:0}#sbo-rt-content .Equation+p{text-indent:0}#sbo-rt-content h1+h1,#sbo-rt-content h1+h3,#sbo-rt-content h1+h4,#sbo-rt-content h1+h5,#sbo-rt-content h1+h6,#sbo-rt-content h2+h2,#sbo-rt-content h2+h4,#sbo-rt-content h2+h5,#sbo-rt-content h2+h6,#sbo-rt-content h3+h3,#sbo-rt-content h3+h5,#sbo-rt-content h3+h6,#sbo-rt-content h4+h4,#sbo-rt-content h4+h6,#sbo-rt-content h5+h5,#sbo-rt-content h6+h6,#sbo-rt-content p.h1sub+p.h1sub,#sbo-rt-content p.Number+p.Number{background-color:Yellow;color:Red;line-height:8em;margin-top:0}#sbo-rt-content h1+p.h1sub,#sbo-rt-content h1+h2,#sbo-rt-content p.h1sub+h2,#sbo-rt-content h2+h3,#sbo-rt-content h3+h4,#sbo-rt-content h4+h5,#sbo-rt-content h5+h6,#sbo-rt-content p+p,#sbo-rt-content blockquote.textAuthor+blockquote.textAffiliation,#sbo-rt-content p.Speaker+p.Speaker{margin-top:0}#sbo-rt-content h1+p.h1Author,#sbo-rt-content h2+p.h2Author,#sbo-rt-content h3+p.h3Author,#sbo-rt-content h4+p.h4Author,#sbo-rt-content h5+p.h5Author,#sbo-rt-content h6+p.h6Author{margin-top:0}#sbo-rt-content p.h1Author+p.h1Affiliation,#sbo-rt-content p.h2Author+p.h2Affiliation,#sbo-rt-content p.h3Author+p.h3Affiliation,#sbo-rt-content p.h4Author+p.h4Affiliation,#sbo-rt-content p.h5Author+p.h5Affiliation,#sbo-rt-content p.h6Author+p.h6Affiliation{color:grey;margin-top:0}#sbo-rt-content p.h1Affiliation+p,#sbo-rt-content p.h2Affiliation+p,#sbo-rt-content p.h3Affiliation+p,#sbo-rt-content p.h4Affiliation+p,#sbo-rt-content p.h5Affiliation+p,#sbo-rt-content p.h6Affiliation+p{margin-top:0;text-indent:0}#sbo-rt-content .Extract+.Extract,#sbo-rt-content .Example+.Example{margin-top:0}#sbo-rt-content .Extract+.Dictionary,#sbo-rt-content .Extract+.Example,#sbo-rt-content .Extract+.GC1,#sbo-rt-content .Extract+.GC2,#sbo-rt-content .Extract+.GC3,#sbo-rt-content .Extract+.GC4,#sbo-rt-content .Extract+.Text,#sbo-rt-content .Extract+.Math,#sbo-rt-content .Extract+.Problem,#sbo-rt-content .Dictionary+.Extract,#sbo-rt-content .Example+.Extract,#sbo-rt-content .GC1+.Extract,#sbo-rt-content .GC2+.Extract,#sbo-rt-content .GC3+.Extract,#sbo-rt-content .GC4+.Extract,#sbo-rt-content .Text+.Extract,#sbo-rt-content .Math+.Extract,#sbo-rt-content .Problem+.Extract{margin-top:1em;text-indent:0}#sbo-rt-content .Example+.Dictionary,#sbo-rt-content .Example+.Extract,#sbo-rt-content .Example+.GC1,#sbo-rt-content .Example+.GC2,#sbo-rt-content .Example+.GC3,#sbo-rt-content .Example+.GC4,#sbo-rt-content .Example+.Text,#sbo-rt-content .Example+.Math,#sbo-rt-content .Example+.Problem,#sbo-rt-content .Dictionary+.Example,#sbo-rt-content .Extract+.Example,#sbo-rt-content .GC1+.Example,#sbo-rt-content .GC2+.Example,#sbo-rt-content .GC3+.Example,#sbo-rt-content .GC4+.Example,#sbo-rt-content .Text+.Example,#sbo-rt-content .Math+.Example,#sbo-rt-content .Problem+.Example{margin-top:1em;text-indent:0}#sbo-rt-content .Dictionary+.Vignette,#sbo-rt-content .Example+.Vignette,#sbo-rt-content .Extract+.Vignette,#sbo-rt-content .GC1+.Vignette,#sbo-rt-content .GC2+.Vignette,#sbo-rt-content .GC3+.Vignette,#sbo-rt-content .GC4+.Vignette,#sbo-rt-content .Text+.Vignette,#sbo-rt-content .Math+.Vignette,#sbo-rt-content .Problem+.Vignette{border-top:black thin solid;margin-top:1em}#sbo-rt-content .Vignette+.Dictionary,#sbo-rt-content .Vignette+.Example,#sbo-rt-content .Vignette+.Extract,#sbo-rt-content .Vignette+.GC1,#sbo-rt-content .Vignette+.GC2,#sbo-rt-content .Vignette+.GC3,#sbo-rt-content .Vignette+.GC4,#sbo-rt-content .Vignette+.Text,#sbo-rt-content .Vignette+.Math,#sbo-rt-content .Vignette+.Problem{border-top:black thin solid;margin-top:1em}#sbo-rt-content span.cBold,#sbo-rt-content span.c75Bold{font-weight:bold}#sbo-rt-content span.cSubscript{font-size:82%;line-height:1em;vertical-align:sub}#sbo-rt-content span.cSuperscript{font-size:82%;line-height:1em;vertical-align:super}#sbo-rt-content span.cBI{font-style:italic;font-weight:bold}#sbo-rt-content span.cAllCaps{text-transform:uppercase}#sbo-rt-content span.cBIsub{font-size:82%;font-style:italic;font-weight:bold;line-height:1em;vertical-align:sub}#sbo-rt-content span.cBIsup{font-size:82%;font-style:italic;font-weight:bold;line-height:1em;vertical-align:super}#sbo-rt-content span.cBoldsub,#sbo-rt-content span.cBsub{font-size:82%;font-weight:bold;line-height:1em;vertical-align:sub}#sbo-rt-content span.cBoldsup,#sbo-rt-content span.cBsup{font-size:82%;font-weight:bold;line-height:1em;vertical-align:super}#sbo-rt-content span.cColor{color:darkblue}#sbo-rt-content span.cMagenta{color:magenta}#sbo-rt-content span.cDSP,#sbo-rt-content span.code{-epub-hyphens:none;background-color:Azure;font-family:"Courier Std","STIX General",monospaced;font-size:.95em;font-style:normal;font-weight:normal;font-size-adjust:.58}#sbo-rt-content span.cIsub{font-size:82%;font-style:italic;line-height:1em;vertical-align:sub}#sbo-rt-content span.cIsup{font-size:82%;font-style:italic;line-height:1em;vertical-align:super}#sbo-rt-content span.cItalic,#sbo-rt-content span.cVariable{font-style:italic}#sbo-rt-content span.cOverbar{border-top:solid 1px}#sbo-rt-content span.cSmCap{font-variant:small-caps}#sbo-rt-content span.cSymGreek,#sbo-rt-content span.cSymMath{font-family:"STIX General",serif}#sbo-rt-content span.cSymGreekBI{font-family:"STIX General",serif;font-style:italic;font-weight:bold}#sbo-rt-content span.cSymGreekBold{font-family:"STIX General",serif;font-weight:bold}#sbo-rt-content span.cSymGreekItalic{font-family:"STIX General",serif;font-style:italic}#sbo-rt-content span.cUnderline{border-bottom:solid 1px}#sbo-rt-content .application{font-size:85%;text-transform:uppercase}#sbo-rt-content .class{color:blue;font-style:italic}#sbo-rt-content .command{color:navy;font-weight:bold}#sbo-rt-content .comment{color:darkgrey}#sbo-rt-content .enumeration{color:purple;font-style:italic}#sbo-rt-content .function{font-style:italic}#sbo-rt-content .keywords{font-weight:bold}#sbo-rt-content .property{color:purple}#sbo-rt-content p.h1Number{border-bottom:1px solid black;color:black;font-size:1.65em;overflow:visible}#sbo-rt-content p.centerHead{font-weight:Bold;text-align:center}#sbo-rt-content p.leftHead{font-weight:Bold;text-align:left}#sbo-rt-content p.rightHead{font-weight:Bold;text-align:right}#sbo-rt-content p.tableTitle{font-size:110%;line-height:110%;font-weight:bold;text-indent:0}#sbo-rt-content p.tableNumber{font-size:110%;line-height:110%;font-weight:bold;text-indent:0}#sbo-rt-content .GlossTerm::after{content:": "}#sbo-rt-content math{font-family:"STIX General",serif}</style><style type="text/css" title="ibis-book">#sbo-rt-content .component{page-break-inside:avoid;page-break-before:auto;max-width:10000px;line-height:1em}#sbo-rt-content .container>header h1{margin:auto}#sbo-rt-content .container>header span{display:block;opacity:0}#sbo-rt-content table{margin-top:-1px;border-collapse:collapse;width:100%;background:#fff}#sbo-rt-content td,#sbo-rt-content th{border-bottom-style:dotted;border-bottom-width:1px;border-bottom-color:LightGray;border-left-style:none;border-right-style:none;border-top-style:dotted;border-top-width:1px;border-top-color:LightGray;padding-bottom:.1em;padding-left:.1em;padding-right:.1em;padding-top:.1em;vertical-align:middle;text-align:center}#sbo-rt-content tbody th{background-color:#f5f5f5}#sbo-rt-content tbody tr:nth-child(2n-1){background-color:#f5f5f5;transition:all .125s ease-in-out}#sbo-rt-content tbody tr:hover{background-color:rgba(129,208,177,.3)}#sbo-rt-content .sticky-wrap{overflow-x:auto;overflow-y:hidden;position:relative}#sbo-rt-content .sticky-wrap .sticky-thead,#sbo-rt-content .sticky-wrap .sticky-col,#sbo-rt-content .sticky-wrap .sticky-intersect{opacity:0;position:relative;top:0;left:0;z-index:50;width:auto}#sbo-rt-content .sticky-wrap .sticky-thead{z-index:100;width:100%}#sbo-rt-content .sticky-wrap .sticky-intersect{opacity:1;z-index:150}#sbo-rt-content .sticky-wrap td,#sbo-rt-content .sticky-wrap th{box-sizing:border-box}#sbo-rt-content .sticky-wrap.overflow-y{overflow-y:auto;max-height:60vh}</style><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781482229417/chapter/K22616_C003.xhtml",
          "book_id": "9781482229417",
          "chapter_uri": "K22616_C003.xhtml",
          "position": 0,
          "user_uuid": "b28f9685-65fa-4f95-827a-bc87c37860af",
          "next_chapter_uri": "/library/view/fundamentals-of-computer/9781482229417/K22616_C004.xhtml"
        
      },
      title: "Fundamentals of Computer Graphics, 4th Edition",
      author_list: "Peter Shirley, Steve Marschner",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: true,
      show_ios_app_teaser: false
    };
    // ]]></script><script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/modernizr.8e35451ddb64.js.download"></script><script>
    
      

      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

    
      window.PRIVACY_CONTROL_SWITCH = true;
    

    
      window.PUBLISHER_PAGES = true;
    

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml"><meta name="description" content="Chapter 3 Raster Images Most computer graphics images are presented to the user on some kind of raster display. Raster displays show images as rectangular arrays of pixels. A common ... "><meta property="og:title" content="Chapter 3 Raster Images"><meta itemprop="isPartOf" content="/library/view/fundamentals-of-computer/9781482229417/"><meta itemprop="name" content="Chapter 3 Raster Images"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781482229417/"><meta property="og:description" itemprop="description" content="Chapter 3 Raster Images Most computer graphics images are presented to the user on some kind of raster display. Raster displays show images as rectangular arrays of pixels. A common ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="A K Peters/CRC Press"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781482229417"><meta property="og:book:author" itemprop="author" content="Peter Shirley"><meta property="og:book:author" itemprop="author" content="Steve Marschner"><meta property="og:book:tag" itemprop="about" content="Digital Media"><meta property="og:book:tag" itemprop="about" content="Engineering"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script type="text/javascript">
    (function(i,s,o,g,r,a,m) {
      i['GoogleAnalyticsObject']=r;
      i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();
      a=s.createElement(o),m=s.getElementsByTagName(o)[0];
      a.async=1;
      a.src=g;
      m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    var matches = document.cookie.match(/BrowserCookie\s*=\s*([a-f0-9\-]{36})/),
      user_uuid = null;

    if (matches && matches.length === 2) {
      user_uuid = matches[1];
    }

  
    ga('create', 'UA-39299553-7', {'userId': 'b28f9685-65fa-4f95-827a-bc87c37860af' });
  

  
    
      ga('set', 'dimension1', 'Trial');
    
  

  ga('set', 'dimension6', user_uuid);

  
    ga('set', 'dimension2', 'b28f9685-65fa-4f95-827a-bc87c37860af');
    
  

  

  

  //enable enhanced link tracking
  ga('require', 'linkid', 'linkid.js');

  // reading interface will track pageviews itself
  if (document.location.pathname.indexOf("/library/view") !== 0) {
    ga('send', 'pageview');
  }
  </script><script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
  </script><script defer="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/vendor.40e3ab2299ca.js.download"></script><script defer="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/reader.54b3e1936311.js.download"></script><script type="text/javascript" async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/munchkin.js(1).download"></script><script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/f(1).txt"></script><script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/f(2).txt"></script><script async="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/MathJax.js.download"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
</style><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
</style><style type="text/css">@font-face {font-family: MathJax_AMS; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_AMS-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_AMS-Regular.otf?V=2.7.1') format('opentype')}
</style><style type="text/css">@font-face {font-family: MathJax_Script; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Script-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Script-Regular.otf?V=2.7.1') format('opentype')}
</style></head>


<body class="reading sidenav  scalefonts subscribe-panel library nav-collapsed"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

    
  
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://learning.oreilly.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://learning.oreilly.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="t-queue-nav l0 nav-icn None"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://learning.oreilly.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://learning.oreilly.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://learning.oreilly.com/learning-paths/" class="l1 nav-icn t-learningpaths-nav js-toggle-menu-item"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="32px" height="32px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 52.5 (67469) - http://www.bohemiancoding.com/sketch --><title>Mask</title><desc>Created with Sketch.</desc><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path d="M0,16.0214227 C0,15.0387209 0.796453294,14.2411658 1.77779753,14.2411658 C2.75914177,14.2411658 3.55559506,15.0387209 3.55559506,16.0214227 C3.55559506,17.0041246 2.75914177,17.8016797 1.77779753,17.8016797 C0.796453294,17.8016797 0,17.0041246 0,16.0214227 Z M9.77788642,5.22914885 C8.9280992,5.72049977 7.84008711,5.42853763 7.34941499,4.57757479 C6.85874287,3.72661195 7.15030167,2.63709467 8.00008889,2.14574375 C8.84987611,1.65439282 9.9378882,1.94635496 10.4285603,2.7973178 C10.9192324,3.64828064 10.6276736,4.73779792 9.77788642,5.22914885 Z M4.57213969,7.35869225 C5.42192691,7.85004318 5.71348571,8.93956046 5.22281359,9.79052329 C4.73214147,10.6414861 3.64412938,10.9334483 2.79434216,10.4420974 C1.94455494,9.95074642 1.65299614,8.86122915 2.14366826,8.01026631 C2.63434038,7.15930347 3.72235247,6.86734132 4.57213969,7.35869225 Z M2.79434216,21.6007481 C3.64412938,21.1093972 4.73214147,21.4013594 5.22281359,22.2523222 C5.71348571,23.103285 5.42192691,24.1928023 4.57213969,24.6841532 C3.72235247,25.1755042 2.63434038,24.883542 2.14366826,24.0325792 C1.65299614,23.1816163 1.94455494,22.0920991 2.79434216,21.6007481 Z M7.34941499,27.4652707 C7.84008711,26.6143079 8.9280992,26.3223457 9.77788642,26.8136966 C10.6276736,27.3050476 10.9192324,28.3945649 10.4285603,29.2455277 C9.9378882,30.0964905 8.84987611,30.3884527 8.00008889,29.8971017 C7.15030167,29.4057508 6.85874287,28.3162335 7.34941499,27.4652707 Z M18.7118524,11.3165596 C21.3074367,12.8173162 22.1963355,16.1392758 20.6976522,18.738451 C19.1989689,21.3358459 15.8815987,22.2259744 13.2860143,20.726998 C10.6922077,19.2262414 9.80330893,15.9042818 11.3002144,13.3051066 C12.7988978,10.7059314 16.116268,9.81580294 18.7118524,11.3165596 Z M26.7821642,27.8093944 L30.1315348,31.1633985 C30.3982044,31.4304371 30.2097579,31.8844026 29.8346426,31.8844026 L21.5945511,31.8844026 C21.1287681,31.8844026 20.751875,31.5069881 20.751875,31.0405608 L20.751875,22.7890697 C20.751875,22.4134355 21.2052134,22.2247282 21.4701052,22.4899865 L24.2843587,25.3081333 C26.8337204,23.0240636 28.4444049,19.7092251 28.4444049,16.0223129 C28.4444049,9.15052091 22.8621207,3.56051397 15.9998222,3.56051397 L15.9998222,0 C24.8230314,0 32,7.18689745 32,16.0223129 C32,20.6919269 29.9750886,24.8790914 26.7821642,27.8093944 Z" id="Mask" fill="#8B889A"></path></g></svg><span>Learning Paths</span></a></li><li class="nav-offers flyout-parent"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://learning.oreilly.com/u/b28f9685-65fa-4f95-827a-bc87c37860af/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://learning.oreilly.com/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://learning.oreilly.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Fundamentals of Computer Graphics, 4th Edition
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781482229417/chapter/K22616_C003.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml&amp;text=Fundamentals%20of%20Computer%20Graphics%2C%204th%20Edition&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%20Chapter%203%20Raster%20Images&amp;body=https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C003.xhtml%0D%0Afrom%20Fundamentals%20of%20Computer%20Graphics%2C%204th%20Edition%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C011.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 11 Texture Mapping</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C013.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 13 More Ray Tracing</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><p class="h1Number">Chapter 12</p>
<h1>Data Structures for Graphics</h1>
<p><a id="page_280"></a><a id="page_281"></a>Certain data structures seem to pop up repeatedly in graphics applications, perhaps because they address fundamental underlying ideas like surfaces, space, and scene structure. This chapter talks about several basic and unrelated categories of data structures that are among the most common and useful: mesh structures, spatial data structures, scene graphs, and tiled multidimensional arrays.</p>
<p>For meshes, we discuss the basic storage schemes used for storing static meshes and for transferring meshes to graphics APIs. We also discuss the winged-edge data structure (Baumgart, 1974) and the related half-edge structure, which are useful for managing models where the tessellation changes, such as in subdivision or model simplification. Although these methods generalize to arbitrary polygon meshes, we focus on the simpler case of triangle meshes here.</p>
<p>Next, the scene-graph data structure is presented. Various forms of this data structure are ubiquitous in graphics applications because they are so useful in managing objects and transformations. All new graphics APIs are designed to support scene graphs well.</p>
<p>For spatial data structures, we discuss three approaches to organizing models in 3D space—bounding volume hierarchies, hierarchical space subdivision, and uniform space subdivision—and the use of hierarchical space subdivision (BSP trees) for hidden surface removal. The same methods are also used for other purposes, including geometry culling and collision detection.</p>
<p>Finally, the tiled multidimensional array is presented. Originally developed to help paging performance in applications where graphics data needed to be swapped in from disk, such structures are now crucial for memory locality on machines regardless of whether the array fits in main memory.</p>
<h2><a id="sec12-1"></a><a id="page_282"></a>12.1 Triangle Meshes</h2>
<p>Most real-world models are composed of complexes of triangles with shared vertices. These are usually known as <span class="cItalic">triangular meshes, triangle meshes</span>, or <span class="cItalic">triangular irregular networks </span>(TINs), and handling them efficiently is crucial to the performance of many graphics programs. The kind of efficiency that is important depends on the application. Meshes are stored on disk and in memory, and we’d like to minimize the amount of storage consumed. When meshes are transmitted across networks or from the CPU to the graphics system, they consume bandwidth, which is often even more precious than storage. In applications that perform operations on meshes, besides simply storing and drawing them—such as subdivision, mesh editing, mesh compression, or other operations—efficient access to adjacency information is crucial.</p>
<p>Triangle meshes are generally used to represent surfaces, so a mesh is not just a collection of unrelated triangles, but rather a network of triangles that connect to one another through shared vertices and edges to form a single continuous surface. This is a key insight about meshes: a mesh can be handled more efficiently than a collection of the same number of unrelated triangles.</p>
<p>The minimum information required for a triangle mesh is a set of triangles (triples of vertices) and the positions (in 3D space) of their vertices. But many, if not most, programs require the ability to store additional data at the vertices, edges, or faces to support texture mapping, shading, animation, and other operations. Vertex data is the most common: each vertex can have material parameters, texture coordinates, irradiances—any parameters whose values change across the surface. These parameters are then linearly interpolated across each triangle to define a continuous function over the whole surface of the mesh. However, it is also occasionally important to be able to store data per edge or per face.</p>
<h3><a id="sec12-1-1"></a>12.1.1 Mesh Topology</h3>
<p>The idea that meshes are surface-like can be formalized as constraints on the <span class="cItalic">mesh topology</span>—the way the triangles connect together, without regard for the vertex positions. Many algorithms will only work, or are much easier to implement, on a mesh with predictable connectivity. The simplest and most restrictive requirement on the topology of a mesh is for the surface to be a <span class="cItalic">manifold</span>. A manifold mesh is “watertight”—it has no gaps and separates the space on the inside of the surface from the space outside. It also looks like a surface everywhere on the mesh.</p>
<div class="Sidebar">
<p class="SidebarText">We’ll leave the precise definitions to the mathematicians; see the chapter notes.</p>
</div>
<p>The term <span class="cItalic">manifold</span> comes from the mathematical field of topology: roughly speaking, a manifold (specifically a two-dimensional manifold, or 2-manifold) is<a id="page_283"></a>a surface in which a small neighborhood around any point could be smoothed out into a bit of flat surface. This idea is most clearly explained by counterexample: if an edge on a mesh has three triangles connected to it, the neighborhood of a point on the edge is different from the neighborhood of one of the points in the interior of one of the triangles, because it has an extra “fin” sticking out of it (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-1">Figure 12.1</a>). If the edge has exactly two triangles attached to it, points on the edge have neighborhoods just like points in the interior, only with a crease down the middle. Similarly, if the triangles sharing a vertex are in a configuration like the left one in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-2">Figure 12.2</a>, the neighborhood is like two pieces of surface glued together at the center, which can’t be flattened without doubling it up. The vertex with the simpler neighborhood shown at right is just fine.</p>
<div id="art_Dest_fig_12-1" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-1"></a><span class="cBold">Figure 12.1</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-1.png" alt="Figure showing non-manifold (left) and manifold (right) interior edges." width="410" height="247" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-1.png"></p>
<p class="Text figcaption">Non-manifold (left) and manifold (right) interior edges.</p>
</div>
<div id="art_Dest_fig_12-2" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-2"></a><span class="cBold">Figure 12.2</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-2.png" alt="Figure showing non-manifold (left) and manifold (right) interior vertices." width="410" height="241" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-2.png"></p>
<p class="Text figcaption">Non-manifold (left) and manifold (right) interior vertices.</p>
</div>
<p>Many algorithms assume that meshes are manifold, and it’s always a good idea to verify this property to prevent crashes or infinite loops if you are handed a malformed mesh as input. This verification boils down to checking that all edges are manifold and checking that all vertices are manifold by verifying the following conditions:</p>
<ul>
<li class="LX">Every edge is shared by exactly two triangles.</li>
<li class="LX">Every vertex has a single, complete loop of triangles around it.</li>
</ul>
<p><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-1">Figure 12.1</a> illustrates how an edge can fail the first test by having too many triangles, and <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-2">Figure 12.2</a> illustrates how a vertex can fail the second test by having two separate loops of triangles attached to it.</p>
<p>Manifold meshes are convenient, but sometimes it’s necessary to allow meshes to have edges, or <span class="cItalic">boundaries.</span> Such meshes are not manifolds—a point on the boundary has a neighborhood that is cut off on one side. They are not necessarily watertight. However, we can relax the requirements of a manifold mesh to those for a <span class="cItalic">manifold with boundary</span> without causing problems for most mesh processing algorithms. The relaxed conditions are:</p>
<ul>
<li class="LX">Every edge is used by either one or two triangles.</li>
<li class="LX">Every vertex connects to a single edge-connected set of triangles.</li>
</ul>
<p><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-3">Figure 12.3</a> illustrates these conditions: from left to right, there is an edge with one triangle, a vertex whose neighboring triangles are in a single edge-connected set, and a vertex with two disconnected sets of triangles attached to it.</p>
<div id="art_Dest_fig_12-3" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-3"></a><span class="cBold">Figure 12.3</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-3.png" alt="Figure showing conditions at the edge of a manifold with boundary." width="410" height="237" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-3.png"></p>
<p class="Text figcaption">Conditions at the edge of a manifold with boundary.</p>
</div>
<p>Finally, in many applications it’s important to be able to distinguish the “front” or “outside” of a surface from the “back” or “inside”—this is known as the <span class="cItalic">orientation</span> of the surface. For a single triangle, we define orientation based on the order in which the vertices are listed: the front is the side from which the triangle’s three vertices are arranged in counterclockwise order. A connected mesh is <a id="page_284"></a><span class="cItalic">consistently oriented</span> if its triangles all agree on which side is the front—and this is true if and only if every pair of adjacent triangles is consistently oriented.</p>
<p>In a consistently oriented pair of triangles, the two shared vertices appear in opposite orders in the two triangles’ vertex lists (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-4">Figure 12.4</a>). What’s important is consistency of orientation—some systems define the front using clockwise rather than counterclockwise order.</p>
<div id="art_Dest_fig_12-4" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-4"></a><span class="cBold">Figure 12.4</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-4.png" alt="Figure showing triangles (B,A,C) and (D,C,A) are consistently oriented, whereas (B,A,C) and (A,C,D) are inconsistently oriented." width="410" height="266" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-4.png"></p>
<p class="Text figcaption">Triangles (B,A,C) and (D,C,A) are consistently oriented, whereas (B,A,C) and (A,C,D) are inconsistently oriented.</p>
</div>
<p>Any mesh that has non-manifold edges can’t be oriented consistently. But it’s also possible for a mesh to be a valid manifold with boundary (or even a manifold), and yet have no consistent way to orient the triangles—they are not <span class="cItalic">orientable</span> surfaces. An example is the Moöbius band shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-5">Figure 12.5</a>. This is rarely an issue in practice, however.</p>
<div id="art_Dest_fig_12-5" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-5"></a><span class="cBold">Figure 12.5</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-5.png" alt="Figure showing a triangulated Moöbius band, which is not orientable." width="409" height="251" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-5.png"></p>
<p class="Text figcaption">A triangulated Moöbius band, which is not orientable.</p>
</div>
<h3><a id="sec12-1-2"></a>12.1.2  Indexed Mesh Storage</h3>
<p>A simple triangular mesh is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-6">Figure 12.6</a>. You could store these three triangles as independent entities, each of this form:</p>
<div id="art_Dest_fig_12-6" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-6"></a><span class="cBold">Figure 12.6</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-6.png" alt="Figure showing a three-triangle mesh with four vertices, represented with separate triangles (left) and with shared vertices (right)." width="600" height="287" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-6.png"></p>
<p class="Text figcaption">A three-triangle mesh with four vertices, represented with separate triangles (left) and with shared vertices (right).</p>
</div>
<pre><span class="code">Triangle {</span></pre>
<pre><span class="code"> vector3 vertexPosition[3]</span></pre>
<pre><span class="code">}</span></pre>
<p>This would result in storing vertex <span class="cBold">b</span> three times and the other vertices twice each for a total of nine stored points (three vertices for each of three triangles). Or you could instead arrange to share the common vertices and store only four, resulting <a id="page_285"></a>in a <span class="cItalic">shared-vertex mesh</span>. Logically, this data structure has triangles which point to vertices which contain the vertex data:</p>
<pre><span class="code">Triangle {</span></pre>
<pre><span class="code"> Vertex v[3]</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code"> vector3 position  // or other vertex data</span></pre>
<pre><span class="code">}</span></pre>
<p>Note that the entries in the v array are references, or pointers, to Vertex objects; the vertices are not contained in the triangle.</p>
<p>In implementation, the vertices and triangles are normally stored in arrays, with the triangle-to-vertex references handled by storing array indices:</p>
<pre><span class="code">IndexedMesh {</span></pre>
<pre><span class="code"> int tInd[nt][3]</span></pre>
<pre><span class="code"> vector3 verts[nv]</span></pre>
<pre><span class="code">}</span></pre>
<p>The index of the <span class="cItalic">k</span>th vertex of the <span class="cItalic">i</span>th triangle is found in tInd[i][k], and the position of that vertex is stored in the corresponding row of the verts array; see <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-8">Figure 12.8</a> for an example. This way of storing a shared-vertex mesh is an <span class="cItalic">indexed triangle mesh</span>.</p>
<div id="art_Dest_fig_12-7" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-7"></a><span class="cBold">Figure 12.7</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-7.png" alt="Figure showing the triangle-to-vertex references in a shared-vertex mesh." width="410" height="406" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-7.png"></p>
<p class="Text figcaption">The triangle-to-vertex references in a shared-vertex mesh.</p>
</div>
<div id="art_Dest_fig_12-8" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-8"></a><span class="cBold">Figure 12.8</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-8.png" alt="Figure showing a larger triangle mesh, with part of its representation as an indexed triangle mesh." width="600" height="300" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-8.png"></p>
<p class="Text figcaption">A larger triangle mesh, with part of its representation as an indexed triangle mesh.</p>
</div>
<p>Separate triangles or shared vertices will both work well. Is there a space advantage for sharing vertices? If our mesh has <span class="cItalic">n<span class="cSubscript">v</span></span> vertices and <span class="cItalic">n<span class="cSubscript">t</span></span> triangles, and if we assume that the data for floats, pointers, and ints all require the same storage (a dubious assumption), the space requirements are as follows:</p>
<ul>
<li class="LX"><a id="page_286"></a><span class="cBold">Triangle</span>. Three vectors per triangle, for <span class="cItalic">9n<span class="cSubscript">t</span></span> units of storage;</li>
<li class="LX"><span class="cBold">IndexedMesh</span>. One vector per vertex and three ints per triangle, for <span class="cItalic">3n<span class="cSubscript">v</span> </span>+ <span class="cItalic">3n<span class="cSubscript">t</span></span> units of storage.</li>
</ul>
<p>The relative storage requirements depend on the ratio of <span class="cItalic">n<span class="cSubscript">t</span></span> to <span class="cItalic">n<span class="cSubscript">v</span>.</span></p>
<p>As a rule of thumb, a large mesh has each vertex connected to about six triangles (although there can be any number for extreme cases). Since each triangle connects to three vertices, this means that there are generally twice as many triangles as vertices in a large mesh: <span class="cItalic">n<span class="cSubscript">t</span></span> ≈ <span class="cItalic">2n<span class="cSubscript">v</span>.</span> Making this substitution, we can conclude that the storage requirements are <span class="cItalic">18n<span class="cSubscript">v</span></span> for the Triangle structure and <span class="cItalic">9n<span class="cSubscript">v</span></span> for IndexedMesh. Using shared vertices reduces storage requirements by about a factor of two; and this seems to hold in practice for most implementations.</p>
<div class="Sidebar">
<p class="SidebarText">Is this factor of two worth the complication? I think the answer is yes, and it becomes an even bigger win as soon as you start adding “properties” to the vertices.</p>
</div>
<h3><a id="sec12-1-3"></a>12.1.3  Triangle Strips and Fans</h3>
<p>Indexed meshes are the most common in-memory representation of triangle meshes, because they achieve a good balance of simplicity, convenience, and compactness. They are also commonly used to transfer meshes over networks and between the application and graphics pipeline. In applications where even more compactness is desirable, the triangle vertex indices (which take up two-thirds of the space in an indexed mesh with only positions at the vertices) can be expressed more efficiently using <span class="cItalic">triangle strips</span> and <span class="cItalic">triangle fans</span>.</p>
<p>A triangle fan is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-9">Figure 12.9</a>. In an indexed mesh, the triangles array would contain [(0, 1, 2), (0, 2, 3), (0, 3, 4), (0, 4, 5)]. We are storing 12 vertex indices, although there are only six distinct vertices. In a triangle fan, all the triangles share one common vertex, and the other vertices generate a set of triangles like the vanes of a collapsible fan. The fan in the figure could be specified with the sequence [0, 1, 2, 3, 4, 5]: the first vertex establishes the center, and subsequently each pair of adjacent vertices (1-2, 2-3, etc.) creates a triangle.</p>
<div id="art_Dest_fig_12-9" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-9"></a><span class="cBold">Figure 12.9</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-9.png" alt="Figure showing a triangle fan." width="409" height="368" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-9.png"></p>
<p class="Text figcaption">A triangle fan.</p>
</div>
<p>The triangle strip is a similar concept, but it is useful for a wider range of meshes. Here, vertices are added alternating top and bottom in a linear strip as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-10">Figure 12.10</a>. The triangle strip in the figure could be specified by the sequence [0 1 2 3 4 5 6 7], and every subsequence of three adjacent vertices (0-1-2, 1-2-3, etc.) creates a triangle. For consistent orientation, every other triangle needs to have its order reversed. In the example, this results in the triangles (0, 1, 2), (2, 1, 3), (2, 3, 4), (4, 3, 5), etc. For each new vertex that comes in, the oldest vertex is forgotten and the order of the two remaining vertices is swapped. See <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-11">Figure 12.11</a> for a larger example.</p>
<div id="art_Dest_fig_12-10" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-10"></a><span class="cBold">Figure 12.10</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-10.png" alt="Figure showing a triangle strip." width="409" height="386" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-10.png"></p>
<p class="Text figcaption">A triangle strip.</p>
</div>
<div id="art_Dest_fig_12-11" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-11"></a><span class="cBold">Figure 12.11</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-11.png" alt="Figure showing two triangle strips in the context of a larger mesh. Note that neither strip can be extended to include the triangle marked with an asterisk." width="600" height="286" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-11.png"></p>
<p class="Text figcaption">Two triangle strips in the context of a larger mesh. Note that neither strip can be extended to include the triangle marked with an asterisk.</p>
</div>
<p><a id="page_287"></a>In both strips and fans, <span class="cBold"><span class="cItalic">n </span>+ 2</span> vertices suffice to describe <span class="cBold"><span class="cItalic">n </span></span>triangles—a substantial savings over the <span class="cBold">3<span class="cItalic">n </span></span>vertices required by a standard indexed mesh. Long triangle strips will save approximately a factor of three if the program is vertex-bound.</p>
<p>It might seem that triangle strips are only useful if the strips are very long, but even relatively short strips already gain most of the benefits. The savings in storage space (for only the vertex indices) are as follows:</p>
<div class="ArtGroup">
<div class="container">
<div class="component">
<table id="table002" class="overflow-y">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td><p class="Table">strip length</p></td>
<td><p class="Table">1</p></td>
<td><p class="Table">2</p></td>
<td><p class="Table">3</p></td>
<td><p class="Table">4</p></td>
<td><p class="Table">5</p></td>
<td><p class="Table">6</p></td>
<td><p class="Table">7</p></td>
<td><p class="Table">8</p></td>
<td><p class="Table">16</p></td>
<td><p class="Table">100</p></td>
<td><p class="Table">∞</p></td>
</tr>
<tr>
<td><p class="Table">relative size</p></td>
<td><p class="Table">1.00</p></td>
<td><p class="Table">0.67</p></td>
<td><p class="Table">0.56</p></td>
<td><p class="Table">0.50</p></td>
<td><p class="Table">0.47</p></td>
<td><p class="Table">0.44</p></td>
<td><p class="Table">0.43</p></td>
<td><p class="Table">0.42</p></td>
<td><p class="Table">0.38</p></td>
<td><p class="Table">0.34</p></td>
<td><p class="Table">0.33</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>So, in fact, there is a rather rapid diminishing return as the strips grow longer. Thus, even for an unstructured mesh, it is worthwhile to use some greedy algorithm to gather them into short strips.</p>
<h3><a id="sec12-1-4"></a>12.1.4  Data Structures for Mesh Connectivity</h3>
<p>Indexed meshes, strips, and fans are all good, compact representations for static meshes. However, they do not readily allow for meshes to be modified. In order to efficiently edit meshes, more complicated data structures are needed to efficiently answer queries such as:</p>
<ul>
<li class="LX">Given a triangle, what are the three adjacent triangles?</li>
<li class="LX">Given an edge, which two triangles share it?</li>
<li class="LX"><a id="page_288"></a>Given a vertex, which faces share it?</li>
<li class="LX">Given a vertex, which edges share it?</li>
</ul>
<p>There are many data structures for triangle meshes, polygonal meshes, and polygonal meshes with holes (see the notes at the end of the chapter for references). In many applications the meshes are very large, so an efficient representation can be crucial.</p>
<p>The most straightforward, though bloated, implementation would be to have three types, Vertex, Edge, and Triangle, and to just store all the relationships directly:</p>
<pre><span class="code">Triangle {</span></pre>
<pre><span class="code"> Vertex v[3]</span></pre>
<pre><span class="code"> Edge e[3]</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Edge {</span></pre>
<pre><span class="code"> Vertex v[2]</span></pre>
<pre><span class="code"> Triangle t[2]</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code"> Triangle t[]</span></pre>
<pre><span class="code"> Edge e[]</span></pre>
<pre><span class="code">}</span></pre>
<p>This lets us directly look up answers to the connectivity questions above, but because this information is all inter-related, it stores more than is really needed. Also, storing connectivity in vertices makes for variable-length data structures (since vertices can have arbitrary numbers of neighbors), which are generally less efficient to implement. Rather than committing to store all these relationships explicitly, it is best to define a class interface to answer these questions, behind which a more efficient data structure can hide. It turns out we can store only some of the connectivity and efficiently recover the other information when needed.</p>
<p>The fixed-size arrays in the <span class="code">Edge</span> and <span class="code">Triangle</span> classes suggest that it will be more efficient to store the connectivity information there. In fact, for polygon meshes, in which polygons have arbitrary numbers of edges and vertices, only edges have fixed-size connectivity information, which leads to many traditional mesh data structures being based on edges. But for triangle-only meshes, storing connectivity in the (less numerous) faces is appealing.</p>
<p>A good mesh data structure should be reasonably compact and allow efficient answers to all adjacency queries. Efficient means constant-time: the time to find neighbors should not depend on the size of the mesh. We’ll look at three data structures for meshes, one based on triangles and two based on edges.</p>
<h4><a id="sec12-1-4-1"></a><a id="page_289"></a>The Triangle-Neighbor Structure</h4>
<p>We can create a compact mesh data structure based on triangles by augmenting the basic shared-vertex mesh with pointers from the triangles to the three neighboring triangles, and a pointer from each vertex to one of the adjacent triangles (it doesn’t matter which one); see <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-12">Figure 12.12</a>:</p>
<div id="art_Dest_fig_12-12" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-12"></a><span class="cBold">Figure 12.12</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-12.png" alt="Figure showing the references between triangles and vertices in the triangle-neighbor structure." width="410" height="406" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-12.png"></p>
<p class="Text figcaption">The references between triangles and vertices in the triangle-neighbor structure.</p>
</div>
<pre><span class="code">Triangle {</span></pre>
<pre><span class="code"> Triangle nbr[3];</span></pre>
<pre><span class="code"> Vertex v[3];</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code"> // ... per-vertex data ...</span></pre>
<pre><span class="code"> Triangle t; // any adjacent tri</span></pre>
<pre><span class="code">}</span></pre>
<p>In the array Triangle.nbr, the <span class="cItalic">k</span>th entry points to the neighboring triangle that shares vertices <span class="cItalic">k</span> and <span class="cItalic">k </span>+ 1. We call this structure the <span class="cItalic">triangle-neighbor structure</span>. Starting from standard indexed mesh arrays, it can be implemented with two additional arrays: one that stores the three neighbors of each triangle, and one that stores a single neighboring triangle for each vertex (see <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-13">Figure 12.13</a> for an example):</p>
<div id="art_Dest_fig_12-13" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-13"></a><span class="cBold">Figure 12.13</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-13.png" alt="Figure showing the triangle-neighbor structure as encoded in arrays, and the sequence that is followed in traversing the neighboring triangles of vertex 2." width="600" height="296" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-13.png"></p>
<p class="Text figcaption">The triangle-neighbor structure as encoded in arrays, and the sequence that is followed in traversing the neighboring triangles of vertex 2.</p>
</div>
<pre><span class="code">Mesh {</span></pre>
<pre><span class="code"> // ... per-vertex data ...</span></pre>
<pre><span class="code"> int tInd[nt][3]; // vertex indices</span></pre>
<pre><span class="code"> int tNbr[nt][3]; // indices of neighbor triangles</span></pre>
<pre><span class="code"> int vTri[nv]; // index of any adjacent triangle</span></pre>
<pre><span class="code">}</span></pre>
<p><a id="page_290"></a>Clearly the neighboring triangles and vertices of a triangle can be found directly in the data structure, but by using this triangle adjacency information carefully it is also possible to answer connectivity queries about vertices in constant time. The idea is to move from triangle to triangle, visiting only the triangles adjacent to the relevant vertex. If triangle <span class="cItalic">t</span> has vertex <span class="cItalic">v</span> as its <span class="cItalic">k</span>th vertex, then the triangle t.nbr[<span class="cItalic">k</span>] is the next triangle around <span class="cItalic">v</span> in the clockwise direction. This observation leads to the following algorithm to traverse all the triangles adjacent to a given vertex:</p>
<div class="Sidebar">
<p class="SidebarText">Of course, a real program would <span class="cItalic">do</span> something with the triangles as it found them.</p>
</div>
<pre><span class="code">TrianglesOfVertex(v) {</span></pre>
<pre><span class="code"> t = v.t</span></pre>
<pre><span class="code"> do {</span></pre>
<pre><span class="code"> find i such that (t.v[i] == v)</span></pre>
<pre><span class="code"> t = t.nbr[i]</span></pre>
<pre><span class="code">} while (t != v.t)</span></pre>
<pre><span class="code">}</span></pre>
<p>This operation finds each subsequent triangle in constant time—even though a search is required to find the position of the central vertex in each triangle’s vertex list, the vertex lists have constant size so the search takes constant time. However, that search is awkward and requires extra branching.</p>
<p>A small refinement can avoid these searches. The problem is that once we follow a pointer from one triangle to the next, we don’t know from which way we came: we have to search the triangle’s vertices to find the vertex that connects back to the previous triangle. To solve this, instead of storing pointers to neighboring triangles, we can store pointers to specific edges of those triangles by storing an index with the pointer:</p>
<pre><span class="code">Triangle {</span></pre>
<pre><span class="code">  Edge nbr[3];</span></pre>
<pre><span class="code">  Vertex v[3];</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Edge {// the i-th edge of triangle t</span></pre>
<pre><span class="code"> Triangle t;</span></pre>
<pre><span class="code"> int i; // in {0,1,2}</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code"> // ... per-vertex data ...</span></pre>
<pre><span class="code"> Edge e; // any edge leaving vertex</span></pre>
<pre><span class="code">}</span></pre>
<p>In practice the Edge is stored by borrowing two bits of storage from the triangle index <span class="cItalic">t</span> to store the edge index <span class="cItalic">i</span>, so that the total storage requirements remain the same.</p>
<p><a id="page_291"></a>In this structure the neighbor array for a triangle tells <span class="cItalic">which</span> of the neighboring triangles’ edges are shared with the three edges of that triangle. With this extra information, we always know where to find the original triangle, which leads to an invariant of the data structure: for any <span class="cItalic">j</span>th edge of any triangle <span class="cItalic">t</span>,</p>
<pre><span class="code"><span class="cItalic">t</span>.nbr[<span class="cItalic">j</span>].t.nbr[<span class="cItalic">t</span>.nbr[<span class="cItalic">j</span>].i].t == <span class="cItalic">t</span>.</span></pre>
<p>Knowing which edge we came in through lets us know immediately which edge to leave through in order to continue traversing around a vertex, leading to a streamlined algorithm:</p>
<pre><span class="code">TrianglesOfVertex(v) {</span></pre>
<pre><span class="code">  {t, i} = v.e;</span></pre>
<pre><span class="code">  do {</span></pre>
<pre><span class="code">  {t, i} = t.nbr[i];</span></pre>
<pre><span class="code">  i = (i+1) mod 3;</span></pre>
<pre><span class="code"> } while (t != v.e.t);</span></pre>
<pre><span class="code">}</span></pre>
<p>The triangle-neighbor structure is quite compact. For a mesh with only vertex positions, we are storing four numbers (three coordinates and an edge) per vertex and six (three vertex indices and three edges) per face, for a total of 4<span class="cItalic">n<span class="cSubscript">v</span></span> + 6<span class="cItalic">n<span class="cSubscript">t</span> ≈ </span>16<span class="cItalic">n<span class="cSubscript">v</span></span> units of storage per vertex, compared with 9<span class="cItalic">n<span class="cSubscript">v</span></span> for the basic indexed mesh.</p>
<p>The triangle neighbor structure as presented here works only for manifold meshes, because it depends on returning to the starting triangle to terminate the traversal of a vertex’s neighbors, which will not happen at a boundary vertex that doesn’t have a full cycle of triangles. However, it is not difficult to generalize it to manifolds with boundary, by introducing a suitable sentinel value (such as ‒1) for the neighbors of boundary triangles and taking care that the boundary vertices point to the most counterclockwise neighboring triangle, rather than to any arbitrary triangle.</p>
<h4><a id="sec12-1-4-2"></a>The Winged-Edge Structure</h4>
<p>One widely used mesh data structure that stores connectivity information at the edges instead of the faces is the <span class="cItalic">winged-edge</span> data structure. This data structure makes edges the first-class citizen of the data structure, as illustrated in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-14">Figures 12.14</a> and <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-15">12.15</a>.</p>
<div id="art_Dest_fig_12-14" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-14"></a><span class="cBold">Figure 12.14</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-14.png" alt="Figure showing an example of a winged-edge mesh structure, stored in arrays." width="600" height="283" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-14.png"></p>
<p class="Text figcaption">An example of a winged-edge mesh structure, stored in arrays.</p>
</div>
<div id="art_Dest_fig_12-15" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-15"></a><span class="cBold">Figure 12.15</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-15.png" alt="Figure showing a tetrahedron and the associated elements for a winged-edge data structure. The two small tables are not unique; each vertex and face stores any one of the edges with which it is associated." width="600" height="800" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-15.png"></p>
<p class="Text figcaption">A tetrahedron and the associated elements for a winged-edge data structure. The two small tables are not unique; each vertex and face stores any one of the edges with which it is associated.</p>
</div>
<p>In a winged-edge mesh, each edge stores pointers to the two vertices it connects (the <span class="cItalic">head</span> and <span class="cItalic">tail</span> vertices), the two faces it is part of (the <span class="cItalic">left</span> and <span class="cItalic">right</span> faces), and, most importantly, the next and previous edges in the counterclockwise traversal of its left and right faces (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-16">Figure 12.16</a>). Each vertex and face also stores a pointer to a single, arbitrary edge that connects to it:</p>
<div id="art_Dest_fig_12-16" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-16"></a><span class="cBold">Figure 12.16</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-16.png" alt="Figure showing the references from an edge to the neighboring edges, faces, and vertices in the winged-edge structure." width="410" height="406" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-16.png"></p>
<p class="Text figcaption">The references from an edge to the neighboring edges, faces, and vertices in the winged-edge structure.</p>
</div>
<pre><span class="code"><a id="page_292"></a><a id="page_293"></a>Edge {</span></pre>
<pre><span class="code">  Edge lprev, lnext, rprev, rnext;</span></pre>
<pre><span class="code">  Vertex head, tail;</span></pre>
<pre><span class="code">  Face left, right;</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Face {</span></pre>
<pre><span class="code">  // ... per-face data ...</span></pre>
<pre><span class="code">  Edge e; // any adjacent edge</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code">  // ... per-vertex data ...</span></pre>
<pre><span class="code">  Edge e; // any incident edge</span></pre>
<pre><span class="code">}</span></pre>
<p>The winged-edge data structure supports constant-time access to the edges of a face or of a vertex, and from those edges the adjoining vertices or faces can be found:</p>
<pre><span class="code">EdgesOfVertex(v) {</span></pre>
<pre><span class="code"> e = v.e;</span></pre>
<pre><span class="code"> do {</span></pre>
<pre><span class="code"> if (e.tail == v)</span></pre>
<pre><span class="code">   e = e.lprev;</span></pre>
<pre><span class="code"> else</span></pre>
<pre><span class="code">   e = e.rprev;</span></pre>
<pre><span class="code">} while (e != v.e);</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">EdgesOfFace(f) {</span></pre>
<pre><span class="code">  e = f.e;</span></pre>
<pre><span class="code">  do {</span></pre>
<pre><span class="code">  if (e.left == f)</span></pre>
<pre><span class="code">  e = e.lnext;</span></pre>
<pre><span class="code">  else</span></pre>
<pre><span class="code">  e = e.rnext;</span></pre>
<pre><span class="code">} while (e != f.e);</span></pre>
<pre><span class="code">}</span></pre>
<p>These same algorithms and data structures will work equally well in a polygon mesh that isn’t limited to triangles; this is one important advantage of edge-based structures.</p>
<p>As with any data structure, the winged-edge data structure makes a variety of time/space tradeoffs. For example, we can eliminate the prev references. This makes it more difficult to traverse clockwise around faces or counterclockwise around vertices, but when we need to know the previous edge, we can always follow the successor edges in a circle until we get back to the original edge. This saves space, but it makes some operations slower. (See the chapter notes for more information on these tradeoffs).</p>
<h4><a id="sec12-1-4-3"></a><a id="page_294"></a>The Half-Edge Structure</h4>
<p>The winged-edge structure is quite elegant, but it has one remaining awkwardness—the need to constantly check which way the edge is oriented before moving to the next edge. This check is directly analogous to the search we saw in the basic version of the triangle neighbor structure: we are looking to find out whether we entered the present edge from the head or from the tail. The solution is also almost indistinguishable: rather than storing data for each edge, we store data for each <span class="cItalic">half-edge</span>. There is one half-edge for each of the two triangles that share an edge, and the two half-edges are oriented oppositely, each oriented consistently with its own triangle.</p>
<p>The data normally stored in an edge is split between the two half-edges. Each half-edge points to the face on its side of the edge and to the vertex at its head, and each contains the edge pointers for its face. It also points to its neighbor on the other side of the edge, from which the other half of the information can be found. Like the winged-edge, a half-edge can contain pointers to both the previous and next half-edges around its face, or only to the next half-edge. We’ll show the example that uses a single pointer.</p>
<pre><span class="code">HEdge {</span></pre>
<pre><span class="code">  HEdge pair, next;</span></pre>
<pre><span class="code">  Vertex v;</span></pre>
<pre><span class="code">  Face f;</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Face {</span></pre>
<pre><span class="code">  // ... per-face data ...</span></pre>
<pre><span class="code">  HEdge h; // any h-edge of this face</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code">Vertex {</span></pre>
<pre><span class="code">  // ... per-vertex data ...</span></pre>
<pre><span class="code">  HEdge h; // any h-edge pointing toward this vertex</span></pre>
<pre><span class="code">}</span></pre>
<p>Traversing a half-edge structure is just like traversing a winged-edge structure except that we no longer need to check orientation, and we follow the pair pointer to access the edges in the opposite face.</p>
<pre><span class="code">EdgesOfVertex(v) {</span></pre>
<pre><span class="code">  h = v.h;</span></pre>
<pre><span class="code">  do {</span></pre>
<pre><span class="code">  h = h.pair.next;</span></pre>
<pre><span class="code">} while (h != v.h);</span></pre>
<pre><span class="code">}</span></pre>
<pre><span class="code"><a id="page_295"></a>EdgesOfFace(f) {</span></pre>
<pre><span class="code"> h = f.h;</span></pre>
<pre><span class="code"> do {</span></pre>
<pre><span class="code"> h = h.next;</span></pre>
<pre><span class="code">} while (h != f.h);</span></pre>
<pre><span class="code">}</span></pre>
<p>The vertex traversal here is clockwise, which is necessary because of omitting the prev pointer from the structure.</p>
<p>Because half-edges are generally allocated in pairs (at least in a mesh with no boundaries), many implementations can do away with the pair pointers. For instance, in an implementation based on array indexing (such as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-18">Figure 12.18</a>), the array can be arranged so that an even-numbered edge <span class="cItalic">i</span> always pairs with edge <span class="cItalic">i</span> + 1 and an odd-numbered edge <span class="cItalic">j</span> always pairs with edge <span class="cItalic">j</span> − 1.</p>
<div id="art_Dest_fig_12-17" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-17"></a><span class="cBold">Figure 12.17</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-17.png" alt="Figure showing the references from a half-edge to its neighboring mesh components." width="409" height="405" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-17.png"></p>
<p class="Text figcaption">The references from a half-edge to its neighboring mesh components.</p>
</div>
<div id="art_Dest_fig_12-18" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-18"></a><span class="cBold">Figure 12.18</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-18.png" alt="Figure showing an example of a half-edge mesh structure, stored in arrays." width="600" height="286" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-18.png"></p>
<p class="Text figcaption">An example of a half-edge mesh structure, stored in arrays.</p>
</div>
<p>In addition to the simple traversal algorithms shown in this chapter, all three of these mesh topology structures can support “mesh surgery” operations of various sorts, such as splitting or collapsing vertices, swapping edges, adding or removing triangles, etc.</p>
<h2><a id="sec12-2"></a>12.2 Scene Graphs</h2>
<p>A triangle mesh manages a collection of triangles that constitute an object in a scene, but another universal problem in graphics applications is arranging the objects in the desired positions. As we saw in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C006.xhtml">Chapter 6</a>, this is done using transformations, but complex scenes can contain a great many transformations and organizing them well makes the scene much easier to manipulate. Most scenes admit to a hierarchical organization, and the transformations can be managed according to this hierarchy using a <span class="cItalic">scene graph</span>.</p>
<p><a id="page_296"></a>To motivate the scene-graph data structure, we will use the hinged pendulum shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-19">Figure 12.19</a>. Consider how we would draw the top part of the pendulum:</p>
<div id="art_Dest_fig_12-19" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-19"></a><span class="cBold">Figure 12.19</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-19.png" alt="Figure showing a hinged pendulum. On the left are the two pieces in their “local” coordinate systems. The hinge of the bottom piece is at point b and the attachment for the bottom piece is at its local origin. The degrees of freedom for the assembled object are the angles (θ, ϕ) and the location p of the top hinge." width="600" height="246" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-19.png"></p>
<p class="Text figcaption">A hinged pendulum. On the left are the two pieces in their “local” coordinate systems. The hinge of the bottom piece is at point <span class="cBold">b</span> and the attachment for the bottom piece is at its local origin. The degrees of freedom for the assembled object are the angles (<span class="cItalic">θ</span>, <span class="cItalic">ϕ</span>) and the location <span class="cBold">p</span> of the top hinge.</p>
</div>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-403-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_498&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mtext&gt;1&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;rotate&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x3B8;&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mtext&gt;2&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;translate&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtext&gt;p&lt;/mtext&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mtext&gt;3&lt;/mtext&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_498" overflow="scroll" style="width: 9.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.846em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-0.255em, 1008.6em, 4.013em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22205"><span class="mtable" id="MathJax-Span-22206" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 8.537em; height: 0px;"><span style="position: absolute; clip: rect(2.573em, 1001.35em, 6.686em, -1000.01em); top: -4.83em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1001.35em, 4.321em, -1000.01em); top: -5.447em; right: 0em;"><span class="mtd" id="MathJax-Span-22207"><span class="mrow" id="MathJax-Span-22208"><span class="mrow" id="MathJax-Span-22209"><span class="msub" id="MathJax-Span-22210"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22211" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mtext" id="MathJax-Span-22212" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.35em, 4.321em, -1000.01em); top: -3.956em; right: 0em;"><span class="mtd" id="MathJax-Span-22222"><span class="mrow" id="MathJax-Span-22223"><span class="mrow" id="MathJax-Span-22224"><span class="msub" id="MathJax-Span-22225"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22226" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mtext" id="MathJax-Span-22227" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.35em, 4.321em, -1000.01em); top: -2.465em; right: 0em;"><span class="mtd" id="MathJax-Span-22237"><span class="mrow" id="MathJax-Span-22238"><span class="mrow" id="MathJax-Span-22239"><span class="msub" id="MathJax-Span-22240"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22241" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mtext" id="MathJax-Span-22242" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.836em;"></span></span><span style="position: absolute; clip: rect(2.573em, 1006.28em, 6.738em, -1000.01em); top: -4.882em; left: 2.162em;"><span style="display: inline-block; position: relative; width: 6.378em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1004.95em, 4.424em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-22213"><span class="mrow" id="MathJax-Span-22214"><span class="mrow" id="MathJax-Span-22215"><span class="mo" id="MathJax-Span-22216" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-22217" style="font-family: MathJax_Main; padding-left: 0.26em;">rotate</span><span class="mrow" id="MathJax-Span-22218" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22219" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-22220" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-22221" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1006.28em, 4.424em, -1000.01em); top: -3.956em; left: 0em;"><span class="mtd" id="MathJax-Span-22228"><span class="mrow" id="MathJax-Span-22229"><span class="mrow" id="MathJax-Span-22230"><span class="mo" id="MathJax-Span-22231" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-22232" style="font-family: MathJax_Main; padding-left: 0.26em;">translate</span><span class="mrow" id="MathJax-Span-22233" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22234" style="font-family: MathJax_Main;">(</span><span class="mtext" id="MathJax-Span-22235" style="font-family: MathJax_Main;">p</span><span class="mo" id="MathJax-Span-22236" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1003.71em, 4.321em, -1000.01em); top: -2.465em; left: 0em;"><span class="mtd" id="MathJax-Span-22243"><span class="mrow" id="MathJax-Span-22244"><span class="mrow" id="MathJax-Span-22245"><span class="mo" id="MathJax-Span-22246" style="font-family: MathJax_Main;">=</span><span class="msub" id="MathJax-Span-22247" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22248" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mn" id="MathJax-Span-22249" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-22250"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22251" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mn" id="MathJax-Span-22252" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.887em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.851em; border-left: 0px solid; width: 0px; height: 4.186em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_498"><mtable><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>1</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>rotate</mtext><mrow><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>2</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>translate</mtext><mrow><mo>(</mo><mtext>p</mtext><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>3</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mn>2</mn></msub><msub><mtext>M</mtext><mn>1</mn></msub></mrow></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-403"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_498"><mtable><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>1</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>rotate</mtext><mrow><mo>(</mo><mi>θ</mi><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>2</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>translate</mtext><mrow><mo>(</mo><mtext>p</mtext><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mtext>3</mtext></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mn>2</mn></msub><msub><mtext>M</mtext><mn>1</mn></msub></mrow></mtd></mtr></mtable></math></script></p>
<p>Apply <span class="cBold">M</span><span class="cSubscript">3</span> to all points in upper pendulum</p>
<p>The bottom is more complicated, but we can take advantage of the fact that it is attached to the bottom of the upper pendulum at point <span class="cBold">b</span> in the local coordinate system. First, we rotate the lower pendulum so that it is at an angle <span class="cItalic">ϕ</span> relative to its initial position. Then, we move it so that its top hinge is at point <span class="cBold">b</span>. Now it is at the appropriate position in the local coordinates of the upper pendulum, and it can then be moved along with that coordinate system. The composite transform for the lower pendulum is:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-404-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_499&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;rotate&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x3D5;&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;translate&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mtext&gt;b&lt;/mtext&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mtext&gt;M&lt;/mtext&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_499" overflow="scroll" style="width: 9.103em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.846em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-0.974em, 1008.6em, 4.733em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22254"><span class="mrow" id="MathJax-Span-22255"><span class="mtable" id="MathJax-Span-22256" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 8.537em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1001.35em, 8.794em, -1000.01em); top: -6.219em; left: 0em;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1001.35em, 4.321em, -1000.01em); top: -6.167em; right: 0em;"><span class="mtd" id="MathJax-Span-22257"><span class="mrow" id="MathJax-Span-22258"><span class="mrow" id="MathJax-Span-22259"><span class="msub" id="MathJax-Span-22260"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22261" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22262" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.3em, 4.321em, -1000.01em); top: -4.676em; right: 0em;"><span class="mtd" id="MathJax-Span-22272"><span class="mrow" id="MathJax-Span-22273"><span class="mrow" id="MathJax-Span-22274"><span class="msub" id="MathJax-Span-22275"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22276" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22277" style="font-size: 70.7%; font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.3em, 4.321em, -1000.01em); top: -3.185em; right: 0em;"><span class="mtd" id="MathJax-Span-22287"><span class="mrow" id="MathJax-Span-22288"><span class="mrow" id="MathJax-Span-22289"><span class="msub" id="MathJax-Span-22290"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22291" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22292" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.35em, 4.321em, -1000.01em); top: -1.746em; right: 0em;"><span class="mtd" id="MathJax-Span-22303"><span class="mrow" id="MathJax-Span-22304"><span class="mrow" id="MathJax-Span-22305"><span class="msub" id="MathJax-Span-22306"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22307" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22308" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.224em;"></span></span><span style="position: absolute; clip: rect(3.293em, 1006.28em, 8.897em, -1000.01em); top: -6.321em; left: 2.162em;"><span style="display: inline-block; position: relative; width: 6.378em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1005.1em, 4.424em, -1000.01em); top: -6.167em; left: 0em;"><span class="mtd" id="MathJax-Span-22263"><span class="mrow" id="MathJax-Span-22264"><span class="mrow" id="MathJax-Span-22265"><span class="mo" id="MathJax-Span-22266" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-22267" style="font-family: MathJax_Main; padding-left: 0.26em;">rotate</span><span class="mrow" id="MathJax-Span-22268" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22269" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-22270" style="font-family: MathJax_Math-italic;">ϕ</span><span class="mo" id="MathJax-Span-22271" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1006.28em, 4.424em, -1000.01em); top: -4.676em; left: 0em;"><span class="mtd" id="MathJax-Span-22278"><span class="mrow" id="MathJax-Span-22279"><span class="mrow" id="MathJax-Span-22280"><span class="mo" id="MathJax-Span-22281" style="font-family: MathJax_Main;">=</span><span class="mtext" id="MathJax-Span-22282" style="font-family: MathJax_Main; padding-left: 0.26em;">translate</span><span class="mrow" id="MathJax-Span-22283" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22284" style="font-family: MathJax_Main;">(</span><span class="mtext" id="MathJax-Span-22285" style="font-family: MathJax_Main;">b</span><span class="mo" id="MathJax-Span-22286" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1003.71em, 4.321em, -1000.01em); top: -3.185em; left: 0em;"><span class="mtd" id="MathJax-Span-22293"><span class="mrow" id="MathJax-Span-22294"><span class="mrow" id="MathJax-Span-22295"><span class="mo" id="MathJax-Span-22296" style="font-family: MathJax_Main;">=</span><span class="msub" id="MathJax-Span-22297" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22298" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22299" style="font-size: 70.7%; font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-22300"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22301" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22302" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1003.66em, 4.321em, -1000.01em); top: -1.746em; left: 0em;"><span class="mtd" id="MathJax-Span-22309"><span class="mrow" id="MathJax-Span-22310"><span class="mrow" id="MathJax-Span-22311"><span class="mo" id="MathJax-Span-22312" style="font-family: MathJax_Main;">=</span><span class="msub" id="MathJax-Span-22313" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.339em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22314" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mn" id="MathJax-Span-22315" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-22316"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtext" id="MathJax-Span-22317" style="font-family: MathJax_Main;">M</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.928em;"><span class="mi" id="MathJax-Span-22318" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.327em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.592em; border-left: 0px solid; width: 0px; height: 5.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_499"><mrow><mtable><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>a</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>rotate</mtext><mrow><mo>(</mo><mi>ϕ</mi><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>b</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>translate</mtext><mrow><mo>(</mo><mtext>b</mtext><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>c</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mi>b</mi></msub><msub><mtext>M</mtext><mi>a</mi></msub></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>d</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mn>3</mn></msub><msub><mtext>M</mtext><mi>c</mi></msub></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-404"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_499"> <mrow><mtable><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>a</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>rotate</mtext><mrow><mo>(</mo><mi>ϕ</mi><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>b</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mtext>translate</mtext><mrow><mo>(</mo><mtext>b</mtext><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>c</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mi>b</mi></msub><msub><mtext>M</mtext><mi>a</mi></msub></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mtext>M</mtext><mi>d</mi></msub></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msub><mtext>M</mtext><mn>3</mn></msub><msub><mtext>M</mtext><mi>c</mi></msub></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p>Apply <span class="cBold">M</span><span class="cItalic">d</span> to all points in lower pendulum</p>
<p>Thus, we see that the lower pendulum not only lives in its own local coordinate system, but also that coordinate system itself is moved along with that of the upper pendulum.</p>
<p>We can encode the pendulum in a data structure that makes management of these coordinate system issues easier, as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-20">Figure 12.20</a>. The appropriate matrix to apply to an object is just the product of all the matrices in the chain from <a id="page_297"></a>the object to the root of the data structure. For example, consider the model of a ferry that has a car that can move freely on the deck of the ferry, and wheels that each move relative to the car as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-21">Figure 12.21</a>.</p>
<div id="art_Dest_fig_12-20" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-20"></a><span class="cBold">Figure 12.20</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-20.png" alt="Figure showing the scene graph for the hinged pendulum of Figure 12.19." width="368" height="800" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-20.png"></p>
<p class="Text figcaption">The scene graph for the hinged pendulum of <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-19">Figure 12.19</a>.</p>
</div>
<div id="art_Dest_fig_12-21" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-21"></a><span class="cBold">Figure 12.21</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-21.png" alt="Figure showing a ferry, a car on the ferry, and the wheels of the car (only two shown) are stored in a scene-graph." width="410" height="786" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-21.png"></p>
<p class="Text figcaption">A ferry, a car on the ferry, and the wheels of the car (only two shown) are stored in a scene-graph.</p>
</div>
<p>As with the pendulum, each object should be transformed by the product of the matrices in the path from the root to the object:</p>
<ul>
<li class="LX"><span class="cBold">ferry</span> transform using <span class="cItalic">M</span><span class="cSubscript">0</span>;</li>
<li class="LX"><span class="cBold">car body</span> transform using <span class="cItalic">M</span><span class="cSubscript">0</span><span class="cItalic">M</span><span class="cSubscript">1</span>;</li>
<li class="LX"><span class="cBold">left wheel</span> transform using <span class="cItalic">M</span><span class="cSubscript">0</span><span class="cItalic">M</span><span class="cSubscript">1</span><span class="cItalic">M</span><span class="cSubscript">2</span>;</li>
<li class="LX"><span class="cBold">left wheel</span> transform using <span class="cItalic">M</span><span class="cSubscript">0</span><span class="cItalic">M</span><span class="cSubscript">1</span><span class="cItalic">M</span><span class="cSubscript">3</span>.</li>
</ul>
<p>An efficient implementation can be achieved using a <span class="cItalic">matrix stack,</span> a data structure supported by many APIs. A matrix stack is manipulated using <span class="cItalic">push</span> and <span class="cItalic">pop</span> operations that add and delete matrices from the right-hand side of a matrix product. For example, calling:</p>
<pre><span class="code">push(<span class="cBold">M</span><span class="cSubscript">0</span>)</span></pre>
<pre><span class="code">push(<span class="cBold">M</span><span class="cSubscript">1</span>)</span></pre>
<pre><span class="code">push(<span class="cBold">M</span><span class="cSubscript">2</span>)</span></pre>
<p>creates the active matrix <span class="cBold">M</span> = <span class="cBold">M</span><span class="cSubscript">0</span><span class="cBold">M</span><span class="cSubscript">1</span><span class="cBold">M</span><span class="cSubscript">2</span>. A subsequent call to <span class="cItalic">pop()</span> strips the last matrix added so that the active matrix becomes <span class="cBold">M</span> = <span class="cBold">M</span><span class="cSubscript">0</span><span class="cBold">M</span><span class="cSubscript">1</span>. Combining the matrix stack with a recursive traversal of a scene graph gives us:</p>
<pre><span class="code"><span class="cBold">function</span> traverse(node)</span></pre>
<pre><span class="code">push(<span class="cBold">M</span><span class="cSubscript">local</span>)</span></pre>
<pre><span class="code">draw object using composite matrix from stack</span></pre>
<pre><span class="code">traverse(left child)</span></pre>
<pre><span class="code">traverse(right child)</span></pre>
<pre><span class="code">pop()</span></pre>
<p>There are many variations on scene graphs but all follow the basic idea above.</p>
<h2><a id="sec12-3"></a>12.3 Spatial Data Structures</h2>
<p>In many, if not all, graphics applications, the ability to quickly locate geometric objects in particular regions of space is important. Ray tracers need to find objects that intersect rays; interactive applications navigating an environment need to find the objects visible from any given viewpoint; games and physical simulations require detecting when and where objects collide. All these needs can be supported <a id="page_298"></a>by various <span class="cItalic">spatial data structures</span> designed to organize objects in space so they can be looked up efficiently.</p>
<p>In this section we will discuss examples of three general classes of spatial data structures. Structures that group objects together into a hierarchy are <span class="cItalic">object partitioning</span> schemes: objects are divided into disjoint groups, but the groups may end up overlapping in space. Structures that divide space into disjoint regions are <span class="cItalic">space partitioning</span> schemes: space is divided into separate partitions, but one object may have to intersect more than one partition. Space partitioning schemes can be regular, in which space is divided into uniformly shaped pieces, or irregular, in which space is divided adaptively into irregular pieces, with smaller pieces where there are more and smaller objects.</p>
<p>We will use ray tracing as the primary motivation while discussing these structures, though they can all also be used for view culling or collision detection. In <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C004.xhtml">Chapter 4</a>, all objects were looped over while checking for intersections. For <span class="cItalic">N</span> objects, this is an <span class="cItalic">O</span>(<span class="cItalic">N</span>) linear search and is thus slow for large scenes. Like most search problems, the ray-object intersection can be computed in sub-linear time using “divide and conquer” techniques, provided we can create an ordered data structure as a preprocess. There are many techniques to do this.</p>
<p>This section discusses three of these techniques in detail: bounding volume hierarchies (Rubin &amp; Whitted, 1980; Whitted, 1980; Goldsmith &amp; Salmon, 1987), uniform spatial subdivision (Cleary, Wyvill, Birtwistle, &amp; Vatti, 1983; Fujimoto, Tanaka, &amp; Iwata, 1986; Amanatides &amp; Woo, 1987), and binary space partitioning (Glassner, 1984; Jansen, 1986; Havran, 2000). An example of the first two strategies is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-22">Figure 12.22</a>.</p>
<div id="art_Dest_fig_12-22" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-22"></a><span class="cBold">Figure 12.22</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-22.png" alt="Figure showing left: a uniform partitioning of space. Right: adaptive bounding-box hierarchy." width="600" height="298" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-22.png"></p>
<p class="Text figcaption">Left: a uniform partitioning of space. Right: adaptive bounding-box hierarchy.</p>
<p class="Text figsource"><span class="cItalic">Image courtesy David DeMarle.</span></p>
</div>
<h3><a id="sec12-3-1"></a><a id="page_299"></a>12.3.1 Bounding Boxes</h3>
<p>A key operation in most intersection-acceleration schemes is computing the intersection of a ray with a bounding box (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-23">Figure 12.23</a>). This differs from conventional intersection tests in that we do not need to know where the ray hits the box; we only need to know whether it hits the box.</p>
<div id="art_Dest_fig_12-23" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-23"></a><span class="cBold">Figure 12.23</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-23.png" alt="Figure showing the ray is only tested for intersection with the surfaces if it hits the bounding box." width="410" height="343" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-23.png"></p>
<p class="Text figcaption">The ray is only tested for intersection with the surfaces if it hits the bounding box.</p>
</div>
<p>To build an algorithm for ray-box intersection, we begin by considering a 2D ray whose direction vector has positive <span class="cItalic">x</span> and <span class="cItalic">y</span> components. We can generalize this to arbitrary 3D rays later. The 2D bounding box is defined by two horizontal and two vertical lines:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-405-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_500&quot;&gt;&lt;mtable columnalign=&quot;left&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;max&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;max&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_500" overflow="scroll" style="width: 5.298em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.144em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-1.283em, 1004.9em, 4.99em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22320"><span class="mtable" id="MathJax-Span-22321" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 4.836em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1004.74em, 9.463em, -1000.01em); top: -6.578em; left: 0em;"><span style="display: inline-block; position: relative; width: 4.836em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1004.64em, 4.527em, -1000.01em); top: -6.424em; left: 0em;"><span class="mtd" id="MathJax-Span-22322"><span class="mrow" id="MathJax-Span-22323"><span class="mi" id="MathJax-Span-22324" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-22325" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-22326" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 2.522em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22327" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.568em;"><span class="mrow" id="MathJax-Span-22328"><span class="mi" id="MathJax-Span-22329" style="font-size: 70.7%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22330" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22331" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1004.74em, 4.527em, -1000.01em); top: -4.83em; left: 0em;"><span class="mtd" id="MathJax-Span-22332"><span class="mrow" id="MathJax-Span-22333"><span class="mi" id="MathJax-Span-22334" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-22335" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-22336" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 2.676em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22337" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.568em;"><span class="mrow" id="MathJax-Span-22338"><span class="mi" id="MathJax-Span-22339" style="font-size: 70.7%; font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-22340" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22341" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1004.48em, 4.527em, -1000.01em); top: -3.237em; left: 0em;"><span class="mtd" id="MathJax-Span-22342"><span class="mrow" id="MathJax-Span-22343"><span class="mi" id="MathJax-Span-22344" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22345" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-22346" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 2.47em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22347" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.517em;"><span class="mrow" id="MathJax-Span-22348"><span class="mi" id="MathJax-Span-22349" style="font-size: 70.7%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22350" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22351" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1004.59em, 4.527em, -1000.01em); top: -1.643em; left: 0em;"><span class="mtd" id="MathJax-Span-22352"><span class="mrow" id="MathJax-Span-22353"><span class="mi" id="MathJax-Span-22354" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22355" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-22356" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 2.573em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22357" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.517em;"><span class="mrow" id="MathJax-Span-22358"><span class="mi" id="MathJax-Span-22359" style="font-size: 70.7%; font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-22360" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22361" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.584em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.857em; border-left: 0px solid; width: 0px; height: 6.252em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_500"><mtable columnalign="left"><mtr><mtd><mi>x</mi><mo>=</mo><msub><mi>x</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>x</mi><mo>=</mo><msub><mi>x</mi><mrow><mi>max</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>y</mi><mo>=</mo><msub><mi>y</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>y</mi><mo>=</mo><msub><mi>y</mi><mrow><mi>max</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-405"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_500"><mtable columnalign="left"><mtr><mtd><mi>x</mi><mo>=</mo><msub><mi>x</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>x</mi><mo>=</mo><msub><mi>x</mi><mrow><mi>max</mi><mo> ​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>y</mi><mo>=</mo><msub><mi>y</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>,</mo></mtd></mtr><mtr><mtd><mi>y</mi><mo>=</mo><msub><mi>y</mi><mrow><mi>max</mi><mo> ​⁡</mo></mrow></msub><mo>.</mo></mtd></mtr></mtable></math></script></p>
<p>The points bounded by these lines can be described in interval notation:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-406-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_501&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;max&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;max&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_501" overflow="scroll" style="width: 18.409em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.843em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1017.75em, 2.728em, -1000.01em); top: -2.208em; left: 0em;"><span class="mrow" id="MathJax-Span-22363"><span class="mrow" id="MathJax-Span-22364"><span class="mrow" id="MathJax-Span-22365"><span class="mo" id="MathJax-Span-22366" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22367"><span class="mi" id="MathJax-Span-22368" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-22369" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-22370" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span class="mo" id="MathJax-Span-22371" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22372" style="font-family: MathJax_Main; padding-left: 0.26em;">∈</span><span class="mrow" id="MathJax-Span-22373" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22374" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">[</span></span><span class="mrow" id="MathJax-Span-22375"><span class="msub" id="MathJax-Span-22376"><span style="display: inline-block; position: relative; width: 2.522em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22377" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.568em;"><span class="mrow" id="MathJax-Span-22378"><span class="mi" id="MathJax-Span-22379" style="font-size: 70.7%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22380" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22381" style="font-family: MathJax_Main;">,</span><span class="msub" id="MathJax-Span-22382" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 2.676em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22383" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.568em;"><span class="mrow" id="MathJax-Span-22384"><span class="mi" id="MathJax-Span-22385" style="font-size: 70.7%; font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-22386" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-22387" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">]</span></span></span><span class="mo" id="MathJax-Span-22388" style="font-family: MathJax_Main; padding-left: 0.208em;">×</span><span class="mrow" id="MathJax-Span-22389" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22390" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">[</span></span><span class="mrow" id="MathJax-Span-22391"><span class="msub" id="MathJax-Span-22392"><span style="display: inline-block; position: relative; width: 2.47em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22393" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.517em;"><span class="mrow" id="MathJax-Span-22394"><span class="mi" id="MathJax-Span-22395" style="font-size: 70.7%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22396" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22397" style="font-family: MathJax_Main;">,</span><span class="msub" id="MathJax-Span-22398" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 2.573em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22399" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.802em; left: 0.517em;"><span class="mrow" id="MathJax-Span-22400"><span class="mi" id="MathJax-Span-22401" style="font-size: 70.7%; font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-22402" style="font-size: 70.7%; font-family: MathJax_Main; padding-left: 0.26em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-22403" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">]</span></span></span><span class="mo" id="MathJax-Span-22404" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.213em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.421em; border-left: 0px solid; width: 0px; height: 1.38em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_501"><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>,</mo><mi>y</mi></mrow><mo>)</mo></mrow><mo>∈</mo><mrow><mo>[</mo><mrow><msub><mi>x</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>max</mi><mo>&nbsp;​⁡</mo></mrow></msub></mrow><mo>]</mo></mrow><mo>×</mo><mrow><mo>[</mo><mrow><msub><mi>y</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>max</mi><mo>&nbsp;​⁡</mo></mrow></msub></mrow><mo>]</mo></mrow><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-406"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_501"><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>,</mo><mi>y</mi></mrow><mo>)</mo></mrow><mo>∈</mo><mrow><mo>[</mo> <mrow><msub><mi>x</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>,</mo><msub><mi>x</mi><mrow><mi>max</mi><mo> ​⁡</mo></mrow></msub></mrow> <mo>]</mo></mrow><mo>×</mo><mrow><mo>[</mo> <mrow><msub><mi>y</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>,</mo><msub><mi>y</mi><mrow><mi>max</mi><mo> ​⁡</mo></mrow></msub></mrow> <mo>]</mo></mrow><mo>.</mo></mrow></math></script></p>
<p>As shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-24">Figure 12.24</a>, the intersection test can be phrased in terms of these intervals. First, we compute the ray parameter where the ray hits the line <span class="cItalic">x</span> = <span class="cItalic">x</span> min:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-407-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_502&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmin&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_502" overflow="scroll" style="width: 7.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.995em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.877em, 1006.9em, 2.728em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22406"><span class="mrow" id="MathJax-Span-22407"><span class="msub" id="MathJax-Span-22408"><span style="display: inline-block; position: relative; width: 2.008em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22409" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22410"><span class="mtext" id="MathJax-Span-22411" style="font-size: 70.7%; font-family: MathJax_Main;">xmin</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22412" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22413" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 3.19em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.447em, 1003.04em, 4.424em, -1000.01em); top: -4.676em; left: 50%; margin-left: -1.54em;"><span class="mrow" id="MathJax-Span-22414"><span class="msub" id="MathJax-Span-22415"><span style="display: inline-block; position: relative; width: 1.802em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22416" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mrow" id="MathJax-Span-22417"><span class="mi" id="MathJax-Span-22418" style="font-size: 50%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22419" style="font-size: 50%; font-family: MathJax_Main; padding-left: 0.311em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22420" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msub" id="MathJax-Span-22421"><span style="display: inline-block; position: relative; width: 0.671em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22422" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.905em; left: 0.414em;"><span class="mi" id="MathJax-Span-22423" style="font-size: 50%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.55em, 1000.73em, 4.27em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.357em;"><span class="mrow" id="MathJax-Span-22424"><span class="msub" id="MathJax-Span-22425"><span style="display: inline-block; position: relative; width: 0.722em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22426" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.905em; left: 0.414em;"><span class="mi" id="MathJax-Span-22427" style="font-size: 50%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1003.2em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.19em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22428" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.527em; border-left: 0px solid; width: 0px; height: 1.697em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_502"><mrow><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mrow><msub><mi>x</mi><mi>d</mi></msub></mrow></mfrac><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-407"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_502"> <mrow><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mrow><msub><mi>x</mi><mi>d</mi></msub></mrow></mfrac><mo>.</mo></mrow></math></script></p>
<div id="art_Dest_fig_12-24" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-24"></a><span class="cBold">Figure 12.24</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-24.png" alt="Figure showing the ray will be inside the interval x ∈ [xmin, xmax] for some interval in its parameter space t ∈ [txmin, txmax]. A similar interval exists for the y interval. The ray intersects the box if it is in both the x interval and y interval at the same time, i.e., the intersection of the two one-dimensional intervals is not empty." width="600" height="530" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-24.png"></p>
<p class="Text figcaption">The ray will be inside the interval <span class="cItalic">x ∈ </span>[<span class="cItalic">x</span><span class="cSubscript">min</span><span class="cItalic">, x</span><span class="cSubscript">max</span>] for some interval in its parameter space <span class="cItalic">t ∈ </span>[<span class="cItalic">t</span><span class="cSubscript">xmin</span><span class="cItalic">, t</span><span class="cSubscript">xmax</span>]. A similar interval exists for the <span class="cItalic">y</span> interval. The ray intersects the box if it is in both the <span class="cItalic">x</span> interval and <span class="cItalic">y</span> interval at the same time, i.e., the intersection of the two one-dimensional intervals is not empty.</p>
</div>
<p>We then make similar computations for <span class="cItalic">t </span><span class="cSubscript">xmax</span>, <span class="cItalic">t</span><span class="cSubscript">ymin</span>, and <span class="cItalic">t</span><span class="cSubscript">ymax</span>. The ray hits the box if and only if the intervals <span class="cBold">[<span class="cItalic">t </span></span><span class="cSubscript">xmin</span><span class="cItalic">, t</span><span class="cSubscript">xmax</span>] and [<span class="cItalic">t</span><span class="cSubscript">ymin</span><span class="cItalic">, t</span><span class="cSubscript">ymax</span>] overlap, i.e., their intersection is nonempty. In pseudocode this algorithm is:</p>
<pre><span class="code"><span class="cItalic">t</span><span class="cSubscript">xmin</span> = (<span class="cItalic">x</span><span class="cSubscript">min</span> <span class="cSuperscript">−</span> <span class="cItalic">xe)/xd</span></span></pre>
<pre><span class="code"><span class="cItalic">t</span><span class="cSubscript">xmax</span> = (<span class="cItalic">x</span><span class="cSubscript">max</span> - <span class="cItalic">x<span class="cSubscript">e</span>)/x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><span class="cItalic">t</span><span class="cSubscript">ymin</span> <span class="cItalic">= </span>(<span class="cItalic">y</span><span class="cSubscript">min</span> - <span class="cItalic">y<span class="cSubscript">e</span>)/y<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><span class="cItalic">t</span><span class="cSubscript">ymax</span> = (<span class="cItalic">y</span><span class="cSubscript">max</span> - <span class="cItalic">y<span class="cSubscript">e</span>)/y<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><span class="cBold">if </span>(<span class="cItalic">t</span><span class="cSubscript">xmin</span> <span class="cItalic">&gt; t</span><span class="cSubscript">ymax</span>) or <span class="cItalic">(t</span><span class="cSubscript">ymin</span> <span class="cItalic">&gt; t</span><span class="cSubscript">xmax</span>) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">return</span> false</span></pre>
<pre><span class="code"><span class="cBold">else</span></span></pre>
<pre><span class="code"> <span class="cBold">return</span> true</span></pre>
<p>The if statement may seem non-obvious. To see the logic of it, note that there is no overlap if the first interval is either entirely to the right or entirely to the left of the second interval.</p>
<p><a id="page_300"></a>The first thing we must address is the case when <span class="cItalic">x<span class="cSubscript">d</span></span> or <span class="cItalic">y<span class="cSubscript">d</span></span> is negative. If <span class="cItalic">x<span class="cSubscript">d</span></span> is negative, then the ray will hit <span class="cItalic">x</span><span class="cSubscript">max</span> before it hits <span class="cItalic">x</span><span class="cSubscript">min</span>. Thus the code for computing <span class="cItalic">t</span><span class="cSubscript">xmin</span> and <span class="cItalic">t</span><span class="cSubscript">xmax</span> expands to:</p>
<pre><span class="code"><span class="cBold">if </span>(<span class="cItalic">x<span class="cSubscript">d</span></span> ≥ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">xmin</span> = (<span class="cItalic">x</span><span class="cSubscript">min</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/xd</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">xmax</span> = (<span class="cItalic">x</span><span class="cSubscript">max</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><span class="cBold">else</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">xmin</span> = (<span class="cItalic">x</span><span class="cSubscript">max</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">xmax</span> = (<span class="cItalic">x</span><span class="cSubscript">min</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/x<span class="cSubscript">d</span></span></span></pre>
<p>A similar code expansion must be made for the <span class="cItalic">y</span> cases. A major concern is that horizontal and vertical rays have a zero value for <span class="cItalic">y<span class="cSubscript">d</span></span> and <span class="cItalic">x<span class="cSubscript">d</span></span>, respectively. This will cause divide by zero which may be a problem. However, before addressing this directly, we check whether IEEE floating point computation handles these cases gracefully for us. Recall from <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C001.xhtml#sec1-5">Section 1.5</a> the rules for divide by zero: for <a id="page_301"></a>any positive real number <span class="cItalic">a,</span></p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-408-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_503&quot;&gt;&lt;mtable columnalign=&quot;left&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;&amp;#x221E;&lt;/mi&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;&amp;#x221E;&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_503" overflow="scroll" style="width: 6.172em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.967em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.465em, 1005.72em, 3.293em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22430"><span class="mtable" id="MathJax-Span-22431" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 5.658em; height: 0px;"><span style="position: absolute; clip: rect(2.419em, 1005.56em, 5.195em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.658em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1005.56em, 4.424em, -1000.01em); top: -4.728em; left: 0em;"><span class="mtd" id="MathJax-Span-22432"><span class="mrow" id="MathJax-Span-22433"><span class="mo" id="MathJax-Span-22434" style="font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-22435" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-22436" style="font-family: MathJax_Main;">/</span><span class="mn" id="MathJax-Span-22437" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-22438" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mo" id="MathJax-Span-22439" style="font-family: MathJax_Main; padding-left: 0.26em;">+</span><span class="mi" id="MathJax-Span-22440" style="font-family: MathJax_Main;">∞</span><span class="mo" id="MathJax-Span-22441" style="font-family: MathJax_Main;">;</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1005.56em, 4.424em, -1000.01em); top: -3.237em; left: 0em;"><span class="mtd" id="MathJax-Span-22442"><span class="mrow" id="MathJax-Span-22443"><span class="mo" id="MathJax-Span-22444" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-22445" style="font-family: MathJax_Math-italic;">a</span><span class="mo" id="MathJax-Span-22446" style="font-family: MathJax_Main;">/</span><span class="mn" id="MathJax-Span-22447" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-22448" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mo" id="MathJax-Span-22449" style="font-family: MathJax_Main; padding-left: 0.26em;">−</span><span class="mi" id="MathJax-Span-22450" style="font-family: MathJax_Main;">∞</span><span class="mo" id="MathJax-Span-22451" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.109em; border-left: 0px solid; width: 0px; height: 2.703em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_503"><mtable columnalign="left"><mtr><mtd><mo>+</mo><mi>a</mi><mo>/</mo><mn>0</mn><mo>=</mo><mo>+</mo><mi>∞</mi><mo>;</mo></mtd></mtr><mtr><mtd><mo>−</mo><mi>a</mi><mo>/</mo><mn>0</mn><mo>=</mo><mo>−</mo><mi>∞</mi><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-408"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_503"><mtable columnalign="left"><mtr><mtd><mo>+</mo><mi>a</mi><mo>/</mo><mn>0</mn><mo>=</mo><mo>+</mo><mi>∞</mi><mo>;</mo></mtd></mtr><mtr><mtd><mo>−</mo><mi>a</mi><mo>/</mo><mn>0</mn><mo>=</mo><mo>−</mo><mi>∞</mi><mo>.</mo></mtd></mtr></mtable></math></script></p>
<p>Consider the case of a vertical ray where <span class="cItalic">xd</span> = 0 and <span class="cItalic">yd &gt;</span> 0. We can then calculate</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-409-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_504&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmin&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;min&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmax&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;max&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_504" overflow="scroll" style="width: 7.766em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.509em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.003em, 1007.26em, 3.704em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22453"><span class="mtable" id="MathJax-Span-22454" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 7.201em; height: 0px;"><span style="position: absolute; clip: rect(2.265em, 1007.16em, 5.967em, -1000.01em); top: -4.368em; left: 0em;"><span style="display: inline-block; position: relative; width: 7.201em; height: 0px;"><span style="position: absolute; clip: rect(2.779em, 1006.9em, 4.578em, -1000.01em); top: -4.882em; left: 50%; margin-left: -3.494em;"><span class="mtd" id="MathJax-Span-22455"><span class="mrow" id="MathJax-Span-22456"><span class="msub" id="MathJax-Span-22457"><span style="display: inline-block; position: relative; width: 2.008em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22458" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22459"><span class="mtext" id="MathJax-Span-22460" style="font-size: 70.7%; font-family: MathJax_Main;">xmin</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22461" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22462" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 3.19em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.447em, 1003.04em, 4.424em, -1000.01em); top: -4.676em; left: 50%; margin-left: -1.54em;"><span class="mrow" id="MathJax-Span-22463"><span class="msub" id="MathJax-Span-22464"><span style="display: inline-block; position: relative; width: 1.802em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22465" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mrow" id="MathJax-Span-22466"><span class="mi" id="MathJax-Span-22467" style="font-size: 50%; font-family: MathJax_Main;">min</span><span class="mo" id="MathJax-Span-22468" style="font-size: 50%; font-family: MathJax_Main; padding-left: 0.311em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22469" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msub" id="MathJax-Span-22470"><span style="display: inline-block; position: relative; width: 0.671em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22471" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.905em; left: 0.414em;"><span class="mi" id="MathJax-Span-22472" style="font-size: 50%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22473" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1003.2em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.19em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22474" style="font-family: MathJax_Main;">;</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.779em, 1007.16em, 4.578em, -1000.01em); top: -2.979em; left: 50%; margin-left: -3.596em;"><span class="mtd" id="MathJax-Span-22475"><span class="mrow" id="MathJax-Span-22476"><span class="msub" id="MathJax-Span-22477"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22478" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22479"><span class="mtext" id="MathJax-Span-22480" style="font-size: 70.7%; font-family: MathJax_Main;">xmax</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22481" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22482" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 3.293em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.447em, 1003.15em, 4.424em, -1000.01em); top: -4.676em; left: 50%; margin-left: -1.591em;"><span class="mrow" id="MathJax-Span-22483"><span class="msub" id="MathJax-Span-22484"><span style="display: inline-block; position: relative; width: 1.905em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22485" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mrow" id="MathJax-Span-22486"><span class="mi" id="MathJax-Span-22487" style="font-size: 50%; font-family: MathJax_Main;">max</span><span class="mo" id="MathJax-Span-22488" style="font-size: 50%; font-family: MathJax_Main; padding-left: 0.311em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22489" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msub" id="MathJax-Span-22490"><span style="display: inline-block; position: relative; width: 0.671em; height: 0px;"><span style="position: absolute; clip: rect(3.55em, 1000.37em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22491" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.905em; left: 0.414em;"><span class="mi" id="MathJax-Span-22492" style="font-size: 50%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22493" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1003.3em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.293em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22494" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.373em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.533em; border-left: 0px solid; width: 0px; height: 3.551em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_504"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>min</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>max</mi><mo>&nbsp;​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-409"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_504"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>min</mi><mo> ​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>x</mi><mrow><mi>max</mi><mo> ​⁡</mo></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>e</mi></msub></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></script></p>
<p>There are three possibilities of interest:</p>
<ol>
<li class="LX"><span class="cItalic">x<span class="cSubscript">e</span></span> ≤ <span class="cItalic">x</span> <span class="cSubscript">min</span> (no hit);</li>
<li class="LX"><span class="cItalic">x</span> <span class="cSubscript">min</span> &lt; <span class="cItalic">x<span class="cSubscript">e</span></span> &lt; <span class="cItalic">x</span> <span class="cSubscript">m</span>ax (hit);</li>
<li class="LX"><span class="cItalic">x</span><span class="cSubscript">max</span> ≤ <span class="cItalic">x<span class="cSubscript">e</span></span> (no hit).</li>
</ol>
<p>For the first case we have</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-410-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_505&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmin&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mtext&gt;positive&lt;/mtext&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mtext&gt;number&lt;/mtext&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmax&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mtext&gt;poeitive&lt;/mtext&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mtext&gt;number&lt;/mtext&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_505" overflow="scroll" style="width: 9.617em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.309em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.054em, 1009.06em, 3.653em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22496"><span class="mtable" id="MathJax-Span-22497" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 9em; height: 0px;"><span style="position: absolute; clip: rect(2.213em, 1008.96em, 5.812em, -1000.01em); top: -4.265em; left: 0em;"><span style="display: inline-block; position: relative; width: 9em; height: 0px;"><span style="position: absolute; clip: rect(2.83em, 1008.75em, 4.578em, -1000.01em); top: -4.882em; left: 50%; margin-left: -4.419em;"><span class="mtd" id="MathJax-Span-22498"><span class="mrow" id="MathJax-Span-22499"><span class="msub" id="MathJax-Span-22500"><span style="display: inline-block; position: relative; width: 2.008em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22501" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22502"><span class="mtext" id="MathJax-Span-22503" style="font-size: 70.7%; font-family: MathJax_Main;">xmin</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22504" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22505" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 5.041em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.345em, 1004.9em, 4.321em, -1000.01em); top: -4.573em; left: 50%; margin-left: -2.465em;"><span class="mrow" id="MathJax-Span-22506"><span class="mtext" id="MathJax-Span-22507" style="font-size: 70.7%; font-family: MathJax_Main;">positive</span><span class="mtext" id="MathJax-Span-22508" style="font-size: 70.7%; font-family: MathJax_Main;">&nbsp;</span><span class="mtext" id="MathJax-Span-22509" style="font-size: 70.7%; font-family: MathJax_Main;">number</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22510" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1005.05em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.041em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22511" style="font-family: MathJax_Main;">;</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.83em, 1008.96em, 4.578em, -1000.01em); top: -3.031em; left: 50%; margin-left: -4.522em;"><span class="mtd" id="MathJax-Span-22512"><span class="mrow" id="MathJax-Span-22513"><span class="msub" id="MathJax-Span-22514"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22515" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22516"><span class="mtext" id="MathJax-Span-22517" style="font-size: 70.7%; font-family: MathJax_Main;">xmax</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22518" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22519" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 5.093em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.345em, 1004.95em, 4.321em, -1000.01em); top: -4.573em; left: 50%; margin-left: -2.465em;"><span class="mrow" id="MathJax-Span-22520"><span class="mtext" id="MathJax-Span-22521" style="font-size: 70.7%; font-family: MathJax_Main;">poeitive</span><span class="mtext" id="MathJax-Span-22522" style="font-size: 70.7%; font-family: MathJax_Main;">&nbsp;</span><span class="mtext" id="MathJax-Span-22523" style="font-size: 70.7%; font-family: MathJax_Main;">number</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22524" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1005.05em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.093em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22525" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.27em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.48em; border-left: 0px solid; width: 0px; height: 3.498em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_505"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>positive</mtext><mtext>&nbsp;</mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>poeitive</mtext><mtext>&nbsp;</mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-410"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_505"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>positive</mtext><mtext> </mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>poeitive</mtext><mtext> </mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></script></p>
<p>This yields the interval (<span class="cItalic">t</span><span class="cSubscript">xmin</span>, <span class="cItalic">t</span><span class="cSubscript">xmin</span>) = (∞, ∞). That interval will not overlap with any interval, so there will be no hit, as desired. For the second case, we have</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-411-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_506&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmin&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mtext&gt;positive&lt;/mtext&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mtext&gt;number&lt;/mtext&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;;&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mtext&gt;xmax&lt;/mtext&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mtext&gt;poeitive&lt;/mtext&gt;&lt;mtext&gt;&amp;#xA0;&lt;/mtext&gt;&lt;mtext&gt;number&lt;/mtext&gt;&lt;/mrow&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_506" overflow="scroll" style="width: 9.617em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.309em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.054em, 1009.06em, 3.653em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22527"><span class="mtable" id="MathJax-Span-22528" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 9em; height: 0px;"><span style="position: absolute; clip: rect(2.213em, 1008.96em, 5.812em, -1000.01em); top: -4.265em; left: 0em;"><span style="display: inline-block; position: relative; width: 9em; height: 0px;"><span style="position: absolute; clip: rect(2.83em, 1008.75em, 4.578em, -1000.01em); top: -4.882em; left: 50%; margin-left: -4.419em;"><span class="mtd" id="MathJax-Span-22529"><span class="mrow" id="MathJax-Span-22530"><span class="msub" id="MathJax-Span-22531"><span style="display: inline-block; position: relative; width: 2.008em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22532" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22533"><span class="mtext" id="MathJax-Span-22534" style="font-size: 70.7%; font-family: MathJax_Main;">xmin</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22535" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22536" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 5.041em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.345em, 1004.9em, 4.321em, -1000.01em); top: -4.573em; left: 50%; margin-left: -2.465em;"><span class="mrow" id="MathJax-Span-22537"><span class="mtext" id="MathJax-Span-22538" style="font-size: 70.7%; font-family: MathJax_Main;">positive</span><span class="mtext" id="MathJax-Span-22539" style="font-size: 70.7%; font-family: MathJax_Main;">&nbsp;</span><span class="mtext" id="MathJax-Span-22540" style="font-size: 70.7%; font-family: MathJax_Main;">number</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22541" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1005.05em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.041em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22542" style="font-family: MathJax_Main;">;</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.83em, 1008.96em, 4.578em, -1000.01em); top: -3.031em; left: 50%; margin-left: -4.522em;"><span class="mtd" id="MathJax-Span-22543"><span class="mrow" id="MathJax-Span-22544"><span class="msub" id="MathJax-Span-22545"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22546" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mrow" id="MathJax-Span-22547"><span class="mtext" id="MathJax-Span-22548" style="font-size: 70.7%; font-family: MathJax_Main;">xmax</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22549" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mfrac" id="MathJax-Span-22550" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 5.093em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.345em, 1004.95em, 4.321em, -1000.01em); top: -4.573em; left: 50%; margin-left: -2.465em;"><span class="mrow" id="MathJax-Span-22551"><span class="mtext" id="MathJax-Span-22552" style="font-size: 70.7%; font-family: MathJax_Main;">poeitive</span><span class="mtext" id="MathJax-Span-22553" style="font-size: 70.7%; font-family: MathJax_Main;">&nbsp;</span><span class="mtext" id="MathJax-Span-22554" style="font-size: 70.7%; font-family: MathJax_Main;">number</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.396em, 1000.32em, 4.167em, -1000.01em); top: -3.648em; left: 50%; margin-left: -0.152em;"><span class="mn" id="MathJax-Span-22555" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1005.05em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.093em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-22556" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.27em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.48em; border-left: 0px solid; width: 0px; height: 3.498em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_506"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>positive</mtext><mtext>&nbsp;</mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>poeitive</mtext><mtext>&nbsp;</mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-411"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_506"><mtable><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmin</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>positive</mtext><mtext> </mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>;</mo></mtd></mtr><mtr><mtd><msub><mi>t</mi><mrow><mtext>xmax</mtext></mrow></msub><mo>=</mo><mfrac><mrow><mtext>poeitive</mtext><mtext> </mtext><mtext>number</mtext></mrow><mn>0</mn></mfrac><mo>.</mo></mtd></mtr></mtable></math></script></p>
<p>This yields the interval (<span class="cItalic">t</span><span class="cSubscript">xmin</span>, <span class="cItalic">t</span><span class="cSubscript">xmin</span>) = (−∞,∞) which will overlap with all intervals and thus will yield a hit as desired. The third case results in the interval (−∞, −∞) which yields no hit, as desired. Because these cases work as desired, we need no special checks for them. As is often the case, IEEE floating point conventions are our ally. However, there is still a problem with this approach.</p>
<p>Consider the code segment:</p>
<pre><span class="code"><span class="cBold">if</span> <span class="cItalic">(x<span class="cSubscript">d</span></span> &gt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">min</span> = <span class="cItalic">(x</span><span class="cSubscript">mi<span class="cItalic">n</span></span> - <span class="cItalic">xe</span>)/<span class="cItalic">x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"> <span class="cItalic">t<span class="cSubscript"></span>max</span> = (<span class="cItalic">x</span><span class="cSubscript">max</span> <span class="cItalic">- x<span class="cSubscript">e</span>)/x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><a id="page_302"></a><span class="cBold">else</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">min</span> = (<span class="cItalic">x</span><span class="cSubscript">max</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/x<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">max</span> = (<span class="cItalic">x</span><span class="cSubscript">min</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)<span class="cItalic">/x<span class="cSubscript">d</span></span></span></pre>
<p>This code breaks down when <span class="cItalic">x<span class="cSubscript">d</span></span> = −0. This can be overcome by testing on the reciprocal of <span class="cItalic">x<span class="cSubscript">d</span></span> (A. Williams, Barrus, Morley, &amp; Shirley, 2005):</p>
<pre><span class="code"><span class="cItalic">a</span> = 1<span class="cItalic">/X<span class="cSubscript">d</span></span></span></pre>
<pre><span class="code"><span class="cBold">if</span> (<span class="cItalic">a</span> ≥ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">min</span> = <span class="cItalic">a</span>(<span class="cItalic">x</span><span class="cSubscript">min</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)</span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">max</span> = <span class="cItalic">a</span>(<span class="cItalic">x</span><span class="cSubscript">max</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)</span></pre>
<pre><span class="code"><span class="cBold">else</span></span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">min</span> = <span class="cItalic">a</span>(<span class="cItalic">x</span><span class="cSubscript">max</span> − <span class="cItalic">x<span class="cSubscript">e</span></span>)</span></pre>
<pre><span class="code"> <span class="cItalic">t</span><span class="cSubscript">max</span> = <span class="cItalic">a</span>(<span class="cItalic">x</span><span class="cSubscript">min</span> <span class="cItalic">- x<span class="cSubscript">e</span></span>)</span></pre>
<h3><a id="sec12-3-2"></a>12.3.2 Hierarchical Bounding Boxes</h3>
<p>The basic idea of hierarchical bounding boxes can be seen by the common tactic of placing an axis-aligned 3D bounding box around all the objects as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-25">Figure 12.25</a>. Rays that hit the bounding box will actually be more expensive to compute than in a brute force search, because testing for intersection with the box is not free. However, rays that miss the box are cheaper than the brute force search. Such bounding boxes can be made hierarchical by partitioning the set of objects in a box and placing a box around each partition as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-26">Figure 12.26</a>. The data structure for the hierarchy shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-27">Figure 12.27</a> might be a tree with the large bounding box at the root and the two smaller bounding boxes as left and right subtrees. These would in turn each point to a list of three triangles. The intersection of a ray with this particular hard-coded tree would be:</p>
<div id="art_Dest_fig_12-25" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-25"></a><span class="cBold">Figure 12.25</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-25.png" alt="Figure showing a 2D ray e + td is tested against a 2D bounding box." width="409" height="326" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-25.png"></p>
<p class="Text figcaption">A 2D ray <span class="cBold">e</span> + <span class="cItalic">t</span><span class="cBold">d</span> is tested against a 2D bounding box.</p>
</div>
<div id="art_Dest_fig_12-26" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-26"></a><span class="cBold">Figure 12.26</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-26.png" alt="Figure showing the bounding boxes can be nested by creating boxes around subsets of the model." width="409" height="351" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-26.png"></p>
<p class="Text figcaption">The bounding boxes can be nested by creating boxes around subsets of the model.</p>
</div>
<div id="art_Dest_fig_12-27" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-27"></a><span class="cBold">Figure 12.27</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-27.png" alt="Figure showing the gray box is a tree node that points to the three gray spheres, and the thick black box points to the three black spheres. Note that not all spheres enclosed by the box are guaranteed to be pointed to by the corresponding tree node." width="410" height="527" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-27.png"></p>
<p class="Text figcaption">The gray box is a tree node that points to the three gray spheres, and the thick black box points to the three black spheres. Note that not all spheres enclosed by the box are guaranteed to be pointed to by the corresponding tree node.</p>
</div>
<pre><span class="code"><span class="cBold">if</span> (ray hits root box) <span class="cBold">then</span></span></pre>
<pre><span class="code">  <span class="cBold">if</span> (ray hits left subtree box) <span class="cBold">then</span></span></pre>
<pre><span class="code">  check three triangles for intersection</span></pre>
<pre><span class="code">  <span class="cBold">if</span> (ray intersects right subtree box) <span class="cBold">then</span></span></pre>
<pre><span class="code">  check other three triangles for intersection</span></pre>
<pre><span class="code">  <span class="cBold">if</span> (an intersections returned from each subtree) <span class="cBold">then</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> the closest of the two hits</span></pre>
<pre><span class="code">  <span class="cBold">else if</span> (a intersection is returned from exactly one subtree) <span class="cBold">then</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> that intersection</span></pre>
<pre><span class="code">  <span class="cBold">else</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> false</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> false</span></pre>
<p><a id="page_303"></a>Some observations related to this algorithm are that there is no geometric ordering between the two subtrees, and there is no reason a ray might not hit both subtrees. Indeed, there is no reason that the two subtrees might not overlap.</p>
<p>A key point of such data hierarchies is that a box is guaranteed to bound all objects that are below it in the hierarchy, but they are <span class="cItalic">not</span> guaranteed to contain all objects that overlap it spatially, as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-27">Figure 12.27</a>. This makes this geometric search somewhat more complicated than a traditional binary search on strictly ordered one-dimensional data. The reader may note that several possible optimizations present themselves. We defer optimizations until we have a full hierarchical algorithm.</p>
<p>If we restrict the tree to be binary and require that each node in the tree have a bounding box, then this traversal code extends naturally. Further, assume that all nodes are either leaves in the tree and contain a primitive, or that they contain one or two subtrees.</p>
<p>The <span class="code">bvh-node</span> class should be of type surface, so it should implement <span class="code">surface::hit</span>. The data it contains should be simple:</p>
<pre><span class="code"><span class="cBold">class</span> bvh-node subclass of surface</span></pre>
<pre><span class="code"> virtual bool hit(ray <span class="cBold">e</span> + <span class="cItalic">t</span><span class="cBold">d</span>, real <span class="cItalic">t</span><span class="cSubscript">0</span>, real <span class="cItalic">t</span><span class="cSubscript">1</span>, hit-record rec)</span></pre>
<pre><span class="code"> virtual box bounding-box()</span></pre>
<pre><span class="code"> surface-pointer left</span></pre>
<pre><span class="code"> surface-pointer right</span></pre>
<pre><span class="code"> box bbox</span></pre>
<p>The traversal code can then be called recursively in an object-oriented style:</p>
<pre><span class="code"><span class="cBold">function</span> bool bvh-node::hit(ray <span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, real <span class="cItalic">t</span><span class="cSubscript">0</span>, real <span class="cItalic">t</span><span class="cSubscript">1</span>, hit-record rec)</span></pre>
<pre> <span class="code"> <span class="cBold">if</span> (bbox.hitbox(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>)) <span class="cBold">then</span></span></pre>
<pre><span class="code">  hit-record lrec, rrec</span></pre>
<pre><span class="code">  left-hit = (left ≠ NULL) and (left → hit(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>, lrec))</span></pre>
<pre><span class="code">  right-hit = (right ≠ NULL) and (right <span class="cItalic">→</span> hit(<span class="cBold">a</span>+<span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>, rrec))</span></pre>
<pre><span class="code">  <span class="cBold">if</span> (left-hit and right-hit) <span class="cBold">then</span></span></pre>
<pre><span class="code">  <span class="cBold">if</span> (lrec.t <span class="cItalic">&lt;</span> rrec.t) <span class="cBold">then</span></span></pre>
<pre><span class="code">   rec = lrec</span></pre>
<pre><span class="code">  <span class="cBold">else</span></span></pre>
<pre><span class="code">   rec = rrec</span></pre>
<pre><span class="code">  <span class="cBold">return</span> true</span></pre>
<pre><span class="code"> <span class="cBold">else if</span> (left-hit) <span class="cBold">then</span></span></pre>
<pre><span class="code">  rec = lrec</span></pre>
<pre><span class="code">  <span class="cBold">return</span> true</span></pre>
<pre><span class="code"> <span class="cBold">else if</span> (right-hit) <span class="cBold">then</span></span></pre>
<pre><span class="code"><a id="page_304"></a> rec = rrec</span></pre>
<pre><span class="code"> <span class="cBold">return</span> true</span></pre>
<pre><span class="code">  <span class="cBold">else</span></span></pre>
<pre><span class="code"> <span class="cBold">return</span> false</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> false</span></pre>
<p>Note that because left and right point to surfaces rather than bvh-nodes specifically, we can let the virtual functions take care of distinguishing between internal and leaf nodes; the appropriate hit function will be called. Note that if the tree is built properly, we can eliminate the check for left being NULL. If we want to eliminate the check for right being NULL, we can replace NULL right pointers with a redundant pointer to left. This will end up checking left twice, but will eliminate the check throughout the tree. Whether that is worth it will depend on the details of tree construction.</p>
<p>There are many ways to build a tree for a bounding volume hierarchy. It is convenient to make the tree binary, roughly balanced, and to have the boxes of sibling subtrees not overlap too much. A heuristic to accomplish this is to sort the surfaces along an axis before dividing them into two sublists. If the axes are defined by an integer with <span class="cItalic">x</span> = 0, <span class="cItalic">y</span> = 1, and <span class="cItalic">z</span> = 2 we have:</p>
<pre><span class="code"><span class="cBold">function</span> bvh-node::create(object-array A, int AXIS)</span></pre>
<pre><span class="code"> N = A.length</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (N= 1) <span class="cBold">then</span></span></pre>
<pre><span class="code"> left = A[0]</span></pre>
<pre><span class="code"> right = NULL</span></pre>
<pre><span class="code"> bbox = bounding-box(A[0])</span></pre>
<pre><span class="code"> <span class="cBold">else if</span> (N= 2) <span class="cBold">then</span></span></pre>
<pre><span class="code"> left-node = A[0]</span></pre>
<pre><span class="code"> right-node = A[1]</span></pre>
<pre><span class="code"> bbox = combine(bounding-box(A[0]), bounding-box(A[1]))</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code"> sort A by the object center along AXIS</span></pre>
<pre><span class="code"> left= new bvh-node(A[0..N/2 − 1], (AXIS +1) mod 3)</span></pre>
<pre><span class="code"> right = new bvh-node(A[N/2<span class="cItalic">..</span>N−1], (AXIS +1) mod 3)</span></pre>
<pre><span class="code"> bbox = combine(left <span class="cItalic">→</span> bbox, right <span class="cItalic">→</span> bbox)</span></pre>
<p>The quality of the tree can be improved by carefully choosing AXIS each time. One way to do this is to choose the axis such that the sum of the volumes of the bounding boxes of the two subtrees is minimized. This change compared to rotating through the axes will make little difference for scenes composed of isotopically distributed small objects, but it may help significantly in less well-behaved <a id="page_305"></a>scenes. This code can also be made more efficient by doing just a partition rather than a full sort.</p>
<p>Another, and probably better, way to build the tree is to have the subtrees contain about the same amount of space rather than the same number of objects. To do this we partition the list based on space:</p>
<pre><span class="code"><span class="cBold">function</span> bvh-node::create(object-array A, int AXIS)</span></pre>
<pre><span class="code"> N = A. length</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (N = 1) <span class="cBold">then</span></span></pre>
<pre><span class="code"> left = A[0]</span></pre>
<pre><span class="code"> right = NULL</span></pre>
<pre><span class="code"> bbox = bounding-box(A[0])</span></pre>
<pre><span class="code"> <span class="cBold">else if</span> (N = 2) <span class="cBold">then</span></span></pre>
<pre><span class="code"> left = A[0]</span></pre>
<pre><span class="code"> right = A[1]</span></pre>
<pre><span class="code"> bbox = combine(bounding-box(A[0]),bounding-box(A[1]))</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code"> find the midpoint <span class="cItalic">m</span> of the bounding box of A along AXIS</span></pre>
<pre><span class="code"> partition A into lists with lengths <span class="cItalic">k</span> and <span class="cItalic">(N − k)</span> surrounding <span class="cItalic">m</span></span></pre>
<pre><span class="code"> left = new bvh-node(A[0..<span class="cItalic">k</span>], (AXIS +1) mod 3)</span></pre>
<pre><span class="code"> right = new bvh-node(A[<span class="cItalic">k</span> + 1..<span class="cItalic">N</span> − 1], (AXIS +1) mod 3)</span></pre>
<pre><span class="code"> bbox = combine (left → bbox, right → bbox)</span></pre>
<p>Although this results in an unbalanced tree, it allows for easy traversal of empty space and is cheaper to build because partitioning is cheaper than sorting.</p>
<h3><a id="sec12-3-3"></a>12.3.3 Uniform Spatial Subdivision</h3>
<p>Another strategy to reduce intersection tests is to divide space. This is fundamentally different from dividing objects as was done with hierarchical bounding volumes:</p>
<ul>
<li class="LX">In hierarchical bounding volumes, each object belongs to one of two sibling nodes, whereas a point in space may be inside both sibling nodes.</li>
<li class="LX">In spatial subdivision, each point in space belongs to exactly one node, whereas objects may belong to many nodes.</li>
</ul>
<p>In uniform spatial subdivision, the scene is partitioned into axis-aligned boxes. These boxes are all the same size, although they are not necessarily cubes. The ray traverses these boxes as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-28">Figure 12.28</a>. When an object is hit, the traversal ends.</p>
<div id="art_Dest_fig_12-28" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-28"></a><span class="cBold">Figure 12.28</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-28.png" alt="Figure showing in uniform spatial subdivision, the ray is tracked forward through cells until an object in one of those cells is hit. In this example, only objects in the shaded cells are checked." width="600" height="301" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-28.png"></p>
<p class="Text figcaption">In uniform spatial subdivision, the ray is tracked forward through cells until an object in one of those cells is hit. In this example, only objects in the shaded cells are checked.</p>
</div>
<p><a id="page_306"></a>The grid itself should be a subclass of surface and should be implemented as a 3D array of pointers to surface. For empty cells these pointers are NULL. For cells with one object, the pointer points to that object. For cells with more than one object, the pointer can point to a list, another grid, or another data structure, such as a bounding volume hierarchy.</p>
<p>This traversal is done in an incremental fashion. The regularity comes from the way that a ray hits each set of parallel planes, as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-29">Figure 12.29</a>. To see how this traversal works, first consider the 2D case where the ray direction has positive <span class="cItalic">x</span> and <span class="cItalic">y</span> components and starts outside the grid. Assume the grid is bounded by points (<span class="cItalic">x</span><span class="cSubscript">min</span>, <span class="cItalic">y</span><span class="cSubscript">min</span>) and (<span class="cItalic">x</span><span class="cSubscript">max</span>, <span class="cItalic">y</span><span class="cSubscript">max</span>). The grid has <span class="cItalic">n<span class="cSubscript">x</span> × n<span class="cSubscript">y</span></span> cells.</p>
<div id="art_Dest_fig_12-29" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-29"></a><span class="cBold">Figure 12.29</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-29.png" alt="Figure showing although the pattern of cell hits seems irregular (left), the hits on sets of parallel planes are very even." width="600" height="294" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-29.png"></p>
<p class="Text figcaption">Although the pattern of cell hits seems irregular (left), the hits on sets of parallel planes are very even.</p>
</div>
<p><a id="page_307"></a>Our first order of business is to find the index (<span class="cItalic">i, j</span>) of the first cell hit by the ray e + <span class="cItalic">t</span>d. Then, we need to traverse the cells in an appropriate order. The key parts to this algorithm are finding the initial cell (<span class="cItalic">i, j</span>) and deciding whether to increment <span class="cItalic">i</span> or <span class="cItalic">j</span> (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-30">Figure 12.30</a>). Note that when we check for an intersection with objects in a cell, we restrict the range of <span class="cItalic">t</span> to be within the cell (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-31">Figure 12.31</a>). Most implementations make the 3D array of type “pointer to surface.” To improve the locality of the traversal, the array can be tiled as discussed in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#sec12-5">Section 12.5</a>.</p>
<div id="art_Dest_fig_12-30" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-30"></a><span class="cBold">Figure 12.30</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-30.png" alt="Figure showing to decide whether we advance right or upward, we keep track of the intersections with the next vertical and horizontal boundary of the cell." width="410" height="328" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-30.png"></p>
<p class="Text figcaption">To decide whether we advance right or upward, we keep track of the intersections with the next vertical and horizontal boundary of the cell.</p>
</div>
<div id="art_Dest_fig_12-31" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-31"></a><span class="cBold">Figure 12.31</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-31.png" alt="Figure showing only hits within the cell should be reported. Otherwise the case above would cause us to report hitting object b rather than object a." width="410" height="328" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-31.png"></p>
<p class="Text figcaption">Only hits within the cell should be reported. Otherwise the case above would cause us to report hitting object <span class="cItalic">b</span> rather than object <span class="cItalic">a</span>.</p>
</div>
<h3><a id="sec12-3-4"></a>12.3.4 Axis-Aligned Binary Space Partitioning</h3>
<p>We can also partition space in a hierarchical data structure such as a <span class="cItalic">binary space partitioning tree</span> (BSP tree). This is similar to the BSP tree used for visibility sorting in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#sec12-4">Section 12.4</a>, but it’s most common to use axis-aligned, rather than polygon-aligned, cutting planes for ray intersection.</p>
<p>A node in this structure contains a single cutting plane and a left and right subtree. Each subtree contains all the objects on one side of the cutting plane. Objects that pass through the plane are stored in in both subtrees. If we assume the cutting plane is parallel to the <span class="cItalic">yz</span> plane at <span class="cItalic">x</span> = <span class="cItalic">D</span>, then the node class is:</p>
<pre><span class="code"><span class="cBold">class</span> bsp-node subclass of surface</span></pre>
<pre><span class="code"> virtual bool hit(ray <span class="cBold">e</span> + <span class="cItalic">t</span><span class="cBold">d</span>, real <span class="cItalic">t</span><span class="cSubscript">0</span>, real <span class="cItalic">t</span><span class="cSubscript">1</span>, hit-record rec)</span></pre>
<pre><span class="code"> virtual box bounding-box()</span></pre>
<pre><span class="code"> surface-pointer left</span></pre>
<pre><span class="code"> surface-pointer right</span></pre>
<pre><span class="code"> real <span class="cItalic">D</span></span></pre>
<p>We generalize this to <span class="cItalic">y</span> and <span class="cItalic">z</span> cutting planes later. The intersection code can then be called recursively in an object-oriented style. The code considers the four cases shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-32">Figure 12.32</a>. For our purposes, the origin of these rays is a point at parameter <span class="cItalic">t</span><span class="cSubscript">0</span>:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-412-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_507&quot;&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_507" overflow="scroll" style="width: 5.504em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.35em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.339em, 1005.25em, 2.522em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-22558"><span class="mrow" id="MathJax-Span-22559"><span class="mstyle" id="MathJax-Span-22560"><span class="mrow" id="MathJax-Span-22561"><span class="mi" id="MathJax-Span-22562" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22563" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mstyle" id="MathJax-Span-22564" style="padding-left: 0.26em;"><span class="mrow" id="MathJax-Span-22565"><span class="mi" id="MathJax-Span-22566" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-22567" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-22568" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22569" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mn" id="MathJax-Span-22570" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mstyle" id="MathJax-Span-22571"><span class="mrow" id="MathJax-Span-22572"><span class="mi" id="MathJax-Span-22573" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-22574" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.262em; border-left: 0px solid; width: 0px; height: 1.009em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_507"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-412"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_507"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>.</mo></mrow></math></script></p>
<div id="art_Dest_fig_12-32" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-32"></a><span class="cBold">Figure 12.32</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-32.png" alt="Figure showing the four cases of how a ray relates to the BSP cutting plane x = D." width="410" height="329" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-32.png"></p>
<p class="Text figcaption">The four cases of how a ray relates to the BSP cutting plane <span class="cItalic">x = D</span>.</p>
</div>
<p>The four cases are:</p>
<ol>
<li class="LX">The ray only interacts with the left subtree, and we need not test it for intersection with the cutting plane. It occurs for <span class="cItalic">x<span class="cSubscript">p</span> &lt; D</span> and <span class="cItalic">x<span class="cSubscript">b</span> &lt;</span> 0.</li>
<li class="LX">The ray is tested against the left subtree, and if there are no hits, it is then tested against the right subtree. We need to find the ray parameter at <span class="cItalic">x</span> = <span class="cItalic">D</span>, so we can make sure we only test for intersections within the subtree. This case occurs for <span class="cItalic">x<span class="cSubscript">p</span> &lt; D</span> and <span class="cItalic">x<span class="cSubscript">b</span> &gt;</span> 0.</li>
<li class="LX"><a id="page_308"></a>This case is analogous to case 1 and occurs for <span class="cItalic">x<span class="cSubscript">p</span> &gt; D</span> and <span class="cItalic">x<span class="cSubscript">b</span></span> &gt; 0.</li>
<li class="LX">This case is analogous to case 2 and occurs for <span class="cItalic">x<span class="cSubscript">p</span> &gt; D</span> and <span class="cItalic">x<span class="cSubscript">b</span></span> &lt; 0.</li>
</ol>
<p>The resulting traversal code handling these cases in order is:</p>
<pre><span class="code"><span class="cBold">function</span> bool bsp-node::hit(ray <span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, real <span class="cItalic">t</span><span class="cSubscript">0</span>, real <span class="cItalic">t</span><span class="cSubscript">1</span>, hit-record rec)</span></pre>
<pre><span class="code"> <span class="cItalic">x<span class="cSubscript">p</span></span> = <span class="cItalic">x<span class="cSubscript">a</span></span> +<span class="cItalic">t</span><span class="cSubscript">0</span><span class="cItalic">x<span class="cSubscript">b</span></span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> (<span class="cItalic">x<span class="cSubscript">p</span> &lt; D</span>) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> (<span class="cItalic">x<span class="cSubscript">b</span></span> &lt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code">   <span class="cBold">return</span> (left ≠ NULL) and (left<span class="cItalic">→</span>hit(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>, rec))</span></pre>
<pre><span class="code"> <span class="cItalic">t</span> = (<span class="cItalic">D - x<span class="cSubscript">a</span></span>)<span class="cItalic">/x<span class="cSubscript">b</span></span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> (<span class="cItalic">t&gt;t</span><span class="cSubscript">1</span>) <span class="cBold">then</span></span></pre>
<pre><span class="code">  <span class="cBold">return</span> (left ≠ NULL) and (left<span class="cItalic">→</span>hit(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>, rec))</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (left ≠ NULL) and (left<span class="cItalic">→</span>hit(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span><span class="cSubscript">0</span>, <span class="cItalic">t</span>, rec)) <span class="cBold">then</span></span></pre>
<pre><span class="code">   <span class="cBold">return</span> true <span class="cBold">return</span> (right ≠ NULL) and (right<span class="cItalic">→</span>hit(<span class="cBold">a</span> + <span class="cItalic">t</span><span class="cBold">b</span>, <span class="cItalic">t</span>, <span class="cItalic">t</span><span class="cSubscript">1</span>, rec))</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code">  analogous code for cases 3 and 4</span></pre>
<p>This is very clean code. However, to get it started, we need to hit some root object that includes a bounding box so we can initialize the traversal, <span class="cItalic">t</span><span class="cSubscript">0</span> and <span class="cItalic">t</span><span class="cSubscript">1</span>. An issue we have to address is that the cutting plane may be along any axis. We can add an integer index <span class="cItalic">axis</span> to the <span class="cItalic">bsp-node</span> class. If we allow an indexing operator for points, this will result in some simple modifications to the code above, for example,</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-413-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_508&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_508" overflow="scroll" style="width: 6.429em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.224em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.339em, 1006.23em, 2.573em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22576"><span class="mrow" id="MathJax-Span-22577"><span class="msub" id="MathJax-Span-22578"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22579" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mi" id="MathJax-Span-22580" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22581" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-22582" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22583" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mi" id="MathJax-Span-22584" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22585" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-22586" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22587" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mn" id="MathJax-Span-22588" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-22589"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22590" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mi" id="MathJax-Span-22591" style="font-size: 70.7%; font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.062em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_508"><mrow><msub><mi>x</mi><mi>p</mi></msub><mo>=</mo><msub><mi>x</mi><mi>a</mi></msub><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><msub><mi>x</mi><mi>b</mi></msub></mrow></math></span></span><script type="math/mml" id="MathJax-Element-413"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_508"><mrow><msub><mi>x</mi><mi>p</mi></msub><mo>=</mo><msub><mi>x</mi><mi>a</mi></msub><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><msub><mi>x</mi><mi>b</mi></msub></mrow></math></script></p>
<p>would become</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-414-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_509&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;u&lt;/mi&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;mtext&gt;axis&lt;/mtext&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;[&lt;/mo&gt;&lt;mrow&gt;&lt;mtext&gt;axis&lt;/mtext&gt;&lt;/mrow&gt;&lt;mo&gt;]&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_509" overflow="scroll" style="width: 10.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.08em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1009.99em, 2.573em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22593"><span class="mrow" id="MathJax-Span-22594"><span class="msub" id="MathJax-Span-22595"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22596" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mi" id="MathJax-Span-22597" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22598" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-22599" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">a</span><span class="mrow" id="MathJax-Span-22600" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22601" style="font-family: MathJax_Main;">[</span><span class="mrow" id="MathJax-Span-22602"><span class="mtext" id="MathJax-Span-22603" style="font-family: MathJax_Main;">axis</span></span><span class="mo" id="MathJax-Span-22604" style="font-family: MathJax_Main;">]</span></span><span class="mo" id="MathJax-Span-22605" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-22606" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22607" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mn" id="MathJax-Span-22608" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-22609" style="font-family: MathJax_Math-italic;">b</span><span class="mrow" id="MathJax-Span-22610" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22611" style="font-family: MathJax_Main;">[</span><span class="mrow" id="MathJax-Span-22612"><span class="mtext" id="MathJax-Span-22613" style="font-family: MathJax_Main;">axis</span></span><span class="mo" id="MathJax-Span-22614" style="font-family: MathJax_Main;">]</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.168em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_509"><mrow><msub><mi>u</mi><mi>p</mi></msub><mo>=</mo><mi>a</mi><mrow><mo>[</mo><mrow><mtext>axis</mtext></mrow><mo>]</mo></mrow><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><mi>b</mi><mrow><mo>[</mo><mrow><mtext>axis</mtext></mrow><mo>]</mo></mrow></mrow></math></span></span><script type="math/mml" id="MathJax-Element-414"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_509"><mrow><msub><mi>u</mi><mi>p</mi></msub><mo>=</mo><mi>a</mi><mrow><mo>[</mo> <mrow><mtext>axis</mtext></mrow> <mo>]</mo></mrow><mo>+</mo><msub><mi>t</mi><mn>0</mn></msub><mi>b</mi><mrow><mo>[</mo> <mrow><mtext>axis</mtext></mrow> <mo>]</mo></mrow></mrow></math></script></p>
<p>which will result in some additional array indexing, but will not generate more branches.</p>
<p>While the processing of a single bsp-node is faster than processing a bvh-node, the fact that a single surface may exist in more than one subtree means there are more nodes and, potentially, a higher memory use. How “well” the trees are built determines which is faster. Building the tree is similar to building the BVH tree. We can pick axes to split in a cycle, and we can split in half each time, or we can try to be more sophisticated in how we divide.</p>
<h2><a id="sec12-4"></a><a id="page_309"></a>12.4 BSP Trees for Visibility</h2>
<p>Another geometric problem in which spatial data structures can be used is determining the visibility ordering of objects in a scene with changing viewpoint.</p>
<p>If we are making many images of a fixed scene composed of planar polygons, from different viewpoints—as is often the case for applications such as games— we can use a <span class="cItalic">binary space partitioning</span> scheme closely related to the method for ray intersection discussed in the previous section. The difference is that for visibility sorting we use non—axis-aligned splitting planes, so that the planes can be made coincident with the polygons. This leads to an elegant algorithm known as the BSP tree algorithm to order the surfaces from front to back. The key aspect of the BSP tree is that it uses a preprocess to create a data structure that is useful for any viewpoint. So, as the viewpoint changes, the same data structure is used without change.</p>
<h3><a id="sec12-4-1"></a>12.4.1 Overview of BSP Tree Algorithm</h3>
<p>The BSP tree algorithm is an example of a <span class="cItalic">painter’s algorithm</span>. A painter’s algorithm draws every object from back-to-front, with each new polygon potentially overdrawing previous polygons, as is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-33">Figure 12.33</a>. It can be implemented as follows:</p>
<div id="art_Dest_fig_12-33" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-33"></a><span class="cBold">Figure 12.33</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-33.png" alt="Figure showing a painter’s algorithm starts with a blank image and then draws the scene one object at a time from back-to-front, overdrawing whatever is already there. This automatically eliminates hidden surfaces." width="576" height="800" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-33.png"></p>
<p class="Text figcaption">A painter’s algorithm starts with a blank image and then draws the scene one object at a time from back-to-front, overdrawing whatever is already there. This automatically eliminates hidden surfaces.</p>
</div>
<pre><span class="code">sort objects back to front relative to viewpoint</span></pre>
<pre><span class="code"><span class="cBold">for</span> each object <span class="cBold">do</span></span></pre>
<pre><span class="code"> draw object on screen</span></pre>
<p>The problem with the first step (the sort) is that the relative order of multiple objects is not always well defined, even if the order of every pair of objects is. This problem is illustrated in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-34">Figure 12.34</a> where the three triangles form a <span class="cItalic">cycle</span>.</p>
<div id="art_Dest_fig_12-34" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-34"></a><span class="cBold">Figure 12.34</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-34.png" alt="Figure showing a cycle occurs if a global back-to-front ordering is not possible for a particular eye position." width="409" height="283" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-34.png"></p>
<p class="Text figcaption">A cycle occurs if a global back-to-front ordering is not possible for a particular eye position.</p>
</div>
<p>The BSP tree algorithm works on any scene composed of polygons where no polygon crosses the plane defined by any other polygon. This restriction is then relaxed by a preprocessing step. For the rest of this discussion, triangles are assumed to be the only primitive, but the ideas extend to arbitrary polygons.</p>
<p>The basic idea of the BSP tree can be illustrated with two triangles, <span class="cItalic">T</span><span class="cSubscript">1</span> and <span class="cItalic">T</span><span class="cSubscript">2</span>. We first recall (see <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C002.xhtml#sec2-5-3">Section 2.5.3</a>) the implicit plane equation of the plane containing <span class="cItalic">T</span><span class="cSubscript">1</span>: <span class="cItalic">f</span><span class="cSubscript">1</span>(<span class="cBold">p</span>) = 0. The key property of implicit planes that we wish to take advantage of is that for all points p<span class="cSuperscript">+</span> on one side of the plane, <span class="cItalic">f</span><span class="cSubscript">1</span>(<span class="cBold">p</span><span class="cSuperscript">+</span>) <span class="cItalic">&gt;</span> 0; and for all points <span class="cBold">p</span><span class="cSuperscript">−</span> on the other side of the plane, <span class="cItalic">f</span><span class="cSubscript">1</span>(<span class="cBold">p</span><span class="cSuperscript">−</span>) &lt; 0. Using this property, we can find out on which side of the plane <span class="cItalic">T</span><span class="cSubscript">2</span> lies. Again, this assumes all three vertices of <span class="cItalic">T</span><span class="cSubscript">2</span> are on the same side of the plane. For discussion, assume <a id="page_310"></a> that <span class="cItalic">T</span><span class="cSubscript">2</span> is on the <span class="cItalic">f</span><span class="cSubscript">1</span>(<span class="cBold">p</span>) &lt; 0 side of the plane. Then, we can draw <span class="cItalic">T</span><span class="cSubscript">1</span> and <span class="cItalic">T</span><span class="cSubscript">2</span> in the right order for any eyepoint e:</p>
<pre><span class="code"><span class="cBold">if</span> (<span class="cItalic">f</span><span class="cSubscript">1</span>(<span class="cBold">e</span>) &lt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code">  draw <span class="cItalic">T</span><span class="cSubscript">1</span></span></pre>
<pre><span class="code">  draw <span class="cItalic">T</span><span class="cSubscript">2</span></span></pre>
<pre><span class="code"><span class="cBold">else</span></span></pre>
<pre><span class="code">  draw <span class="cItalic">T</span><span class="cSubscript">2</span></span></pre>
<pre><span class="code">  draw <span class="cItalic">T</span><span class="cSubscript">1</span></span></pre>
<p>The reason this works is that if <span class="cItalic">T</span><span class="cSubscript">2</span> and e are on the same side of the plane containing <span class="cItalic">T</span><span class="cSubscript">1</span>, there is no way for <span class="cItalic">T</span><span class="cSubscript">2</span> to be fully or partially blocked by <span class="cItalic">T</span><span class="cSubscript">1</span> as seen <a id="page_311"></a>from e, so it is safe to draw <span class="cItalic">T</span><span class="cSubscript">1</span> first. If e and <span class="cItalic">T</span><span class="cSubscript">2</span> are on opposite sides of the plane containing <span class="cItalic">T</span><span class="cSubscript">1</span>, then <span class="cItalic">T</span><span class="cSubscript">2</span> cannot fully or partially block <span class="cItalic">T</span><span class="cSubscript">1</span>, and the opposite drawing order is safe (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-35">Figure 12.35</a>).</p>
<div id="art_Dest_fig_12-35" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-35"></a><span class="cBold">Figure 12.35</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-35.png" alt="Figure showing when e and T2 are on opposite sides of the plane containing T1, then it is safe to draw T2 first and T1 second. If e and T2 are on the same side of the plane, then T1 should be drawn before T2. This is the core idea of the BSP tree algorithm." width="600" height="353" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-35.png"></p>
<p class="Text figcaption">When <span class="cBold">e</span> and <span class="cItalic">T<span class="cSubscript">2</span></span> are on opposite sides of the plane containing <span class="cItalic">T<span class="cSubscript">1</span></span>, then it is safe to draw <span class="cItalic">T<span class="cSubscript">2</span></span> first and <span class="cItalic">T<span class="cSubscript">1</span></span> second. If <span class="cBold">e</span> and <span class="cItalic">T<span class="cSubscript">2</span></span> are on the same side of the plane, then <span class="cItalic">T<span class="cSubscript">1</span></span> should be drawn before <span class="cItalic">T<span class="cSubscript">2</span></span>. This is the core idea of the BSP tree algorithm.</p>
</div>
<p>This observation can be generalized to many objects provided none of them span the plane defined by <span class="cItalic">T</span><span class="cSubscript">1</span>. If we use a binary tree data structure with <span class="cItalic">T</span><span class="cSubscript">1</span> as root, the <span class="cItalic">negative</span> branch of the tree contains all the triangles whose vertices have <span class="cItalic">f<span class="cSubscript">i</span></span>(<span class="cBold">p</span>) &lt; 0, and the <span class="cItalic">positive</span> branch of the tree contains all the triangles whose vertices have <span class="cItalic">f<span class="cSubscript">i</span></span>(<span class="cBold">p</span>) &gt; 0. We can draw in proper order as follows:</p>
<pre><span class="code"><span class="cBold">function</span> draw(bsptree tree, point <span class="cBold">e</span>)</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (tree.empty) <span class="cBold">then</span></span></pre>
<pre><span class="code"> return</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (<span class="cItalic">f</span><span class="cSubscript">tree.root</span>(<span class="cBold">e</span>) &lt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> draw(tree.plus, <span class="cBold">e</span>)</span></pre>
<pre><span class="code"> rasterize tree.triangle</span></pre>
<pre><span class="code"> draw(tree.minus, <span class="cBold">e</span>)</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code"> draw(tree.minus, <span class="cBold">e</span>)</span></pre>
<pre><span class="code"> rasterize tree.triangle</span></pre>
<pre><span class="code"> draw(tree.plus, <span class="cBold">e</span>)</span></pre>
<p>The nice thing about that code is that it will work for any viewpoint e, so the tree can be precomputed. Note that, if each subtree is itself a tree, where the root triangle divides the other triangles into two groups relative to the plane containing it, the code will work as is. It can be made slightly more efficient by terminating the recursive calls one level higher, but the code will still be simple. A tree <a id="page_312"></a>illustrating this code is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-36">Figure 12.36</a>. As discussed in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C002.xhtml#sec2-5-5">Section 2.5.5</a>, the implicit equation for a point <span class="cBold">p</span> on a plane containing three non-colinear points <span class="cBold">a</span>, <span class="cBold">b</span>, and <span class="cBold">c</span> is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-415-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_5102_1&quot;&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xB7;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.&lt;/mn&gt;&lt;/mrow&gt;&lt;mtext&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;(12.1)&lt;/mtext&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_5102_1" overflow="scroll" style="width: 22.728em; display: inline-block;"><span style="display: inline-block; position: relative; width: 22.059em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.237em, 1021.97em, 2.573em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-22616"><span class="mrow" id="MathJax-Span-22617"><span class="mi" id="MathJax-Span-22618" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span class="mrow" id="MathJax-Span-22619" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22620" style="font-family: MathJax_Main;">(</span><span class="mstyle" id="MathJax-Span-22621"><span class="mrow" id="MathJax-Span-22622"><span class="mi" id="MathJax-Span-22623" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22624" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22625" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mrow" id="MathJax-Span-22626" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22627" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22628"><span class="mrow" id="MathJax-Span-22629"><span class="mo" id="MathJax-Span-22630" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22631"><span class="mstyle" id="MathJax-Span-22632"><span class="mrow" id="MathJax-Span-22633"><span class="mi" id="MathJax-Span-22634" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-22635" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22636" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22637"><span class="mi" id="MathJax-Span-22638" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22639" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22640" style="font-family: MathJax_Main; padding-left: 0.208em;">×</span><span class="mrow" id="MathJax-Span-22641" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22642" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22643"><span class="mstyle" id="MathJax-Span-22644"><span class="mrow" id="MathJax-Span-22645"><span class="mi" id="MathJax-Span-22646" style="font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-22647" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22648" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22649"><span class="mi" id="MathJax-Span-22650" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22651" style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-22652" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22653" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mrow" id="MathJax-Span-22654" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22655" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22656"><span class="mstyle" id="MathJax-Span-22657"><span class="mrow" id="MathJax-Span-22658"><span class="mi" id="MathJax-Span-22659" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22660" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22661" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22662"><span class="mi" id="MathJax-Span-22663" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22664" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22665" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mn" id="MathJax-Span-22666" style="font-family: MathJax_Main; padding-left: 0.26em;">0.</span></span><span class="mtext" id="MathJax-Span-22667" style="font-family: MathJax_Main;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(12.1)</span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_5102_1"><mrow><mi>f</mi><mrow><mo>(</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>×</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>·</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>=</mo><mn>0.</mn></mrow><mtext>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(12.1)</mtext></math></span></span><script type="math/mml" id="MathJax-Element-415"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_5102_1"><mrow><mi>f</mi><mrow><mo>(</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>)</mo></mrow><mo>=</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>×</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>·</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>=</mo><mn>0.</mn></mrow><mtext>        (12.1)</mtext></math></script></p>
<div id="art_Dest_fig_12-36" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-36"></a><span class="cBold">Figure 12.36</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-36.png" alt="Figure showing three triangles and a BSP tree that is valid for them. The “positive” and “negative” are encoded by right and left subtree position, respectively." width="600" height="435" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-36.png"></p>
<p class="Text figcaption">Three triangles and a BSP tree that is valid for them. The “positive” and “negative” are encoded by right and left subtree position, respectively.</p>
</div>
<p>It can be faster to store the <span class="cBold"><span class="cItalic">(A, B, C, D)</span></span> of the implicit equation of the form</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-416-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_5112_2&quot;&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0.&lt;/mn&gt;&lt;/mrow&gt;&lt;mtext&gt;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;&amp;#xA0;(12.2)&lt;/mtext&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_5112_2" overflow="scroll" style="width: 20.62em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.003em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1019.91em, 2.522em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22669"><span class="mrow" id="MathJax-Span-22670"><span class="mi" id="MathJax-Span-22671" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span class="mrow" id="MathJax-Span-22672" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22673" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22674"><span class="mi" id="MathJax-Span-22675" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-22676" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-22677" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22678" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-22679" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span class="mo" id="MathJax-Span-22680" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22681" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-22682" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">A</span><span class="mi" id="MathJax-Span-22683" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-22684" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22685" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">B</span><span class="mi" id="MathJax-Span-22686" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22687" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22688" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span class="mi" id="MathJax-Span-22689" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-22690" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22691" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">D</span><span class="mo" id="MathJax-Span-22692" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mn" id="MathJax-Span-22693" style="font-family: MathJax_Main; padding-left: 0.26em;">0.</span></span><span class="mtext" id="MathJax-Span-22694" style="font-family: MathJax_Main;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(12.2)</span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_5112_2"><mrow><mi>f</mi><mrow><mo>(</mo><mrow><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi></mrow><mo>)</mo></mrow><mo>=</mo><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>+</mo><mi>D</mi><mo>=</mo><mn>0.</mn></mrow><mtext>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(12.2)</mtext></math></span></span><script type="math/mml" id="MathJax-Element-416"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_5112_2"><mrow><mi>f</mi><mrow><mo>(</mo><mrow><mi>x</mi><mo>,</mo><mi>y</mi><mo>,</mo><mi>z</mi></mrow><mo>)</mo></mrow><mo>=</mo><mi>A</mi><mi>x</mi><mo>+</mo><mi>B</mi><mi>y</mi><mo>+</mo><mi>C</mi><mi>z</mi><mo>+</mo><mi>D</mi><mo>=</mo><mn>0.</mn></mrow><mtext>        (12.2)</mtext></math></script></p>
<p>Equations (12.1) and (12.2) are equivalent, as is clear when you recall that the gradient of the implicit equation is the normal to the triangle. The gradient of Equation (12.2) is <span class="cBold">n</span> = (<span class="cItalic">A</span>, <span class="cItalic">B</span>, <span class="cItalic">C</span>) which is just the normal vector</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-417-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_512&quot;&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xD7;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_512" overflow="scroll" style="width: 10.08em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.771em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.237em, 1009.68em, 2.573em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-22696"><span class="mrow" id="MathJax-Span-22697"><span class="mstyle" id="MathJax-Span-22698"><span class="mrow" id="MathJax-Span-22699"><span class="mi" id="MathJax-Span-22700" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-22701" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mrow" id="MathJax-Span-22702" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22703" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22704"><span class="mstyle" id="MathJax-Span-22705"><span class="mrow" id="MathJax-Span-22706"><span class="mi" id="MathJax-Span-22707" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-22708" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22709" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22710"><span class="mi" id="MathJax-Span-22711" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22712" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22713" style="font-family: MathJax_Main; padding-left: 0.208em;">×</span><span class="mrow" id="MathJax-Span-22714" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22715" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22716"><span class="mstyle" id="MathJax-Span-22717"><span class="mrow" id="MathJax-Span-22718"><span class="mi" id="MathJax-Span-22719" style="font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-22720" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22721" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22722"><span class="mi" id="MathJax-Span-22723" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22724" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22725" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_512"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>×</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-417"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_512"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>×</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></script></p>
<p>We can solve for <span class="cBold"><span class="cItalic">D</span></span> by plugging in any point on the plane, e.g., <span class="cBold">a</span>:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-418-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_513&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mtext&gt;n&lt;/mtext&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mtext&gt;a&lt;/mtext&gt;&lt;mtext&gt;.&lt;/mtext&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_513" overflow="scroll" style="width: 11.622em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.262em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.465em, 1011.12em, 3.242em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22727"><span class="mrow" id="MathJax-Span-22728"><span class="mtable" id="MathJax-Span-22729" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 10.954em; height: 0px;"><span style="position: absolute; clip: rect(2.522em, 1000.78em, 4.938em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.78em, 4.167em, -1000.01em); top: -4.676em; right: 0em;"><span class="mtd" id="MathJax-Span-22730"><span class="mrow" id="MathJax-Span-22731"><span class="mi" id="MathJax-Span-22732" style="font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.237em; right: 0em;"><span class="mtd" id="MathJax-Span-22752"><span class="mrow" id="MathJax-Span-22753"><span class="mrow" id="MathJax-Span-22754"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.47em, 1009.37em, 5.041em, -1000.01em); top: -4.008em; left: 1.648em;"><span style="display: inline-block; position: relative; width: 9.36em; height: 0px;"><span style="position: absolute; clip: rect(3.139em, 1009.37em, 4.373em, -1000.01em); top: -4.676em; left: 0em;"><span class="mtd" id="MathJax-Span-22733"><span class="mrow" id="MathJax-Span-22734"><span class="mrow" id="MathJax-Span-22735"><span class="mo" id="MathJax-Span-22736" style="font-family: MathJax_Main;">=</span><span class="mo" id="MathJax-Span-22737" style="font-family: MathJax_Main; padding-left: 0.26em;">−</span><span class="mi" id="MathJax-Span-22738" style="font-family: MathJax_Math-italic;">A</span><span class="msub" id="MathJax-Span-22739"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22740" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mi" id="MathJax-Span-22741" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22742" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mi" id="MathJax-Span-22743" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">B</span><span class="msub" id="MathJax-Span-22744"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22745" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.517em;"><span class="mi" id="MathJax-Span-22746" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22747" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mi" id="MathJax-Span-22748" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span class="msub" id="MathJax-Span-22749"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22750" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.465em;"><span class="mi" id="MathJax-Span-22751" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.293em, 1003.76em, 4.27em, -1000.01em); top: -3.237em; left: 0em;"><span class="mtd" id="MathJax-Span-22755"><span class="mrow" id="MathJax-Span-22756"><span class="mrow" id="MathJax-Span-22757"><span class="mo" id="MathJax-Span-22758" style="font-family: MathJax_Main;">=</span><span class="mo" id="MathJax-Span-22759" style="font-family: MathJax_Main; padding-left: 0.26em;">−</span><span class="mtext" id="MathJax-Span-22760" style="font-family: MathJax_Main;">n</span><span class="mo" id="MathJax-Span-22761" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mtext" id="MathJax-Span-22762" style="font-family: MathJax_Main; padding-left: 0.208em;">a</span><span class="mtext" id="MathJax-Span-22763" style="font-family: MathJax_Main;">.</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.056em; border-left: 0px solid; width: 0px; height: 2.598em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_513"><mrow><mtable><mtr><mtd columnalign="right"><mi>D</mi></mtd><mtd columnalign="left"><mrow><mo>=</mo><mo>−</mo><mi>A</mi><msub><mi>x</mi><mi>a</mi></msub><mo>−</mo><mi>B</mi><msub><mi>y</mi><mi>a</mi></msub><mo>−</mo><mi>C</mi><msub><mi>z</mi><mi>a</mi></msub></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mo>−</mo><mtext>n</mtext><mo>⋅</mo><mtext>a</mtext><mtext>.</mtext></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-418"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_513"><mrow><mtable><mtr><mtd columnalign="right"><mi>D</mi></mtd><mtd columnalign="left"><mrow><mo>=</mo><mo>−</mo><mi>A</mi><msub><mi>x</mi><mi>a</mi></msub><mo>−</mo><mi>B</mi><msub><mi>y</mi><mi>a</mi></msub><mo>−</mo><mi>C</mi><msub><mi>z</mi><mi>a</mi></msub></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mo>−</mo><mtext>n</mtext><mo>⋅</mo><mtext>a</mtext><mtext>.</mtext></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p><a id="page_313"></a>This suggests the for</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-419-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_514&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_514" overflow="scroll" style="width: 9.617em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.309em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-0.255em, 1009.16em, 4.013em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22765"><span class="mrow" id="MathJax-Span-22766"><span class="mtable" id="MathJax-Span-22767" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 9em; height: 0px;"><span style="position: absolute; clip: rect(2.419em, 1002.02em, 6.429em, -1000.01em); top: -4.728em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.111em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1002.02em, 4.424em, -1000.01em); top: -5.447em; right: 0em;"><span class="mtd" id="MathJax-Span-22768"><span class="mrow" id="MathJax-Span-22769"><span class="mrow" id="MathJax-Span-22770"><span class="mi" id="MathJax-Span-22771" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.054em;"></span></span><span class="mrow" id="MathJax-Span-22772" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22773" style="font-family: MathJax_Main;">(</span><span class="mstyle" id="MathJax-Span-22774"><span class="mrow" id="MathJax-Span-22775"><span class="mi" id="MathJax-Span-22776" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22777" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.956em; right: 0em;"><span class="mtd" id="MathJax-Span-22797"><span class="mrow" id="MathJax-Span-22798"><span class="mrow" id="MathJax-Span-22799"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -2.465em; right: 0em;"><span class="mtd" id="MathJax-Span-22819"><span class="mrow" id="MathJax-Span-22820"><span class="mrow" id="MathJax-Span-22821"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.733em;"></span></span><span style="position: absolute; clip: rect(2.573em, 1006.08em, 6.635em, -1000.01em); top: -4.728em; left: 2.933em;"><span style="display: inline-block; position: relative; width: 6.121em; height: 0px;"><span style="position: absolute; clip: rect(3.293em, 1006.08em, 4.373em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-22778"><span class="mrow" id="MathJax-Span-22779"><span class="mrow" id="MathJax-Span-22780"><span class="mo" id="MathJax-Span-22781" style="font-family: MathJax_Main;">=</span><span class="mstyle" id="MathJax-Span-22782" style="padding-left: 0.26em;"><span class="mrow" id="MathJax-Span-22783"><span class="mi" id="MathJax-Span-22784" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-22785" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mstyle" id="MathJax-Span-22786" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22787"><span class="mi" id="MathJax-Span-22788" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22789" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22790" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22791"><span class="mi" id="MathJax-Span-22792" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-22793" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mstyle" id="MathJax-Span-22794" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22795"><span class="mi" id="MathJax-Span-22796" style="font-family: MathJax_Main-bold;">a</span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1005.46em, 4.424em, -1000.01em); top: -3.956em; left: 0em;"><span class="mtd" id="MathJax-Span-22800"><span class="mrow" id="MathJax-Span-22801"><span class="mrow" id="MathJax-Span-22802"><span class="mo" id="MathJax-Span-22803" style="font-family: MathJax_Main;">=</span><span class="mstyle" id="MathJax-Span-22804" style="padding-left: 0.26em;"><span class="mrow" id="MathJax-Span-22805"><span class="mi" id="MathJax-Span-22806" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-22807" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mrow" id="MathJax-Span-22808" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22809" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22810"><span class="mstyle" id="MathJax-Span-22811"><span class="mrow" id="MathJax-Span-22812"><span class="mi" id="MathJax-Span-22813" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mo" id="MathJax-Span-22814" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22815" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22816"><span class="mi" id="MathJax-Span-22817" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22818" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1001.76em, 4.373em, -1000.01em); top: -2.465em; left: 0em;"><span class="mtd" id="MathJax-Span-22822"><span class="mrow" id="MathJax-Span-22823"><span class="mrow" id="MathJax-Span-22824"><span class="mo" id="MathJax-Span-22825" style="font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-22826" style="font-family: MathJax_Main; padding-left: 0.26em;">0</span><span class="mo" id="MathJax-Span-22827" style="font-family: MathJax_Main;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.733em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.851em; border-left: 0px solid; width: 0px; height: 4.186em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_514"><mrow><mtable><mtr><mtd columnalign="right"><mrow><mi>f</mi><mrow><mo>(</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mn>0</mn><mo>,</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-419"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_514"><mrow><mtable><mtr><mtd columnalign="right"><mrow><mi>f</mi><mrow><mo>(</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><mn>0</mn><mo>,</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p>which is the same as Equation (12.1) once you recall that <span class="cBold">n</span> is computed using the cross product. Which form of the plane equation you use and whether you store only the vertices, <span class="cBold">n</span> and the vertices, or <span class="cBold">n</span>, <span class="cItalic">D</span>, and the vertices, is probably a matter of taste—a classic time-storage tradeoff that will be settled best by profiling. For debugging, using Equation (12.1) is probably the best.</p>
<p>The only issue that prevents the code above from working in general is that one cannot guarantee that a triangle can be uniquely classified on one side of a plane or the other. It can have two vertices on one side of the plane and the third on the other. Or it can have vertices on the plane. This is handled by splitting the triangle into smaller triangles using the plane to “cut” them.</p>
<h3><a id="sec12-4-2"></a>12.4.2 Building the Tree</h3>
<p>If none of the triangles in the dataset cross each other’s planes, so that all triangles are on one side of all other triangles, a BSP tree that can be traversed using the code above can be built using the following algorith</p>
<pre><span class="code"> tree-root = node(<span class="cItalic">T</span><span class="cSubscript">1</span>)</span></pre>
<pre><span class="code"> <span class="cBold">for</span> <span class="cItalic">i∈{</span>2<span class="cItalic">,..., N}</span> <span class="cBold">do</span></span></pre>
<pre><span class="code"> tree-root.add(<span class="cItalic">T<span class="cSubscript">i</span></span>)</span></pre>
<pre><span class="code"><span class="cBold">function</span> add (triangle <span class="cItalic">T</span>)</span></pre>
<pre><span class="code"><span class="cBold"> if</span> (<span class="cItalic">f</span>(<span class="cBold">a</span>) &lt; 0 and <span class="cItalic">f</span>(<span class="cBold">b</span>) &lt; 0 and <span class="cItalic">f</span>(<span class="cBold">c</span>) &lt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">  if</span> (negative subtree is empty) <span class="cBold">then</span></span></pre>
<pre><span class="code">  negative-subtree = node(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code">  <span class="cBold">else</span></span></pre>
<pre><span class="code">  negative-subtree.add <span class="cItalic">(T)</span></span></pre>
<pre><span class="code"> <span class="cBold">else</span> <span class="cBold">if</span> (<span class="cItalic">f</span>(<span class="cBold">a</span>) &gt; 0 and <span class="cItalic">f</span>(<span class="cBold">b</span>) &gt; 0 and <span class="cItalic">f</span>(<span class="cBold">c</span>) &gt; 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> positive subtree is empty <span class="cBold">then</span></span></pre>
<pre><span class="code">  positive-subtree = node(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code">  <span class="cBold">else</span></span></pre>
<pre><span class="code">  positive-subtree.add(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code">  we have assumed this case is impossible</span></pre>
<p><a id="page_314"></a>The only thing we need to fix is the case where the triangle crosses the dividing plane, as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-37">Figure 12.37</a>. Assume, for simplicity, that the triangle has vertices <span class="cBold">a</span> and <span class="cBold">b</span> on one side of the plane, and vertex <span class="cBold">c</span> is on the other side. In this case, we can find the intersection points <span class="cBold">A</span> and <span class="cBold">B</span> and cut the triangle into three new triangles with vertices</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-420-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_515&quot;&gt;&lt;mtable columnalign=&quot;left&quot;&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_515" overflow="scroll" style="width: 7.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.046em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-0.306em, 1006.8em, 4.013em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22829"><span class="mtable" id="MathJax-Span-22830" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 6.738em; height: 0px;"><span style="position: absolute; clip: rect(2.573em, 1006.64em, 6.841em, -1000.01em); top: -4.933em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.738em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1006.39em, 4.424em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-22831"><span class="mrow" id="MathJax-Span-22832"><span class="msub" id="MathJax-Span-22833"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22834" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22835" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22836" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mrow" id="MathJax-Span-22837" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22838" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22839"><span class="mstyle" id="MathJax-Span-22840"><span class="mrow" id="MathJax-Span-22841"><span class="mi" id="MathJax-Span-22842" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-22843" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22844" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22845"><span class="mi" id="MathJax-Span-22846" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-22847" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22848" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22849"><span class="mi" id="MathJax-Span-22850" style="font-family: MathJax_Main-bold;">A</span></span></span></span><span class="mo" id="MathJax-Span-22851" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22852" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1006.64em, 4.424em, -1000.01em); top: -4.008em; left: 0em;"><span class="mtd" id="MathJax-Span-22853"><span class="mrow" id="MathJax-Span-22854"><span class="msub" id="MathJax-Span-22855"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22856" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22857" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22858" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mrow" id="MathJax-Span-22859" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22860" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22861"><span class="mstyle" id="MathJax-Span-22862"><span class="mrow" id="MathJax-Span-22863"><span class="mi" id="MathJax-Span-22864" style="font-family: MathJax_Main-bold;">b</span></span></span><span class="mo" id="MathJax-Span-22865" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22866" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22867"><span class="mi" id="MathJax-Span-22868" style="font-family: MathJax_Main-bold;">B</span></span></span><span class="mo" id="MathJax-Span-22869" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22870" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22871"><span class="mi" id="MathJax-Span-22872" style="font-family: MathJax_Main-bold;">A</span></span></span></span><span class="mo" id="MathJax-Span-22873" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22874" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1006.54em, 4.424em, -1000.01em); top: -2.517em; left: 0em;"><span class="mtd" id="MathJax-Span-22875"><span class="mrow" id="MathJax-Span-22876"><span class="msub" id="MathJax-Span-22877"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22878" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22879" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-22880" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mrow" id="MathJax-Span-22881" style="padding-left: 0.26em;"><span class="mo" id="MathJax-Span-22882" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22883"><span class="mstyle" id="MathJax-Span-22884"><span class="mrow" id="MathJax-Span-22885"><span class="mi" id="MathJax-Span-22886" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-22887" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22888" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22889"><span class="mi" id="MathJax-Span-22890" style="font-family: MathJax_Main-bold;">B</span></span></span><span class="mo" id="MathJax-Span-22891" style="font-family: MathJax_Main;">,</span><span class="mstyle" id="MathJax-Span-22892" style="padding-left: 0.157em;"><span class="mrow" id="MathJax-Span-22893"><span class="mi" id="MathJax-Span-22894" style="font-family: MathJax_Main-bold;">c</span></span></span></span><span class="mo" id="MathJax-Span-22895" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22896" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.938em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.851em; border-left: 0px solid; width: 0px; height: 4.239em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_515"><mtable columnalign="left"><mtr><mtd><msub><mi>T</mi><mn>1</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>T</mi><mn>2</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>B</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>T</mi><mn>3</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>B</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-420"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_515"><mtable columnalign="left"><mtr><mtd><msub><mi>T</mi><mn>1</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>T</mi><mn>2</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>b</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>B</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>T</mi><mn>3</mn></msub><mo>=</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>B</mi></mstyle><mo>,</mo><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle></mrow><mo>)</mo></mrow><mo>,</mo></mtd></mtr></mtable></math></script></p>
<div id="art_Dest_fig_12-37" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-37"></a><span class="cBold">Figure 12.37</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-37.png" alt="Figure showing when a triangle spans a plane, there will be one vertex on one side and two on the other." width="405" height="800" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-37.png"></p>
<p class="Text figcaption">When a triangle spans a plane, there will be one vertex on one side and two on the other.</p>
</div>
<p>as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-38">Figure 12.38</a>. This order of vertices is important so that the direction of the normal remains the same as for the original triangle. If we assume that <span class="cItalic">f</span>(<span class="cBold">c</span>) &lt; 0, the following code could add these three triangles to the tree assuming the positive and negative subtrees are not empty:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-421-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_516&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;positive-subtree&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;node&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;positive-subtree&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;node&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mtext&gt;negative-subtree&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mtext&gt;node&lt;/mtext&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;T&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_516" overflow="scroll" style="width: 13.165em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.753em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-0.306em, 1012.5em, 4.013em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22898"><span class="mtable" id="MathJax-Span-22899" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 12.445em; height: 0px;"><span style="position: absolute; clip: rect(2.573em, 1012.35em, 6.841em, -1000.01em); top: -4.933em; left: 0em;"><span style="display: inline-block; position: relative; width: 12.445em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1012.09em, 4.424em, -1000.01em); top: -5.447em; left: 50%; margin-left: -6.064em;"><span class="mtd" id="MathJax-Span-22900"><span class="mrow" id="MathJax-Span-22901"><span class="mtext" id="MathJax-Span-22902" style="font-family: MathJax_Main;">positive-subtree</span><span class="mo" id="MathJax-Span-22903" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mtext" id="MathJax-Span-22904" style="font-family: MathJax_Main; padding-left: 0.26em;">node</span><span class="mrow" id="MathJax-Span-22905" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22906" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22907"><span class="msub" id="MathJax-Span-22908"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22909" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22910" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-22911" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1012.09em, 4.424em, -1000.01em); top: -4.008em; left: 50%; margin-left: -6.064em;"><span class="mtd" id="MathJax-Span-22912"><span class="mrow" id="MathJax-Span-22913"><span class="mtext" id="MathJax-Span-22914" style="font-family: MathJax_Main;">positive-subtree</span><span class="mo" id="MathJax-Span-22915" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mtext" id="MathJax-Span-22916" style="font-family: MathJax_Main; padding-left: 0.26em;">node</span><span class="mrow" id="MathJax-Span-22917" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22918" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22919"><span class="msub" id="MathJax-Span-22920"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22921" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22922" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-22923" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1012.35em, 4.424em, -1000.01em); top: -2.517em; left: 50%; margin-left: -6.219em;"><span class="mtd" id="MathJax-Span-22924"><span class="mrow" id="MathJax-Span-22925"><span class="mtext" id="MathJax-Span-22926" style="font-family: MathJax_Main;">negative-subtree</span><span class="mo" id="MathJax-Span-22927" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mtext" id="MathJax-Span-22928" style="font-family: MathJax_Main; padding-left: 0.26em;">node</span><span class="mrow" id="MathJax-Span-22929" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22930" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22931"><span class="msub" id="MathJax-Span-22932"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-22933" style="font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.568em;"><span class="mn" id="MathJax-Span-22934" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-22935" style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.938em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.851em; border-left: 0px solid; width: 0px; height: 4.239em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_516"><mtable><mtr><mtd><mtext>positive-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>1</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>positive-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>2</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>negative-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>3</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-421"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_516"><mtable><mtr><mtd><mtext>positive-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>1</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>positive-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>2</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mtext>negative-subtree</mtext><mo>=</mo><mtext>node</mtext><mrow><mo>(</mo><mrow><msub><mi>T</mi><mn>3</mn></msub></mrow><mo>)</mo></mrow></mtd></mtr></mtable></math></script></p>
<div id="art_Dest_fig_12-38" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-38"></a><span class="cBold">Figure 12.38</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-38.png" alt="Figure showing when a triangle is cut, we break it into three triangles, none of which span the cutting plane." width="409" height="724" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-38.png"></p>
<p class="Text figcaption">When a triangle is cut, we break it into three triangles, none of which span the cutting plane.</p>
</div>
<p>A precision problem that will plague a naive implementation occurs when a vertex is very near the splitting plane. For example, if we have two vertices on one side of the splitting plane and the other vertex is only an extremely small distance on the other side, we will create a new triangle almost the same as the old one, a triangle that is a sliver, and a triangle of almost zero size. It would be better to detect this as a special case and not split into three new triangles. One might expect this case to be rare, but because many models have tessellated planes and triangles with shared vertices, it occurs frequently, and thus must be handled carefully. Some simple manipulations that accomplish this are:</p>
<pre><span class="code"><span class="cBold">function</span> add(triangle <span class="cItalic">T</span>)</span></pre>
<pre><span class="code"> fa = <span class="cItalic">f</span>(<span class="cBold">a</span>)</span></pre>
<pre><span class="code"> fb = <span class="cItalic">f</span>(<span class="cBold">b</span>)</span></pre>
<pre><span class="code"> fc = <span class="cItalic">f</span>(<span class="cBold">c</span>)</span></pre>
<pre><span class="code"> <span class="cBold">if</span> <span class="cItalic">(abs(fa) &lt; ε)</span> <span class="cBold">then</span></span></pre>
<pre><span class="code"> fa = 0</span></pre>
<pre><span class="code"> <span class="cBold">if</span> <span class="cItalic">(abs(fb) &lt; ε)</span> <span class="cBold">then</span></span></pre>
<pre><span class="code"> fb = 0</span></pre>
<pre><span class="code"> <span class="cBold">if</span> <span class="cItalic">(abs(fc) &lt; ε)</span> <span class="cBold">then</span></span></pre>
<pre><span class="code"> fc = 0</span></pre>
<pre><span class="code"> <span class="cBold">if</span> (<span class="cItalic">fa</span> ≤ 0 and fb ≤ 0 and fc ≤ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> (negative subtree is empty) <span class="cBold">then</span></span></pre>
<pre><span class="code">   negative-subtree = node(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code"><a id="page_315"></a> <span class="cBold">else</span></span></pre>
<pre><span class="code">   negative-subtree.add(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code"> <span class="cBold">else if</span> <span class="cItalic">(fa ≥</span> 0 and fb ≥ 0 and fc ≥ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code"> <span class="cBold">if</span> (positive subtree is empty) <span class="cBold">then</span></span></pre>
<pre><span class="code">   positive-subtree = node(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code">   positive-subtree.add(<span class="cItalic">T</span>)</span></pre>
<pre><span class="code"> <span class="cBold">else</span></span></pre>
<pre><span class="code"> cut triangle into three triangles and add to each side</span></pre>
<p>This takes any vertex whose <span class="cItalic">f</span> value is within e of the plane and counts it as positive or negative. The constant e is a small positive real chosen by the user. The technique above is a rare instance where testing for floating-point equality is useful and works because the zero value is set rather than being computed. Comparing for equality with a computed floating-point value is almost never advisable, but we are not doing that.</p>
<h3><a id="sec12-4-3"></a>12.4.3 Cutting Triangles</h3>
<p>Filling out the details of the last case “cut triangle into three triangles and add to each side” is straightforward, but tedious. We should take advantage of the BSP tree construction as a preprocess where highest efficiency is not key. Instead, we should attempt to have a clean compact code. A nice trick is to force many of the cases into one by ensuring that <span class="cBold">c</span> is on one side of the plane and the other two vertices are on the other. This is easily done with swaps. Filling out the details in the final else statement (assuming the subtrees are nonempty for simplicity) gives:</p>
<pre><span class="code"><span class="cBold">if</span> <span class="cItalic">(fa</span> * <span class="cItalic">fc</span> ≥ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code">  swap(<span class="cItalic">fb, fc)</span></span></pre>
<pre><span class="code">  swap(<span class="cBold">b</span><span class="cItalic">,</span> <span class="cBold">c</span>)</span></pre>
<pre><span class="code">  swap(<span class="cItalic">fa, fb)</span></span></pre>
<pre><span class="code">  swap(<span class="cBold">a, b</span>)</span></pre>
<pre><span class="code"><span class="cBold">else if</span> <span class="cItalic">(fb</span> * <span class="cItalic">fc</span> ≥ 0) <span class="cBold">then</span></span></pre>
<pre><span class="code">  swap(<span class="cItalic">fa, fc)</span></span></pre>
<pre><span class="code">  swap(<span class="cBold">a</span><span class="cItalic">,</span> <span class="cBold">c</span>)</span></pre>
<pre><span class="code">  swap(<span class="cItalic">fa, fb)</span></span></pre>
<pre><span class="code">  swap(<span class="cBold">a</span><span class="cItalic">,</span> <span class="cBold">b</span>)</span></pre>
<pre><span class="code">compute <span class="cBold">A</span></span></pre>
<pre><span class="code">compute <span class="cBold">B</span></span></pre>
<pre><span class="code"><span class="cItalic">T</span> <span class="cSubscript">1</span> = (<span class="cBold">a, b, A</span>)</span></pre>
<pre><span class="code"><span class="cItalic">T</span><span class="cSubscript">2</span> = (<span class="cBold">b, B, A</span>)</span></pre>
<pre><span class="code"><a id="page_316"></a><span class="cItalic">T</span><span class="cSubscript">3</span> = (<span class="cBold">A, B, c</span>)</span></pre>
<pre><span class="code"><span class="cBold">if</span> <span class="cItalic">(fc ≥</span> 0) <span class="cBold">then</span></span></pre>
<pre><span class="code">  negative-subtree.add(<span class="cItalic">T</span><span class="cSubscript">1</span>)</span></pre>
<pre><span class="code">  negative-subtree.add(<span class="cItalic">T</span><span class="cSubscript">2</span>)</span></pre>
<pre><span class="code">  positive-subtree.add(<span class="cItalic">T</span><span class="cSubscript">3</span>)</span></pre>
<pre><span class="code"><span class="cBold">else</span></span></pre>
<pre><span class="code">  positive-subtree.add(<span class="cItalic">T</span><span class="cSubscript">1</span>)</span></pre>
<pre><span class="code">  positive-subtree.add(<span class="cItalic">T</span><span class="cSubscript">2</span>)</span></pre>
<pre><span class="code">  negative-subtree.add(<span class="cItalic">T</span><span class="cSubscript">3</span>)</span></pre>
<p>This code takes advantage of the fact that the product of <span class="cItalic">a</span> and <span class="cItalic">b</span> are positive if they have the same sign—thus, the first if statement. If vertices are swapped, we must do two swaps to keep the vertices ordered counterclockwise. Note that exactly one of the vertices may lie exactly on the plane, in which case the code above will work, but one of the generated triangles will have zero area. This can be handled by ignoring the possibility, which is not that risky, because the rasterization code must handle zero-area triangles in screen space (i.e., edge-on triangles). You can also add a check that does not add zero-area triangles to the tree. Finally, you can put in a special case for when exactly one of <span class="cItalic">fa, fb,</span> and <span class="cItalic">fc</span> is zero which cuts the triangle into two triangles.</p>
<p>To compute <span class="cBold">A</span> and <span class="cBold">B</span>, a line segment and implicit plane intersection is needed. For example, the parametric line connecting <span class="cBold">a</span> and <span class="cBold">c</span> is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-422-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_517&quot;&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/mstyle&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_517" overflow="scroll" style="width: 9.206em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.949em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.237em, 1008.85em, 2.573em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-22937"><span class="mrow" id="MathJax-Span-22938"><span class="mstyle" id="MathJax-Span-22939"><span class="mrow" id="MathJax-Span-22940"><span class="mi" id="MathJax-Span-22941" style="font-family: MathJax_Main-bold;">p</span></span></span><span class="mrow" id="MathJax-Span-22942" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22943" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-22944" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-22945" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22946" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mstyle" id="MathJax-Span-22947" style="padding-left: 0.26em;"><span class="mrow" id="MathJax-Span-22948"><span class="mi" id="MathJax-Span-22949" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-22950" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22951" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">t</span><span class="mrow" id="MathJax-Span-22952" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22953" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22954"><span class="mstyle" id="MathJax-Span-22955"><span class="mrow" id="MathJax-Span-22956"><span class="mi" id="MathJax-Span-22957" style="font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-22958" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22959" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22960"><span class="mi" id="MathJax-Span-22961" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22962" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22963" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_517"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mrow><mo>(</mo><mi>t</mi><mo>)</mo></mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>t</mi><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-422"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_517"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>p</mi></mstyle><mrow><mo>(</mo><mi>t</mi><mo>)</mo></mrow><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>t</mi><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></script></p>
<p>The point of intersection with the plane <span class="cBold">n</span> · <span class="cBold">p</span> + <span class="cItalic">D</span> = 0 is found by plugging p(<span class="cItalic">t</span>) into the plane equation:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-423-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_518&quot;&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_518" overflow="scroll" style="width: 11.828em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.468em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.237em, 1011.42em, 2.573em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-22965"><span class="mrow" id="MathJax-Span-22966"><span class="mstyle" id="MathJax-Span-22967"><span class="mrow" id="MathJax-Span-22968"><span class="mi" id="MathJax-Span-22969" style="font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-22970" style="font-family: MathJax_Main; padding-left: 0.208em;">⋅</span><span class="mrow" id="MathJax-Span-22971" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-22972" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22973"><span class="mstyle" id="MathJax-Span-22974"><span class="mrow" id="MathJax-Span-22975"><span class="mi" id="MathJax-Span-22976" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-22977" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22978" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">t</span><span class="mrow" id="MathJax-Span-22979" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-22980" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-22981"><span class="mstyle" id="MathJax-Span-22982"><span class="mrow" id="MathJax-Span-22983"><span class="mi" id="MathJax-Span-22984" style="font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-22985" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-22986" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-22987"><span class="mi" id="MathJax-Span-22988" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-22989" style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-22990" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-22991" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-22992" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">D</span><span class="mo" id="MathJax-Span-22993" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mn" id="MathJax-Span-22994" style="font-family: MathJax_Main; padding-left: 0.26em;">0</span><span class="mo" id="MathJax-Span-22995" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_518"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>t</mi><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>+</mo><mi>D</mi><mo>=</mo><mn>0</mn><mo>,</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-423"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_518"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>t</mi><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><mo>+</mo><mi>D</mi><mo>=</mo><mn>0</mn><mo>,</mo></mrow></math></script></p>
<p>and solving for <span class="cItalic">t</span>:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-424-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_519&quot;&gt;&lt;mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_519" overflow="scroll" style="width: 5.71em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.555em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.031em, 1005.46em, 2.882em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-22997"><span class="mrow" id="MathJax-Span-22998"><span class="mi" id="MathJax-Span-22999" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-23000" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mo" id="MathJax-Span-23001" style="font-family: MathJax_Main; padding-left: 0.26em;">−</span><span class="mfrac" id="MathJax-Span-23002"><span style="display: inline-block; position: relative; width: 2.625em; height: 0px; margin-right: 0.105em; margin-left: 0.105em;"><span style="position: absolute; clip: rect(3.396em, 1002.17em, 4.219em, -1000.01em); top: -4.47em; left: 50%; margin-left: -1.077em;"><span class="mrow" id="MathJax-Span-23003"><span class="mstyle" id="MathJax-Span-23004"><span class="mrow" id="MathJax-Span-23005"><span class="mi" id="MathJax-Span-23006" style="font-size: 70.7%; font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-23007" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="mstyle" id="MathJax-Span-23008"><span class="mrow" id="MathJax-Span-23009"><span class="mi" id="MathJax-Span-23010" style="font-size: 70.7%; font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-23011" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-23012" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.345em, 1002.43em, 4.321em, -1000.01em); top: -3.596em; left: 50%; margin-left: -1.231em;"><span class="mrow" id="MathJax-Span-23013"><span class="mstyle" id="MathJax-Span-23014"><span class="mrow" id="MathJax-Span-23015"><span class="mi" id="MathJax-Span-23016" style="font-size: 70.7%; font-family: MathJax_Main-bold;">n</span></span></span><span class="mo" id="MathJax-Span-23017" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="mrow" id="MathJax-Span-23018"><span class="mo" id="MathJax-Span-23019" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23020"><span class="mstyle" id="MathJax-Span-23021"><span class="mrow" id="MathJax-Span-23022"><span class="mi" id="MathJax-Span-23023" style="font-size: 70.7%; font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-23024" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mstyle" id="MathJax-Span-23025"><span class="mrow" id="MathJax-Span-23026"><span class="mi" id="MathJax-Span-23027" style="font-size: 70.7%; font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-23028" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(0.877em, 1002.63em, 1.237em, -1000.01em); top: -1.283em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.625em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.082em;"></span></span></span></span><span class="mo" id="MathJax-Span-23029" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.686em; border-left: 0px solid; width: 0px; height: 1.697em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_519"><mrow><mi>t</mi><mo>=</mo><mo>−</mo><mfrac><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>D</mi></mrow><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow></mfrac><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-424"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_519"><mrow><mi>t</mi><mo>=</mo><mo>−</mo><mfrac><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><mi>D</mi></mrow><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>n</mi></mstyle><mo>⋅</mo><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow></mrow></mfrac><mo>.</mo></mrow></math></script></p>
<p>Calling this solution <span class="cItalic">tA</span>, we can write the expression for <span class="cBold">A</span>:</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-425-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_520&quot;&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;/mstyle&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mstyle mathvariant=&quot;bold&quot; mathsize=&quot;normal&quot;&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;/mstyle&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_520" overflow="scroll" style="width: 8.743em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.486em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.237em, 1008.39em, 2.573em, -1000.01em); top: -2.157em; left: 0em;"><span class="mrow" id="MathJax-Span-23031"><span class="mrow" id="MathJax-Span-23032"><span class="mstyle" id="MathJax-Span-23033"><span class="mrow" id="MathJax-Span-23034"><span class="mi" id="MathJax-Span-23035" style="font-family: MathJax_Main-bold;">A</span></span></span><span class="mo" id="MathJax-Span-23036" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mstyle" id="MathJax-Span-23037" style="padding-left: 0.26em;"><span class="mrow" id="MathJax-Span-23038"><span class="mi" id="MathJax-Span-23039" style="font-family: MathJax_Main-bold;">a</span></span></span><span class="mo" id="MathJax-Span-23040" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23041" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.979em; height: 0px;"><span style="position: absolute; clip: rect(3.242em, 1000.32em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23042" style="font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.362em;"><span class="mi" id="MathJax-Span-23043" style="font-size: 70.7%; font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23044" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23045" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23046"><span class="mstyle" id="MathJax-Span-23047"><span class="mrow" id="MathJax-Span-23048"><span class="mi" id="MathJax-Span-23049" style="font-family: MathJax_Main-bold;">c</span></span></span><span class="mo" id="MathJax-Span-23050" style="font-family: MathJax_Main; padding-left: 0.208em;">−</span><span class="mstyle" id="MathJax-Span-23051" style="padding-left: 0.208em;"><span class="mrow" id="MathJax-Span-23052"><span class="mi" id="MathJax-Span-23053" style="font-family: MathJax_Main-bold;">a</span></span></span></span><span class="mo" id="MathJax-Span-23054" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23055" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.162em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.315em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_520"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><msub><mi>t</mi><mi>A</mi></msub><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-425"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_520"><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>A</mi></mstyle><mo>=</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle><mo>+</mo><msub><mi>t</mi><mi>A</mi></msub><mrow><mo>(</mo><mrow><mstyle mathvariant="bold" mathsize="normal"><mi>c</mi></mstyle><mo>−</mo><mstyle mathvariant="bold" mathsize="normal"><mi>a</mi></mstyle></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></script></p>
<p>A similar computation will give <span class="cBold">B</span>.</p>
<h3><a id="sec12-4-4"></a><a id="page_317"></a>12.4.4 Optimizing the Tree</h3>
<p>The efficiency of tree creation is much less of a concern than tree traversal because it is a preprocess. The traversal of the BSP tree takes time proportional to the number of nodes in the tree. (How well balanced the tree is does not matter.) There will be one node for each triangle, including the triangles that are created as a result of splitting. This number can depend on the order in which triangles are added to the tree. For example, in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-39">Figure 12.39</a>, if <span class="cItalic">T</span><span class="cSubscript">1</span> is the root, there will be two nodes in the tree, but if <span class="cItalic">T</span><span class="cSubscript">2</span> is the root, there will be more nodes, because <span class="cItalic">T</span><span class="cSubscript">1</span> will be split.</p>
<div id="art_Dest_fig_12-39" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-39"></a><span class="cBold">Figure 12.39</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-39.png" alt="Figure showing using T1 as the root of a BSP tree will result in a tree with two nodes. Using T2 as the root will require a cut and thus make a larger tree." width="410" height="453" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-39.png"></p>
<p class="Text figcaption">Using <span class="cItalic">T</span><span class="cSubscript">1</span> as the root of a BSP tree will result in a tree with two nodes. Using <span class="cItalic">T</span><span class="cSubscript">2</span> as the root will require a cut and thus make a larger tree.</p>
</div>
<p>It is difficult to find the “best” order of triangles to add to the tree. For <span class="cItalic">N</span> triangles, there are <span class="cItalic">N</span>! orderings that are possible. So trying all orderings is not usually feasible. Alternatively, some predetermined number of orderings can be tried from a random collection of permutations, and the best one can be kept for the final tree.</p>
<p>The splitting algorithm described above splits one triangle into three triangles. It could be more efficient to split a triangle into a triangle and a convex quadrilateral. This is probably not worth it if all input models have only triangles, but would be easy to support for implementations that accommodate arbitrary polygons.</p>
<h2><a id="sec12-5"></a>12.5 Tiling Multidimensional Arrays</h2>
<p>Effectively utilizing the memory hierarchy is a crucial task in designing algorithms for modern architectures. Making sure that multidimensional arrays have data in a “nice” arrangement is accomplished by <span class="cItalic">tiling</span>, sometimes also called <span class="cItalic">bricking</span>. A traditional 2D array is stored as a 1D array together with an indexing mechanism; for example, an <span class="cItalic">N<span class="cSubscript">x</span></span> by <span class="cItalic">N<span class="cSubscript">y</span></span> array is stored in a 1D array of length <span class="cItalic">N<span class="cSubscript">x</span>N<span class="cSubscript">y</span></span> and the 2D index (<span class="cItalic">x, y</span>) (which runs from (0, 0) to (<span class="cItalic">N<span class="cSubscript">x</span></span> −1, <span class="cItalic">N<span class="cSubscript">y</span></span> −1)) maps to the 1D index (running from 0 to <span class="cItalic">N<span class="cSubscript">x</span>N<span class="cSubscript">y</span></span> − 1) using the formula</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-426-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_521&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;index&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_521" overflow="scroll" style="width: 7.715em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.458em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.288em, 1007.36em, 2.47em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23057"><span class="mrow" id="MathJax-Span-23058"><span class="mtext" id="MathJax-Span-23059" style="font-family: MathJax_Main;">index</span><span class="mo" id="MathJax-Span-23060" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23061" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">x</span><span class="mo" id="MathJax-Span-23062" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23063" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23064" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23065" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-23066" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23067" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.262em; border-left: 0px solid; width: 0px; height: 1.009em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_521"><mrow><mtext>index</mtext><mo>=</mo><mi>x</mi><mo>+</mo><msub><mi>N</mi><mi>x</mi></msub><mi>y</mi><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-426"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_521"><mrow><mtext>index</mtext><mo>=</mo><mi>x</mi><mo>+</mo><msub><mi>N</mi><mi>x</mi></msub><mi>y</mi><mo>.</mo></mrow></math></script></p>
<p>An example of how that memory lays out is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-40">Figure 12.40</a>. A problem with this layout is that although two adjacent array elements that are in the same row are next to each other in memory, two adjacent elements in the same column will be separated by <span class="cItalic">N<span class="cSubscript">x</span></span> elements in memory. This can cause poor memory locality for large <span class="cItalic">N<span class="cSubscript">x</span></span>. The standard solution to this is to use <span class="cItalic">tiles</span> to make memory <a id="page_318"></a>locality for rows and columns more equal. An example is shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-41">Figure 12.41</a> where 2 <span class="cItalic">×</span> 2 tiles are used. The details of indexing such an array are discussed in the next section. A more complicated example, with two levels of tiling on a 3D array, is covered after that.</p>
<div id="art_Dest_fig_12-40" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-40"></a><span class="cBold">Figure 12.40</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-40.png" alt="Figure showing the memory layout for an untiled 2D array with Nx = 4 and Ny = 3." width="410" height="320" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-40.png"></p>
<p class="Text figcaption">The memory layout for an untiled 2D array with <span class="cItalic">N<span class="cSubscript">x</span></span> = <span class="cItalic">4</span> and <span class="cItalic">N<span class="cSubscript">y</span></span> = <span class="cItalic">3</span>.</p>
</div>
<div id="art_Dest_fig_12-41" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-41"></a><span class="cBold">Figure 12.41</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-41.png" alt="Figure showing the memory layout for a tiled 2D array with Nx = 4 and Ny = 3 and 2 × 2 tiles. Note that padding on the top of the array is needed because Ny is not a multiple of the tile size two." width="409" height="394" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-41.png"></p>
<p class="Text figcaption">The memory layout for a tiled 2D array with <span class="cItalic">N<span class="cSubscript">x</span></span> = <span class="cItalic">4</span> and <span class="cItalic">N<span class="cSubscript">y</span></span> = <span class="cItalic">3</span> and 2 <span class="cItalic">×</span> 2 tiles. Note that padding on the top of the array is needed because <span class="cItalic">N<span class="cSubscript">y</span></span> is not a multiple of the tile size two.</p>
</div>
<p>A key question is what size to make the tiles. In practice, they should be similar to the memory-unit size on the machine. For example, if we are using 16-bit (2-byte) data values on a machine with 128-byte cache lines, 8 × 8 tiles fit exactly in a cache line. However, using 32-bit floating-point numbers, which fit 32 elements to a cache line, 5 × 5 tiles are a bit too small and 6 × 6 tiles are a bit too large. Because there are also coarser-sized memory units such as pages, hierarchical tiling with similar logic can be useful.</p>
<h3><a id="sec12-5-1"></a>12.5.1 One-Level Tiling for 2D Arrays</h3>
<p>If we assume an <span class="cItalic">N<span class="cSubscript">x</span>×N<span class="cSubscript">y</span></span> array decomposed into square <span class="cItalic">n×n</span> tiles (<a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-42">Figure 12.42</a>), then the number of tiles required is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-427-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_522&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_522" overflow="scroll" style="width: 5.967em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.761em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.465em, 1005.51em, 3.293em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23069"><span class="mtable" id="MathJax-Span-23070" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 5.452em; height: 0px;"><span style="position: absolute; clip: rect(2.419em, 1005.41em, 5.195em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.452em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1005.41em, 4.424em, -1000.01em); top: -4.728em; left: 50%; margin-left: -2.722em;"><span class="mtd" id="MathJax-Span-23071"><span class="mrow" id="MathJax-Span-23072"><span class="mi" id="MathJax-Span-23073" style="font-family: MathJax_Math-italic;">B</span><span class="mi" id="MathJax-Span-23074" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23075" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23076" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span class="mi" id="MathJax-Span-23077" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23078" style="font-family: MathJax_Main;">/</span><span class="mi" id="MathJax-Span-23079" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23080" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1005.25em, 4.424em, -1000.01em); top: -3.237em; left: 50%; margin-left: -2.671em;"><span class="mtd" id="MathJax-Span-23081"><span class="mrow" id="MathJax-Span-23082"><span class="mi" id="MathJax-Span-23083" style="font-family: MathJax_Math-italic;">B</span><span class="mi" id="MathJax-Span-23084" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23085" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23086" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span class="mi" id="MathJax-Span-23087" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23088" style="font-family: MathJax_Main;">/</span><span class="mi" id="MathJax-Span-23089" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23090" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.109em; border-left: 0px solid; width: 0px; height: 2.703em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_522"><mtable><mtr><mtd><mi>B</mi><mi>x</mi><mo>=</mo><mi>N</mi><mi>x</mi><mo>/</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><mi>B</mi><mi>y</mi><mo>=</mo><mi>N</mi><mi>y</mi><mo>/</mo><mi>n</mi><mo>.</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-427"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_522"><mtable><mtr><mtd><mi>B</mi><mi>x</mi><mo>=</mo><mi>N</mi><mi>x</mi><mo>/</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><mi>B</mi><mi>y</mi><mo>=</mo><mi>N</mi><mi>y</mi><mo>/</mo><mi>n</mi><mo>.</mo></mtd></mtr></mtable></math></script></p>
<div id="art_Dest_fig_12-42" class="ArtGroup">
<p class="Text fignumber"><a id="Text_Anchor_fig_12-42"></a><span class="cBold">Figure 12.42</span></p>
<p class="ObjectLine"><img src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/fig12-42.png" alt="Figure showing a tiled 2D array composed of Bx × By tiles each of size n by n." width="600" height="421" data-mfp-src="/library/view/fundamentals-of-computer/9781482229417/image/fig12-42.png"></p>
<p class="Text figcaption">A tiled 2D array composed of <span class="cItalic">B<span class="cSubscript">x</span> × B<span class="cSubscript">y</span></span> tiles each of size <span class="cItalic">n</span> by <span class="cItalic">n</span>.</p>
</div>
<p>Here, we assume that <span class="cItalic">n</span> divides <span class="cItalic">N<span class="cSubscript">x</span></span> and <span class="cItalic">N<span class="cSubscript">y</span></span> exactly. When this is not true, the array should be <span class="cItalic">padded</span>. For example, if <span class="cItalic">N<span class="cSubscript">x</span></span> = 15 and <span class="cItalic">n</span> = 4, then <span class="cItalic">N<span class="cSubscript">x</span></span> should be changed to 16. To work out a formula for indexing such an array, we first find <a id="page_319"></a>the tile indices <span class="cItalic">(b<span class="cSubscript">x</span>, b<span class="cSubscript">y</span>)</span> that give the row/column for the tiles (the tiles themselves form a 2D array):</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-428-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_523&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_523" overflow="scroll" style="width: 5.812em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.607em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.465em, 1005.36em, 3.293em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23092"><span class="mtable" id="MathJax-Span-23093" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 5.298em; height: 0px;"><span style="position: absolute; clip: rect(2.47em, 1005.25em, 5.195em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.298em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1005.25em, 4.373em, -1000.01em); top: -4.728em; left: 50%; margin-left: -2.671em;"><span class="mtd" id="MathJax-Span-23094"><span class="mrow" id="MathJax-Span-23095"><span class="msub" id="MathJax-Span-23096"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23097" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23098" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23099" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23100" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">x</span><span class="mi" id="MathJax-Span-23101" style="font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-23102" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23103" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span><span class="mo" id="MathJax-Span-23104" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.19em, 1004.64em, 4.476em, -1000.01em); top: -3.288em; left: 50%; margin-left: -2.362em;"><span class="mtd" id="MathJax-Span-23105"><span class="mrow" id="MathJax-Span-23106"><span class="msub" id="MathJax-Span-23107"><span style="display: inline-block; position: relative; width: 0.877em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23108" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23109" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23110" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23111" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23112" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23113" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span><span class="mo" id="MathJax-Span-23114" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.109em; border-left: 0px solid; width: 0px; height: 2.703em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_523"><mtable><mtr><mtd><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mi>x</mi><mi>s</mi><mo>÷</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>b</mi><mi>y</mi></msub><mo>=</mo><mi>y</mi><mo>÷</mo><mi>n</mi><mo>,</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-428"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_523"><mtable><mtr><mtd><msub><mi>b</mi><mi>x</mi></msub><mo>=</mo><mi>x</mi><mi>s</mi><mo>÷</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><msub><mi>b</mi><mi>y</mi></msub><mo>=</mo><mi>y</mi><mo>÷</mo><mi>n</mi><mo>,</mo></mtd></mtr></mtable></math></script></p>
<p>where ÷ is integer division, e.g., 12 ÷ 5 = 2. If we order the tiles along rows as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-40">Figure 12.40</a>, then the index of the first element of the tile <span class="cItalic">(b<span class="cSubscript">x</span>, b<span class="cSubscript">y</span>)</span> is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-429-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_524&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;index&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_524" overflow="scroll" style="width: 10.594em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.285em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.134em, 1010.19em, 2.573em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23116"><span class="mrow" id="MathJax-Span-23117"><span class="mtext" id="MathJax-Span-23118" style="font-family: MathJax_Main;">index</span><span class="mo" id="MathJax-Span-23119" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msup" id="MathJax-Span-23120" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23121" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23122" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23123" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23124" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23125"><span class="msub" id="MathJax-Span-23126"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.78em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23127" style="font-family: MathJax_Math-italic;">B</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.774em;"><span class="mi" id="MathJax-Span-23128" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-23129"><span style="display: inline-block; position: relative; width: 0.877em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23130" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23131" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23132" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23133" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23134" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23135" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-23136" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23137" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.274em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_524"><mrow><mtext>index</mtext><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>B</mi><mi>x</mi></msub><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><msub><mi>b</mi><mi>x</mi></msub></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-429"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_524"><mrow><mtext>index</mtext><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>B</mi><mi>x</mi></msub><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><msub><mi>b</mi><mi>x</mi></msub></mrow><mo>)</mo></mrow><mo>.</mo></mrow></math></script></p>
<p>The memory in that tile is arranged like a traditional 2D array as shown in <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#Text_Anchor_fig_12-41">Figure 12.41</a>. The partial offsets (<span class="cItalic">x', y')</span> inside the tile are</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-430-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_525&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_525" overflow="scroll" style="width: 7.046em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.841em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.465em, 1006.59em, 3.242em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23139"><span class="mtable" id="MathJax-Span-23140" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 6.532em; height: 0px;"><span style="position: absolute; clip: rect(2.368em, 1006.49em, 5.144em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 6.532em; height: 0px;"><span style="position: absolute; clip: rect(3.036em, 1006.49em, 4.373em, -1000.01em); top: -4.676em; left: 50%; margin-left: -3.288em;"><span class="mtd" id="MathJax-Span-23141"><span class="mrow" id="MathJax-Span-23142"><span class="msup" id="MathJax-Span-23143"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23144" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23145" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23146" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23147" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">x</span><span class="mi" id="MathJax-Span-23148" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23149" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23150" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23151" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1006.39em, 4.373em, -1000.01em); top: -3.237em; left: 50%; margin-left: -3.237em;"><span class="mtd" id="MathJax-Span-23152"><span class="mrow" id="MathJax-Span-23153"><span class="msup" id="MathJax-Span-23154"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23155" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23156" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23157" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="mi" id="MathJax-Span-23158" style="font-family: MathJax_Math-italic; padding-left: 0.26em;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23159" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23160" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23161" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23162" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.056em; border-left: 0px solid; width: 0px; height: 2.598em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_525"><mtable><mtr><mtd><msup><mi>x</mi><mo>′</mo></msup><mo>=</mo><mi>x</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><msup><mi>y</mi><mo>′</mo></msup><mo>=</mo><mi>y</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi><mo>,</mo></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-430"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_525"><mtable><mtr><mtd><msup><mi>x</mi><mo>′</mo></msup><mo>=</mo><mi>x</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi><mo>,</mo></mtd></mtr><mtr><mtd><msup><mi>y</mi><mo>′</mo></msup><mo>=</mo><mi>y</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi><mo>,</mo></mtd></mtr></mtable></math></script></p>
<p>where mod is the remainder operator, e.g., 12 mod 5 = 2. Therefore, the offset inside the tile is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-431-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_526&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;offset&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_526" overflow="scroll" style="width: 7.612em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.355em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1007.26em, 2.47em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23164"><span class="mrow" id="MathJax-Span-23165"><span class="mtext" id="MathJax-Span-23166" style="font-family: MathJax_Main;">offset</span><span class="mo" id="MathJax-Span-23167" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msup" id="MathJax-Span-23168" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23169" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23170" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-23171" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23172" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msup" id="MathJax-Span-23173" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23174" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23175" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23176" style="font-family: MathJax_Main;">.</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.262em; border-left: 0px solid; width: 0px; height: 1.115em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_526"><mrow><mtext>offset</mtext><mo>=</mo><msup><mi>y</mi><mo>′</mo></msup><mi>n</mi><mo>+</mo><msup><mi>x</mi><mo>′</mo></msup><mo>.</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-431"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_526"><mrow><mtext>offset</mtext><mo>=</mo><msup><mi>y</mi><mo>′</mo></msup><mi>n</mi><mo>+</mo><msup><mi>x</mi><mo>′</mo></msup><mo>.</mo></mrow></math></script></p>
<p>Thus the full formula for finding the 1D index element (<span class="cItalic">x, y)</span> in an <span class="cItalic">N<span class="cSubscript">x</span></span> × <span class="cItalic">N<span class="cSubscript">y</span></span> array with <span class="cItalic">n × n</span> tiles is</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-432-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_527&quot;&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;index&lt;/mtext&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;b&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x2032;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd /&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;=&lt;/mtext&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_527" overflow="scroll" style="width: 31.108em; display: inline-block;"><span style="display: inline-block; position: relative; width: 30.183em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.362em, 1029.93em, 3.345em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23178"><span class="mtable" id="MathJax-Span-23179" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 29.874em; height: 0px;"><span style="position: absolute; clip: rect(2.419em, 1002.38em, 4.99em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.368em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1002.38em, 4.167em, -1000.01em); top: -4.728em; left: 0em;"><span class="mtd" id="MathJax-Span-23180"><span class="mrow" id="MathJax-Span-23181"><span class="mrow" id="MathJax-Span-23182"><span class="mtext" id="MathJax-Span-23183" style="font-family: MathJax_Main;">index</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.185em; left: 50%; margin-left: 0em;"><span class="mtd" id="MathJax-Span-23215"><span class="mrow" id="MathJax-Span-23216"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.265em, 1026.59em, 5.247em, -1000.01em); top: -4.008em; left: 3.19em;"><span style="display: inline-block; position: relative; width: 26.687em; height: 0px;"><span style="position: absolute; clip: rect(3.036em, 1012.04em, 4.476em, -1000.01em); top: -4.728em; left: 0em;"><span class="mtd" id="MathJax-Span-23184"><span class="mrow" id="MathJax-Span-23185"><span class="mrow" id="MathJax-Span-23186"><span class="mo" id="MathJax-Span-23187" style="font-family: MathJax_Main;">=</span><span class="msup" id="MathJax-Span-23188" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23189" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23190" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23191" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23192" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23193"><span class="msub" id="MathJax-Span-23194"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.78em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23195" style="font-family: MathJax_Math-italic;">B</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.774em;"><span class="mi" id="MathJax-Span-23196" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msub" id="MathJax-Span-23197"><span style="display: inline-block; position: relative; width: 0.877em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23198" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23199" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23200" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23201" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.928em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.42em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23202" style="font-family: MathJax_Math-italic;">b</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.414em;"><span class="mi" id="MathJax-Span-23203" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-23204" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23205" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msup" id="MathJax-Span-23206" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.47em, 4.373em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23207" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23208" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-23209" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-23210" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msup" id="MathJax-Span-23211" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 0.825em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.52em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23212" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.568em;"><span class="mo" id="MathJax-Span-23213" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23214" style="font-family: MathJax_Main;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1026.59em, 4.424em, -1000.01em); top: -3.185em; left: 0em;"><span class="mtd" id="MathJax-Span-23217"><span class="mrow" id="MathJax-Span-23218"><span class="mrow" id="MathJax-Span-23219"><span class="mtext" id="MathJax-Span-23220" style="font-family: MathJax_Main;">=</span><span class="msup" id="MathJax-Span-23221"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23222" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23223" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23224" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23225" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23226"><span class="mrow" id="MathJax-Span-23227"><span class="mo" id="MathJax-Span-23228" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23229"><span class="msub" id="MathJax-Span-23230"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23231" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23232" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23233" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23234" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23235" style="font-family: MathJax_Main;">)</span></span><span class="mrow" id="MathJax-Span-23236" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23237" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23238"><span class="mi" id="MathJax-Span-23239" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23240" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23241" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23242" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23243" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mi" id="MathJax-Span-23244" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">x</span><span class="mo" id="MathJax-Span-23245" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23246" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23247" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23248" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mrow" id="MathJax-Span-23249" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-23250" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23251"><span class="mi" id="MathJax-Span-23252" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23253" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23254" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23255" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23256" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mi" id="MathJax-Span-23257" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">n</span><span class="mo" id="MathJax-Span-23258" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mrow" id="MathJax-Span-23259" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-23260" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23261"><span class="mi" id="MathJax-Span-23262" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-23263" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23264" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23265" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23266" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23267" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.162em; border-left: 0px solid; width: 0px; height: 2.809em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_527"><mtable><mtr><mtd columnalign="left"><mrow><mtext>index</mtext></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>B</mi><mi>x</mi></msub><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><msub><mi>b</mi><mi>x</mi></msub></mrow><mo>)</mo></mrow><mo>+</mo><msup><mi>y</mi><mo>′</mo></msup><mi>n</mi><mo>+</mo><msup><mi>x</mi><mo>′</mo></msup><mo>,</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd columnalign="left"><mrow><mtext>=</mtext><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>x</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>.</mo></mrow></mtd></mtr></mtable></math></span></span><script type="math/mml" id="MathJax-Element-432"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_527"><mtable><mtr><mtd columnalign="left"><mrow><mtext>index</mtext></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>B</mi><mi>x</mi></msub><msub><mi>b</mi><mi>y</mi></msub><mo>+</mo><msub><mi>b</mi><mi>x</mi></msub></mrow><mo>)</mo></mrow><mo>+</mo><msup><mi>y</mi><mo>′</mo></msup><mi>n</mi><mo>+</mo><msup><mi>x</mi><mo>′</mo></msup><mo>,</mo></mrow></mtd></mtr><mtr><mtd></mtd><mtd columnalign="left"><mrow><mtext>=</mtext><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>x</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>.</mo></mrow></mtd></mtr></mtable></math></script></p>
<p>This expression contains many integer multiplication, divide and modulus operations, which are costly on some processors. When <span class="cItalic">n</span> is a power of two, these operations can be converted to bitshifts and bitwise logical operations. However, as noted above, the ideal size is not always a power of two. Some of the multiplications can be converted to shift/add operations, but the divide and modulus operations are more problematic. The indices could be computed incrementally, but this would require tracking counters, with numerous comparisons and poor branch prediction performance.</p>
<p>However, there is a simple solution; note that the index expression can be written as</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-433-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_528&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;index&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_528" overflow="scroll" style="width: 10.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.388em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1010.35em, 2.573em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23269"><span class="mrow" id="MathJax-Span-23270"><span class="mtext" id="MathJax-Span-23271" style="font-family: MathJax_Main;">index</span><span class="mo" id="MathJax-Span-23272" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-23273" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23274" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23275" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23276" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23277" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23278" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23279" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23280" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23281" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 1.082em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23282" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23283" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23284" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23285" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23286" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23287" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23288" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.168em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_528"><mrow><mtext>index</mtext><mo>=</mo><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow><mo>,</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-433"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_528"><mrow><mtext>index</mtext><mo>=</mo><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow><mo>,</mo></mrow></math></script></p>
<p>where</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-434-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_529&quot;&gt;&lt;mrow&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd columnalign=&quot;right&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_529" overflow="scroll" style="width: 20.723em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.106em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(0.362em, 1019.86em, 3.345em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23290"><span class="mrow" id="MathJax-Span-23291"><span class="mtable" id="MathJax-Span-23292" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 19.797em; height: 0px;"><span style="position: absolute; clip: rect(2.368em, 1002.53em, 5.247em, -1000.01em); top: -4.008em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.625em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1002.53em, 4.424em, -1000.01em); top: -4.728em; right: 0em;"><span class="mtd" id="MathJax-Span-23293"><span class="mrow" id="MathJax-Span-23294"><span class="mrow" id="MathJax-Span-23295"><span class="msub" id="MathJax-Span-23296"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23297" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23298" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23299" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23300" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23301" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23302" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1002.43em, 4.476em, -1000.01em); top: -3.237em; right: 0em;"><span class="mtd" id="MathJax-Span-23327"><span class="mrow" id="MathJax-Span-23328"><span class="mrow" id="MathJax-Span-23329"><span class="msub" id="MathJax-Span-23330"><span style="display: inline-block; position: relative; width: 1.082em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23331" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23332" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23333" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23334" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23335" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23336" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.265em, 1016.26em, 5.195em, -1000.01em); top: -4.008em; left: 3.447em;"><span style="display: inline-block; position: relative; width: 16.352em; height: 0px;"><span style="position: absolute; clip: rect(3.036em, 1011.84em, 4.424em, -1000.01em); top: -4.728em; left: 0em;"><span class="mtd" id="MathJax-Span-23303"><span class="mrow" id="MathJax-Span-23304"><span class="mrow" id="MathJax-Span-23305"><span class="mo" id="MathJax-Span-23306" style="font-family: MathJax_Main;">=</span><span class="msup" id="MathJax-Span-23307" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23308" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23309" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23310" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23311" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23312"><span class="mi" id="MathJax-Span-23313" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23314" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23315" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23316" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23317" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mrow" id="MathJax-Span-23318" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-23319" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23320"><span class="mi" id="MathJax-Span-23321" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-23322" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23323" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23324" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23325" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23326" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1016.26em, 4.424em, -1000.01em); top: -3.237em; left: 0em;"><span class="mtd" id="MathJax-Span-23337"><span class="mrow" id="MathJax-Span-23338"><span class="mrow" id="MathJax-Span-23339"><span class="mo" id="MathJax-Span-23340" style="font-family: MathJax_Main;">=</span><span class="msup" id="MathJax-Span-23341" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23342" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23343" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23344" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23345" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23346"><span class="msub" id="MathJax-Span-23347"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23348" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23349" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23350" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23351" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23352" style="font-family: MathJax_Main;">)</span></span><span class="mrow" id="MathJax-Span-23353" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23354" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23355"><span class="mi" id="MathJax-Span-23356" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23357" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23358" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23359" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23360" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="mrow" id="MathJax-Span-23361" style="padding-left: 0.208em;"><span class="mo" id="MathJax-Span-23362" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23363"><span class="mi" id="MathJax-Span-23364" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23365" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23366" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23367" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23368" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mi" id="MathJax-Span-23369" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">n</span><span class="mo" id="MathJax-Span-23370" style="font-family: MathJax_Main;">.</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.162em; border-left: 0px solid; width: 0px; height: 2.809em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_529"><mrow><mtable><mtr><mtd columnalign="right"><mrow><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>,</mo></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>x</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-434"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_529"><mrow><mtable><mtr><mtd columnalign="right"><mrow><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>,</mo></mrow></mtd></mtr><mtr><mtd columnalign="right"><mrow><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>x</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p>We tabulate <span class="cItalic">F<span class="cSubscript">x</span></span> and <span class="cItalic">F<span class="cSubscript">y</span></span>, and use <span class="cItalic">x</span> and <span class="cItalic">y</span> to find the index into the data array. These tables will consist of <span class="cItalic">N<span class="cSubscript">x</span></span> and <span class="cItalic">N<span class="cSubscript">y</span></span> elements, respectively. The total size of the tables will fit in the primary data cache of the processor, even for very large data set sizes.</p>
<h3><a id="sec12-5-2"></a><a id="page_320"></a>12.5.2 Example: Two-Level Tiling for 3D Arrays</h3>
<p>Effective TLB utilization is also becoming a crucial factor in algorithm performance. The same technique can be used to improve TLB hit rates in a 3D array by creating <span class="cItalic">m</span> × <span class="cItalic">m</span> × <span class="cItalic">m</span> bricks of <span class="cItalic">n</span> × <span class="cItalic">n</span> × <span class="cItalic">n</span> cells. For example, a 40 × 20 × 19 volume could be decomposed into 4 × 2 × 2 macrobricks of 2 × 2 × 2 bricks of 5 × 5 × 5 cells. This corresponds to <span class="cItalic">m</span> = 2 and <span class="cItalic">n</span> = 5. Because 19 cannot be factored by <span class="cItalic">mn</span> = 10, one level of padding is needed. Empirically useful sizes are <span class="cItalic">m</span> = 5 for 16-bit datasets and <span class="cItalic">m</span> = 6 for float datasets.</p>
<div class="Sidebar">
<p class="SidebarText">TLB: translation lookaside buffer, a cache that is part of the virtual memory system.</p>
</div>
<p>The resulting index into the data array can be computed for any (<span class="cItalic">x, y, z</span>) triple with the expression</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-435-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_530&quot;&gt;&lt;mrow&gt;&lt;mtable columnalign=&quot;left&quot;&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;d&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_530" overflow="scroll" style="width: 28.075em; display: inline-block;"><span style="display: inline-block; position: relative; width: 27.252em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-4.933em, 1027em, 8.64em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23372"><span class="mrow" id="MathJax-Span-23373"><span class="mtable" id="MathJax-Span-23374" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 26.944em; height: 0px;"><span style="position: absolute; clip: rect(6.995em, 1002.48em, 20.157em, -1000.01em); top: -13.879em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.522em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1002.48em, 4.167em, -1000.01em); top: -10.075em; left: 0em;"><span class="mtd" id="MathJax-Span-23375"><span class="mrow" id="MathJax-Span-23376"><span class="mrow" id="MathJax-Span-23377"><span class="mi" id="MathJax-Span-23378" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-23379" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-23380" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23381" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-23382" style="font-family: MathJax_Math-italic;">x</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -8.532em; left: 0em;"><span class="mtd" id="MathJax-Span-23438"><span class="mrow" id="MathJax-Span-23439"><span class="mrow" id="MathJax-Span-23440"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -6.99em; left: 0em;"><span class="mtd" id="MathJax-Span-23482"><span class="mrow" id="MathJax-Span-23483"><span class="mrow" id="MathJax-Span-23484"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -5.499em; left: 0em;"><span class="mtd" id="MathJax-Span-23511"><span class="mrow" id="MathJax-Span-23512"><span class="mrow" id="MathJax-Span-23513"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.956em; left: 0em;"><span class="mtd" id="MathJax-Span-23541"><span class="mrow" id="MathJax-Span-23542"><span class="mrow" id="MathJax-Span-23543"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -2.465em; left: 0em;"><span class="mtd" id="MathJax-Span-23569"><span class="mrow" id="MathJax-Span-23570"><span class="mrow" id="MathJax-Span-23571"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -0.923em; left: 0em;"><span class="mtd" id="MathJax-Span-23596"><span class="mrow" id="MathJax-Span-23597"><span class="mrow" id="MathJax-Span-23598"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 0.671em; left: 0em;"><span class="mtd" id="MathJax-Span-23623"><span class="mrow" id="MathJax-Span-23624"><span class="mrow" id="MathJax-Span-23625"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23642"><span class="mrow" id="MathJax-Span-23643"><span class="mrow" id="MathJax-Span-23644"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 13.884em;"></span></span><span style="position: absolute; clip: rect(6.995em, 1000.73em, 19.848em, -1000.01em); top: -13.571em; left: 3.293em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.499em, 1000.73em, 4.013em, -1000.01em); top: -10.075em; left: 0em;"><span class="mtd" id="MathJax-Span-23383"><span class="mrow" id="MathJax-Span-23384"><span class="mo" id="MathJax-Span-23385" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -8.532em; left: 0em;"><span class="mtd" id="MathJax-Span-23441"><span class="mrow" id="MathJax-Span-23442"><span class="mrow" id="MathJax-Span-23443"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -6.99em; left: 0em;"><span class="mtd" id="MathJax-Span-23485"><span class="mrow" id="MathJax-Span-23486"><span class="mrow" id="MathJax-Span-23487"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -5.499em; left: 0em;"><span class="mtd" id="MathJax-Span-23514"><span class="mrow" id="MathJax-Span-23515"><span class="mrow" id="MathJax-Span-23516"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.956em; left: 0em;"><span class="mtd" id="MathJax-Span-23544"><span class="mrow" id="MathJax-Span-23545"><span class="mrow" id="MathJax-Span-23546"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -2.465em; left: 0em;"><span class="mtd" id="MathJax-Span-23572"><span class="mrow" id="MathJax-Span-23573"><span class="mrow" id="MathJax-Span-23574"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -0.923em; left: 0em;"><span class="mtd" id="MathJax-Span-23599"><span class="mrow" id="MathJax-Span-23600"><span class="mrow" id="MathJax-Span-23601"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 0.671em; left: 0em;"><span class="mtd" id="MathJax-Span-23626"><span class="mrow" id="MathJax-Span-23627"><span class="mrow" id="MathJax-Span-23628"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23645"><span class="mrow" id="MathJax-Span-23646"><span class="mrow" id="MathJax-Span-23647"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 13.576em;"></span></span><span style="position: absolute; clip: rect(7.252em, 1021.97em, 20.825em, -1000.01em); top: -14.291em; left: 4.887em;"><span style="display: inline-block; position: relative; width: 22.059em; height: 0px;"><span style="position: absolute; clip: rect(3.036em, 1021.97em, 4.476em, -1000.01em); top: -10.075em; left: 0em;"><span class="mtd" id="MathJax-Span-23386"><span class="mrow" id="MathJax-Span-23387"><span class="mrow" id="MathJax-Span-23388"><span class="mrow" id="MathJax-Span-23389"><span class="mo" id="MathJax-Span-23390" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23391"><span class="mrow" id="MathJax-Span-23392"><span class="mo" id="MathJax-Span-23393" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23394"><span class="mi" id="MathJax-Span-23395" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23396" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23397" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23398" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23399" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23400" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23401" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23402" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23403" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23404" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23405"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23406" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23407" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23408" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23409" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23410"><span class="mrow" id="MathJax-Span-23411"><span class="mo" id="MathJax-Span-23412" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23413"><span class="msub" id="MathJax-Span-23414"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23415" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23416" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23417" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23418" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23419" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23420" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23421" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23422" style="font-family: MathJax_Main;">)</span></span><span class="mrow" id="MathJax-Span-23423" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23424" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23425"><span class="mrow" id="MathJax-Span-23426"><span class="mo" id="MathJax-Span-23427" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23428"><span class="msub" id="MathJax-Span-23429"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23430" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23431" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23432" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23433" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23434" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23435" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23436" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23437" style=""><span style="font-family: MathJax_Main;">)</span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1016.05em, 4.424em, -1000.01em); top: -8.532em; left: 0em;"><span class="mtd" id="MathJax-Span-23444"><span class="mrow" id="MathJax-Span-23445"><span class="mrow" id="MathJax-Span-23446"><span class="mo" id="MathJax-Span-23447" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23448" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23449" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23450"><span class="mrow" id="MathJax-Span-23451"><span class="mo" id="MathJax-Span-23452" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23453"><span class="mi" id="MathJax-Span-23454" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23455" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23456" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23457" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23458" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23459" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23460" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23461" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23462" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23463" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23464"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23465" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23466" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23467" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23468" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23469"><span class="mrow" id="MathJax-Span-23470"><span class="mo" id="MathJax-Span-23471" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23472"><span class="msub" id="MathJax-Span-23473"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23474" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23475" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23476" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23477" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23478" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23479" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23480" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23481" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1009.32em, 4.424em, -1000.01em); top: -6.99em; left: 0em;"><span class="mtd" id="MathJax-Span-23488"><span class="mrow" id="MathJax-Span-23489"><span class="mrow" id="MathJax-Span-23490"><span class="mo" id="MathJax-Span-23491" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23492" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23493" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23494"><span class="mrow" id="MathJax-Span-23495"><span class="mo" id="MathJax-Span-23496" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23497"><span class="mi" id="MathJax-Span-23498" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23499" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23500" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23501" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23502" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23503" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23504" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23505" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23506" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23507" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23508"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23509" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23510" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1011.17em, 4.424em, -1000.01em); top: -5.499em; left: 0em;"><span class="mtd" id="MathJax-Span-23517"><span class="mrow" id="MathJax-Span-23518"><span class="mrow" id="MathJax-Span-23519"><span class="mo" id="MathJax-Span-23520" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23521" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23522" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23523"><span class="mrow" id="MathJax-Span-23524"><span class="mo" id="MathJax-Span-23525" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23526"><span class="mi" id="MathJax-Span-23527" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23528" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23529" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23530" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23531" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23532" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23533" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23534" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23535" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23536" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23537" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23538"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23539" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23540" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1010.65em, 4.424em, -1000.01em); top: -3.956em; left: 0em;"><span class="mtd" id="MathJax-Span-23547"><span class="mrow" id="MathJax-Span-23548"><span class="mrow" id="MathJax-Span-23549"><span class="mo" id="MathJax-Span-23550" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23551" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23552" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23553"><span class="mrow" id="MathJax-Span-23554"><span class="mo" id="MathJax-Span-23555" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23556"><span class="mi" id="MathJax-Span-23557" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23558" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23559" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23560" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23561" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23562" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23563" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23564" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23565" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23566" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23567" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-23568" style="font-family: MathJax_Math-italic;">m</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1009.78em, 4.424em, -1000.01em); top: -2.465em; left: 0em;"><span class="mtd" id="MathJax-Span-23575"><span class="mrow" id="MathJax-Span-23576"><span class="mrow" id="MathJax-Span-23577"><span class="mo" id="MathJax-Span-23578" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23579" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23580" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23581"><span class="mrow" id="MathJax-Span-23582"><span class="mo" id="MathJax-Span-23583" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23584"><span class="mi" id="MathJax-Span-23585" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23586" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23587" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23588" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23589" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23590" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23591" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23592" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23593" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23594" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23595" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(2.985em, 1008.65em, 4.527em, -1000.01em); top: -0.923em; left: 0em;"><span class="mtd" id="MathJax-Span-23602"><span class="mrow" id="MathJax-Span-23603"><span class="mrow" id="MathJax-Span-23604"><span class="mo" id="MathJax-Span-23605" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23606" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23607" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-23608"><span class="mi" id="MathJax-Span-23609" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-23610" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23611" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mrow" id="MathJax-Span-23612" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23613" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">(</span></span><span class="mrow" id="MathJax-Span-23614"><span class="msup" id="MathJax-Span-23615"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23616" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23617" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span><span class="mo" id="MathJax-Span-23618" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span></span><span class="mo" id="MathJax-Span-23619" style="vertical-align: 0em;"><span style="font-family: MathJax_Size1;">)</span></span></span><span class="msup" id="MathJax-Span-23620" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23621" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23622" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1006.49em, 4.424em, -1000.01em); top: 0.671em; left: 0em;"><span class="mtd" id="MathJax-Span-23629"><span class="mrow" id="MathJax-Span-23630"><span class="mrow" id="MathJax-Span-23631"><span class="mo" id="MathJax-Span-23632" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23633" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23634" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23635"><span class="mi" id="MathJax-Span-23636" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23637" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23638" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23639" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23640" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mi" id="MathJax-Span-23641" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">n</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1006.08em, 4.424em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23648"><span class="mrow" id="MathJax-Span-23649"><span class="mrow" id="MathJax-Span-23650"><span class="mo" id="MathJax-Span-23651" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23652" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23653" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23654"><span class="mi" id="MathJax-Span-23655" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23656" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23657" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23658" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23659" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23660" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 14.296em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -6.617em; border-left: 0px solid; width: 0px; height: 13.771em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_530"><mrow><mtable columnalign="left"><mtr columnalign="left"><mtd columnalign="left"><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>y</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><mi>m</mi></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mrow><mo>(</mo><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>z</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>,</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-435"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_530"><mrow><mtable columnalign="left"><mtr columnalign="left"><mtd columnalign="left"><mrow><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>y</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><mi>m</mi></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo> ​⁡</mo><mrow><mo>(</mo><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><mo>)</mo></mrow></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>z</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>,</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<p>where <span class="cItalic">N<span class="cSubscript">x</span></span>, <span class="cItalic">N<span class="cSubscript">y</span></span> and <span class="cItalic">N<span class="cSubscript">z</span></span> are the respective sizes of the dataset.</p>
<p>Note that, as in the simpler 2D one-level case, this expression can be written as</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-436-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_531&quot;&gt;&lt;mrow&gt;&lt;mtext&gt;index&lt;/mtext&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_531" overflow="scroll" style="width: 14.45em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.039em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(1.185em, 1014em, 2.573em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23662"><span class="mrow" id="MathJax-Span-23663"><span class="mtext" id="MathJax-Span-23664" style="font-family: MathJax_Main;">index</span><span class="mo" id="MathJax-Span-23665" style="font-family: MathJax_Main; padding-left: 0.26em;">=</span><span class="msub" id="MathJax-Span-23666" style="padding-left: 0.26em;"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23667" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23668" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23669" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23670" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23671" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23672" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23673" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23674" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 1.082em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23675" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23676" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23677" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23678" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23679" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23680" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23681" style="font-family: MathJax_Main; padding-left: 0.208em;">+</span><span class="msub" id="MathJax-Span-23682" style="padding-left: 0.208em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23683" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23684" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23685" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23686" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23687" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23688" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23689" style="font-family: MathJax_Main; padding-left: 0.157em;">,</span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.368em; border-left: 0px solid; width: 0px; height: 1.168em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_531"><mrow><mtext>index</mtext><mo>=</mo><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>z</mi></msub><mrow><mo>(</mo><mi>z</mi><mo>)</mo></mrow><mo>,</mo></mrow></math></span></span><script type="math/mml" id="MathJax-Element-436"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_531"><mrow><mtext>index</mtext><mo>=</mo><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow><mo>+</mo><msub><mi>F</mi><mi>z</mi></msub><mrow><mo>(</mo><mi>z</mi><mo>)</mo></mrow><mo>,</mo></mrow></math></script></p>
<p>where</p>
<p class="Equation"><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-437-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; overflow=&quot;scroll&quot; id=&quot;eq_532&quot;&gt;&lt;mrow&gt;&lt;mtable columnalign=&quot;left&quot;&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msup&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;F&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;msup&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mo&gt;&amp;#xF7;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;msup&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mn&gt;3&lt;/mn&gt;&lt;/msup&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr columnalign=&quot;left&quot;&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow /&gt;&lt;/mtd&gt;&lt;mtd columnalign=&quot;left&quot;&gt;&lt;mrow&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;mi&gt;mod&lt;/mi&gt;&lt;mo&gt;&amp;#xA0;&amp;#x200B;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mrow&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="eq_532" overflow="scroll" style="width: 28.229em; display: inline-block;"><span style="display: inline-block; position: relative; width: 27.406em; height: 0px; font-size: 103%;"><span style="position: absolute; clip: rect(-4.882em, 1027.16em, 8.64em, -1000.01em); top: -2.105em; left: 0em;"><span class="mrow" id="MathJax-Span-23691"><span class="mrow" id="MathJax-Span-23692"><span class="mtable" id="MathJax-Span-23693" style="padding-right: 0.157em; padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 27.098em; height: 0px;"><span style="position: absolute; clip: rect(6.944em, 1002.53em, 20.157em, -1000.01em); top: -13.879em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.625em; height: 0px;"><span style="position: absolute; clip: rect(3.087em, 1002.53em, 4.424em, -1000.01em); top: -10.023em; left: 0em;"><span class="mtd" id="MathJax-Span-23694"><span class="mrow" id="MathJax-Span-23695"><span class="mrow" id="MathJax-Span-23696"><span class="msub" id="MathJax-Span-23697"><span style="display: inline-block; position: relative; width: 1.134em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23698" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23699" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23700" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23701" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23702" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23703" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -8.481em; left: 0em;"><span class="mtd" id="MathJax-Span-23759"><span class="mrow" id="MathJax-Span-23760"><span class="mrow" id="MathJax-Span-23761"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -6.938em; left: 0em;"><span class="mtd" id="MathJax-Span-23789"><span class="mrow" id="MathJax-Span-23790"><span class="mrow" id="MathJax-Span-23791"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1002.43em, 4.476em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-23811"><span class="mrow" id="MathJax-Span-23812"><span class="mrow" id="MathJax-Span-23813"><span class="msub" id="MathJax-Span-23814"><span style="display: inline-block; position: relative; width: 1.082em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23815" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23816" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23817" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23818" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23819" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23820" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.905em; left: 0em;"><span class="mtd" id="MathJax-Span-23861"><span class="mrow" id="MathJax-Span-23862"><span class="mrow" id="MathJax-Span-23863"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -2.414em; left: 0em;"><span class="mtd" id="MathJax-Span-23890"><span class="mrow" id="MathJax-Span-23891"><span class="mrow" id="MathJax-Span-23892"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.087em, 1002.38em, 4.424em, -1000.01em); top: -0.871em; left: 0em;"><span class="mtd" id="MathJax-Span-23910"><span class="mrow" id="MathJax-Span-23911"><span class="mrow" id="MathJax-Span-23912"><span class="msub" id="MathJax-Span-23913"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.73em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23914" style="font-family: MathJax_Math-italic;">F<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.671em;"><span class="mi" id="MathJax-Span-23915" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23916" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23917" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-23918" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23919" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 0.62em; left: 0em;"><span class="mtd" id="MathJax-Span-23945"><span class="mrow" id="MathJax-Span-23946"><span class="mrow" id="MathJax-Span-23947"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23972"><span class="mrow" id="MathJax-Span-23973"><span class="mrow" id="MathJax-Span-23974"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 13.884em;"></span></span><span style="position: absolute; clip: rect(6.995em, 1000.73em, 19.797em, -1000.01em); top: -13.519em; left: 3.447em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.499em, 1000.73em, 4.013em, -1000.01em); top: -10.023em; left: 0em;"><span class="mtd" id="MathJax-Span-23704"><span class="mrow" id="MathJax-Span-23705"><span class="mo" id="MathJax-Span-23706" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -8.481em; left: 0em;"><span class="mtd" id="MathJax-Span-23762"><span class="mrow" id="MathJax-Span-23763"><span class="mrow" id="MathJax-Span-23764"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -6.938em; left: 0em;"><span class="mtd" id="MathJax-Span-23792"><span class="mrow" id="MathJax-Span-23793"><span class="mrow" id="MathJax-Span-23794"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.499em, 1000.73em, 4.013em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-23821"><span class="mrow" id="MathJax-Span-23822"><span class="mo" id="MathJax-Span-23823" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -3.905em; left: 0em;"><span class="mtd" id="MathJax-Span-23864"><span class="mrow" id="MathJax-Span-23865"><span class="mrow" id="MathJax-Span-23866"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: -2.414em; left: 0em;"><span class="mtd" id="MathJax-Span-23893"><span class="mrow" id="MathJax-Span-23894"><span class="mrow" id="MathJax-Span-23895"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.499em, 1000.73em, 4.013em, -1000.01em); top: -0.871em; left: 0em;"><span class="mtd" id="MathJax-Span-23920"><span class="mrow" id="MathJax-Span-23921"><span class="mo" id="MathJax-Span-23922" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 0.62em; left: 0em;"><span class="mtd" id="MathJax-Span-23948"><span class="mrow" id="MathJax-Span-23949"><span class="mrow" id="MathJax-Span-23950"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.859em, 1000.01em, 4.167em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23975"><span class="mrow" id="MathJax-Span-23976"><span class="mrow" id="MathJax-Span-23977"></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 13.525em;"></span></span><span style="position: absolute; clip: rect(7.252em, 1021.97em, 20.774em, -1000.01em); top: -14.239em; left: 4.99em;"><span style="display: inline-block; position: relative; width: 22.059em; height: 0px;"><span style="position: absolute; clip: rect(3.036em, 1021.97em, 4.476em, -1000.01em); top: -10.023em; left: 0em;"><span class="mtd" id="MathJax-Span-23707"><span class="mrow" id="MathJax-Span-23708"><span class="mrow" id="MathJax-Span-23709"><span class="mrow" id="MathJax-Span-23710"><span class="mo" id="MathJax-Span-23711" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23712"><span class="mrow" id="MathJax-Span-23713"><span class="mo" id="MathJax-Span-23714" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23715"><span class="mi" id="MathJax-Span-23716" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23717" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23718" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23719" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23720" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23721" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23722" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23723" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23724" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23725" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23726"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23727" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23728" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23729" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23730" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23731"><span class="mrow" id="MathJax-Span-23732"><span class="mo" id="MathJax-Span-23733" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23734"><span class="msub" id="MathJax-Span-23735"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23736" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23737" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23738" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23739" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23740" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23741" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23742" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23743" style="font-family: MathJax_Main;">)</span></span><span class="mrow" id="MathJax-Span-23744" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23745" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23746"><span class="mrow" id="MathJax-Span-23747"><span class="mo" id="MathJax-Span-23748" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23749"><span class="msub" id="MathJax-Span-23750"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23751" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23752" style="font-size: 70.7%; font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23753" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23754" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23755" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23756" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23757" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23758" style=""><span style="font-family: MathJax_Main;">)</span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1011.17em, 4.424em, -1000.01em); top: -8.481em; left: 0em;"><span class="mtd" id="MathJax-Span-23765"><span class="mrow" id="MathJax-Span-23766"><span class="mrow" id="MathJax-Span-23767"><span class="mo" id="MathJax-Span-23768" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23769" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23770" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23771"><span class="mrow" id="MathJax-Span-23772"><span class="mo" id="MathJax-Span-23773" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23774"><span class="mi" id="MathJax-Span-23775" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-23776" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23777" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23778" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23779" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23780" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23781" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23782" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23783" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23784" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23785" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23786"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23787" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23788" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1007.26em, 4.424em, -1000.01em); top: -6.938em; left: 0em;"><span class="mtd" id="MathJax-Span-23795"><span class="mrow" id="MathJax-Span-23796"><span class="mrow" id="MathJax-Span-23797"><span class="mo" id="MathJax-Span-23798" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23799" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23800" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23801"><span class="mi" id="MathJax-Span-23802" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-23803" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23804" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23805" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23806" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23807" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23808" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23809" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23810" style="font-family: MathJax_Main;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1015.13em, 4.424em, -1000.01em); top: -5.447em; left: 0em;"><span class="mtd" id="MathJax-Span-23824"><span class="mrow" id="MathJax-Span-23825"><span class="mrow" id="MathJax-Span-23826"><span class="mrow" id="MathJax-Span-23827"><span class="mo" id="MathJax-Span-23828" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23829"><span class="mrow" id="MathJax-Span-23830"><span class="mo" id="MathJax-Span-23831" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23832"><span class="mi" id="MathJax-Span-23833" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23834" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23835" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23836" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23837" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23838" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23839" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23840" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23841" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23842" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23843"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23844" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23845" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mrow" id="MathJax-Span-23846" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23847" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23848"><span class="mrow" id="MathJax-Span-23849"><span class="mo" id="MathJax-Span-23850" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23851"><span class="msub" id="MathJax-Span-23852"><span style="display: inline-block; position: relative; width: 1.237em; height: 0px;"><span style="position: absolute; clip: rect(3.19em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23853" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.105em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -3.854em; left: 0.825em;"><span class="mi" id="MathJax-Span-23854" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mo" id="MathJax-Span-23855" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23856" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23857" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23858" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23859" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23860" style="font-family: MathJax_Main;">)</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1011.42em, 4.424em, -1000.01em); top: -3.905em; left: 0em;"><span class="mtd" id="MathJax-Span-23867"><span class="mrow" id="MathJax-Span-23868"><span class="mrow" id="MathJax-Span-23869"><span class="mo" id="MathJax-Span-23870" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23871" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23872" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23873"><span class="mrow" id="MathJax-Span-23874"><span class="mo" id="MathJax-Span-23875" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23876"><span class="mi" id="MathJax-Span-23877" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23878" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23879" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23880" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23881" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23882" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23883" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23884" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23885" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23886" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23887" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="mi" id="MathJax-Span-23888" style="font-family: MathJax_Math-italic;">m</span><span class="mo" id="MathJax-Span-23889" style="font-family: MathJax_Main;">+</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1006.75em, 4.424em, -1000.01em); top: -2.414em; left: 0em;"><span class="mtd" id="MathJax-Span-23896"><span class="mrow" id="MathJax-Span-23897"><span class="mrow" id="MathJax-Span-23898"><span class="mo" id="MathJax-Span-23899" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23900" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23901" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23902"><span class="mi" id="MathJax-Span-23903" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23904" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23905" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23906" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23907" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mi" id="MathJax-Span-23908" style="font-family: MathJax_Math-italic; padding-left: 0.157em;">n</span><span class="mo" id="MathJax-Span-23909" style="font-family: MathJax_Main;">,</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1008.39em, 4.424em, -1000.01em); top: -0.871em; left: 0em;"><span class="mtd" id="MathJax-Span-23923"><span class="mrow" id="MathJax-Span-23924"><span class="mrow" id="MathJax-Span-23925"><span class="mrow" id="MathJax-Span-23926"><span class="mo" id="MathJax-Span-23927" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23928"><span class="mrow" id="MathJax-Span-23929"><span class="mo" id="MathJax-Span-23930" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23931"><span class="mi" id="MathJax-Span-23932" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23933" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23934" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23935" style="font-family: MathJax_Main;">)</span></span><span class="mo" id="MathJax-Span-23936" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23937" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">m</span></span><span class="mo" id="MathJax-Span-23938" style="font-family: MathJax_Main;">)</span></span><span class="msup" id="MathJax-Span-23939" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23940" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23941" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span><span class="msup" id="MathJax-Span-23942"><span style="display: inline-block; position: relative; width: 1.288em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.88em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23943" style="font-family: MathJax_Math-italic;">m</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.877em;"><span class="mn" id="MathJax-Span-23944" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1009.78em, 4.424em, -1000.01em); top: 0.62em; left: 0em;"><span class="mtd" id="MathJax-Span-23951"><span class="mrow" id="MathJax-Span-23952"><span class="mrow" id="MathJax-Span-23953"><span class="mo" id="MathJax-Span-23954" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23955" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23956" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23957"><span class="mrow" id="MathJax-Span-23958"><span class="mo" id="MathJax-Span-23959" style="font-family: MathJax_Main;">(</span><span class="mrow" id="MathJax-Span-23960"><span class="mi" id="MathJax-Span-23961" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-23962" style="font-family: MathJax_Main; padding-left: 0.208em;">÷</span><span class="mi" id="MathJax-Span-23963" style="font-family: MathJax_Math-italic; padding-left: 0.208em;">n</span></span><span class="mo" id="MathJax-Span-23964" style="font-family: MathJax_Main;">)</span></span><span class="mi" id="MathJax-Span-23965" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23966" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23967" style="font-family: MathJax_Math-italic;">m</span></span><span class="mo" id="MathJax-Span-23968" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="msup" id="MathJax-Span-23969" style="padding-left: 0.157em;"><span style="display: inline-block; position: relative; width: 1.031em; height: 0px;"><span style="position: absolute; clip: rect(3.396em, 1000.58em, 4.167em, -1000.01em); top: -4.008em; left: 0em;"><span class="mi" id="MathJax-Span-23970" style="font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; top: -4.368em; left: 0.62em;"><span class="mn" id="MathJax-Span-23971" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span><span style="position: absolute; clip: rect(3.036em, 1006.08em, 4.424em, -1000.01em); top: 2.111em; left: 0em;"><span class="mtd" id="MathJax-Span-23978"><span class="mrow" id="MathJax-Span-23979"><span class="mrow" id="MathJax-Span-23980"><span class="mo" id="MathJax-Span-23981" style="font-family: MathJax_Main;">+</span><span class="mrow" id="MathJax-Span-23982" style="padding-left: 0.157em;"><span class="mo" id="MathJax-Span-23983" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mrow" id="MathJax-Span-23984"><span class="mi" id="MathJax-Span-23985" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mi" id="MathJax-Span-23986" style="font-family: MathJax_Main; padding-left: 0.157em;">mod</span><span class="mo" id="MathJax-Span-23987" style="font-family: MathJax_Main; padding-left: 0.157em;">&nbsp;<span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 97%; font-style: normal; font-weight: normal;">​</span></span><span class="mi" id="MathJax-Span-23988" style="font-family: MathJax_Math-italic;">n</span></span><span class="mo" id="MathJax-Span-23989" style=""><span style="font-family: MathJax_Main;">)</span></span></span><span class="mo" id="MathJax-Span-23990" style="font-family: MathJax_Main; padding-left: 0.157em;">.</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.013em;"></span></span></span><span style="display: inline-block; width: 0px; height: 14.244em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.111em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -6.617em; border-left: 0px solid; width: 0px; height: 13.718em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_532"><mrow><mtable columnalign="left"><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>y</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>2</mn></msup><mo>,</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><mi>m</mi><mo>+</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>,</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>z</mi></msub><mrow><mo>(</mo><mi>z</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>z</mi><mi>mod</mi><mo>&nbsp;​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></span></span><script type="math/mml" id="MathJax-Element-437"><math xmlns="http://www.w3.org/1998/Math/MathML" overflow="scroll" id="eq_532"><mrow><mtable columnalign="left"><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>x</mi></msub><mrow><mo>(</mo><mi>x</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>y</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>x</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>2</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>x</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>2</mn></msup><mo>,</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>y</mi></msub><mrow><mo>(</mo><mi>y</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><msub><mi>N</mi><mi>z</mi></msub><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>y</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><mi>m</mi><mo>+</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>y</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>n</mi><mo>,</mo></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow><msub><mi>F</mi><mi>z</mi></msub><mrow><mo>(</mo><mi>z</mi><mo>)</mo></mrow></mrow></mtd><mtd columnalign="left"><mo>=</mo></mtd><mtd columnalign="left"><mrow><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>÷</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup><msup><mi>m</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mrow><mo>(</mo><mrow><mi>z</mi><mo>÷</mo><mi>n</mi></mrow><mo>)</mo></mrow><mi>mod</mi><mo> ​⁡</mo><mi>m</mi></mrow><mo>)</mo></mrow><msup><mi>n</mi><mn>3</mn></msup></mrow></mtd></mtr><mtr columnalign="left"><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow></mrow></mtd><mtd columnalign="left"><mrow><mo>+</mo><mrow><mo>(</mo><mrow><mi>z</mi><mi>mod</mi><mo> ​⁡</mo><mi>n</mi></mrow><mo>)</mo></mrow><mo>.</mo></mrow></mtd></mtr></mtable></mrow></math></script></p>
<h2><a id="sec12-6"></a><a id="page_321"></a>Frequently Asked Questions</h2>
<ul>
<li class="LX">Does tiling really make that much difference in performance?
<p>On some volume rendering applications, a two-level tiling strategy made as much as a factor-of-ten performance difference. When the array does not fit in main memory, it can effectively prevent thrashing in some applications such as image editing.</p></li>
<li class="LX">How do I store the lists in a winged-edge structure?
<p>For most applications, it is feasible to use arrays and indices for the references. However, if many delete operations are to be performed, then it is wise to use linked lists and pointers.</p></li></ul>
<h2><a id="sec12-7"></a>Notes</h2>
<p>The discussion of the winged-edge data structure is based on the course notes of <span class="cItalic">Ching-Kuang Shene</span> (Shene, 2003). There are smaller mesh data structures than winged-edge. The tradeoffs in using such structures is discussed in <span class="cItalic">Directed Edges—A Scalable Representation for Triangle Meshes</span> (Campagna, Kobbelt, &amp; Seidel, 1998). The tiled-array discussion is based on <span class="cItalic">Interactive Ray Tracing for Volume Visualization</span> (S. Parker et al., 1999). A structure similar to the triangle neighbor structure is discussed in a technical report by Charles loop (loop, 2000). A discussion of manifolds can be found in an introductory topology text (Munkres, 2000).</p>
<h2><a id="sec12-8"></a>Exercises</h2>
<ol>
<li class="LX">What is the memory difference for a simple tetrahedron stored as four independent triangles and one stored in a winged-edge data structure?</li>
<li class="LX">Diagram a scene graph for a bicycle.</li>
<li class="LX">How many look-up tables are needed for a single-level tiling of an <span class="cItalic">n</span>-dimensional array?</li>
<li class="LX">Given <span class="cItalic">N</span> triangles, what is the minimum number of triangles that could be added to a resulting BSP tree? What is the maximum number?</li>
</ol>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-9" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C011.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">Chapter 11 Texture Mapping</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C013.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">Chapter 13 More Ray Tracing</div>
        </a>
    
  
  </div>

</section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          
            <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://learning.oreilly.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          

          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" class="icon-up" style="display: none;"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://learning.oreilly.com/r/">Recommended</a></li>
      
      <li>
      <a class="t-queue-footer" href="https://learning.oreilly.com/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="https://learning.oreilly.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://learning.oreilly.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://learning.oreilly.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://learning.oreilly.com/online-learning/apps.html">Get the App</a></li>
      <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2019 <a href="https://learning.oreilly.com/" target="_blank">Safari</a>.</span>
    <a href="https://learning.oreilly.com/terms/">Terms of Service</a> /
    <a href="https://learning.oreilly.com/privacy.html">Privacy Policy</a>
  </footer>

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"licenseKey":"510f1a6865","errorBeacon":"bam.nr-data.net","transactionName":"YgdaZ0NSW0cEB0RdWltNfkZfUEFdCgofXFBHDVYdR1pQQxZeRl1QQj1aWkU=","beacon":"bam.nr-data.net","queueTime":2,"applicationID":"3275661,67267027,67267028","applicationTime":155,"agent":""}</script>


    
    <script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/saved_resource" charset="utf-8"></script>
<script type="text/javascript" id="">(function(){function b(){!1===c&&(c=!0,Munchkin.init("107-FMS-070"))}var c=!1,a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="//munchkin.marketo.net/munchkin.js";a.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||b()};a.onload=b;document.getElementsByTagName("head")[0].appendChild(a)})();</script><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/embed.js.download"></script><script type="text/javascript" id="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/digitalpi-utm-tracker-oreilly.com.js.download"></script><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.3614381240402751"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.7124633219858325" width="0" height="0" alt="" src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/0"></div>



    <script src="./Chapter 12 Data Structures for Graphics - Fundamentals of Computer Graphics, 4th Edition_files/saved_resource(1)" charset="utf-8"></script>
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 201.003px; left: 1818px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/fundamentals-of-computer/9781482229417/K22616_C012.xhtml#">Reset</a>
</div>
</div><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Script, sans-serif;"></div></div></body></html>